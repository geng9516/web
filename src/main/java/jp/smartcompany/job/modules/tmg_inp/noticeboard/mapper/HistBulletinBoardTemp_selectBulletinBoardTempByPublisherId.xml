<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.smartcompany.job.modules.tmg_inp.noticeboard.mapper.HistBulletinBoardTempMapper">

    <select id="selectBulletinBoardTempByPublisherId" resultType="jp.smartcompany.job.modules.tmg_inp.noticeboard.pojo.vo.DraftNoticeVO">
        SELECT
            HBT_ID,HBT_DDATEOFANNOUNCEMENT,HBT_DDATEOFEXPIRE,HBT_CTITLE,HBT_CHEADDISP
        FROM
            HIST_BULLETINBOARD_TEMP
        WHERE
            HBT_CCUSTOMERID = '01'
            AND HBT_CCOMPANYID = '01'
            AND HBT_CMNUSER = #{empId}
        ORDER BY
            HBT_CHEADDISP DESC,HBT_DMODIFIEDDATE DESC
    </select>

    <select id="selectVisibleBulletinBoardList" resultType="jp.smartcompany.job.modules.tmg_inp.noticeboard.pojo.vo.NoticeVO">
        select
               hb_id,hb_ddateofannouncement,hb_ddateofexpire,hb_ctitle,hb_cheaddisp,hb_cmnuser,hbrs_status as hasRead
        from
             hist_bulletinboard hb
             left join hist_bulletinboard_user hbu on hbu.HBG_CARTICLEID = hb.HB_ID
             left join hist_bulletinboard_read_status hbrs on hbrs.HB_ID_FK = hb.HB_ID and hbrs.HBRS_EMP_ID_FK = #{userId}
        where
            hb.HB_CCUSTOMERID = '01'
            and hb.HB_CCOMPANYID = '01'
            and hb.HB_CFIX = '1'
            and hb.HB_DDATEOFANNOUNCEMENT <![CDATA[<=]]> trunc(sysdate)
            and hb.HB_DDATEOFEXPIRE >= trunc(sysdate)
            and (hbu.HBG_CUSERIDS LIKE '%${userId}%' or hb.HB_CMNUSER = #{userId})
        order by hb.HB_DMODIFIEDDATE desc,hb.HB_CFIX desc
    </select>

</mapper>