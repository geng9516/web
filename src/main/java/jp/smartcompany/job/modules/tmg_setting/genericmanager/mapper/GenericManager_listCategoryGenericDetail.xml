<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.smartcompany.job.modules.tmg_setting.genericmanager.mapper.GenericManagerMapper">

    <resultMap id="categoryGenericDetailMap" type="jp.smartcompany.job.modules.tmg_setting.genericmanager.vo.CategoryGenericDetailVO">
        <result property="mgId" column="MG_ID"/>
        <result property="groupId" column="MG_CGENERICGROUPID_CK"/>
        <result property="desc" column="MG_CGENERICGROUPDESC"/>
        <result property="editAble" column="MG_CIFEDITABLE"/>
        <result property="cateName" column="CATEGORY_NAME"/>
        <result property="cateId" column="MG_CCATEGORYID"/>
        <collection property="itemList" ofType="jp.smartcompany.job.modules.tmg_setting.genericmanager.vo.CategoryGenericDetailItemVO">
            <result property="mgdId" column="MGD_ID"/>
            <result property="groupId" column="MGD_CGENERICGROUPID"/>
            <result property="detailId" column="MGD_CGENERICDETAILID_CK"/>
            <result property="masterCode" column="MGD_CMASTERCODE"/>
            <result property="startDate" column="MGD_DSTART_CK"/>
            <result property="endDate" column="MGD_DEND"/>
            <result property="desc" column="MGD_CGENERICDETAILDESC"/>
        </collection>
    </resultMap>

    <select id="listCategoryGenericDetail" resultMap="categoryGenericDetailMap" parameterType="map">
        SELECT
            A.MG_ID,
            A.MG_CGENERICGROUPID_CK,
            A.MG_CGENERICGROUPDESC,
            A.MG_CIFEDITABLE,
            A.MG_CCATEGORYID,
            B.MGC_CCATEGORYNAME CATEGORY_NAME,
            C.MGD_ID,
            C.MGD_CGENERICGROUPID,
            C.MGD_CGENERICDETAILID_CK,
            C.MGD_CMASTERCODE,
            C.MGD_DSTART_CK,
            C.MGD_DEND,
            PSMASTER.FUNC_GET_GENERICDETAIL_DESC(
                    C.MGD_CCUSTOMERID,
                    C.MGD_CCOMPANYID_CK_FK,
                    C.MGD_CMASTERCODE,
                    '${searchDate}',
                    'ja'
                ) MGD_CGENERICDETAILDESC
        FROM
            MAST_GENERIC A
                LEFT JOIN MAST_GENERIC_CATEGORY B ON A.MG_CCUSTOMERID_CK_FK = B.MGC_CCUSTOMERID AND A.MG_CCATEGORYID = B.MGC_CCATEGORYID
                LEFT JOIN MAST_GENERIC_DETAIL C ON A.MG_CGENERICGROUPID_CK = C.MGD_CGENERICGROUPID
                     AND MGD_CCUSTOMERID = '01'
                     AND MGD_CCOMPANYID_CK_FK = '01'
                     AND MGD_CLANGUAGE_CK = 'ja'
                     AND MGD_DSTART_CK <![CDATA[<=]]> #{searchDate}
                     AND MGD_DEND >= #{searchDate}
        WHERE
            A.MG_CCUSTOMERID_CK_FK = '01'
          AND A.MG_CLANGUAGE_CK = 'ja'
          AND	A.MG_CCATEGORYID = #{categoryId}
        ORDER BY
            A.MG_CGENERICGROUPID_CK,
            C.MGD_CGENERICGROUPID
    </select>

</mapper>