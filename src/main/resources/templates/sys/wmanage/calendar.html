<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head
    th:replace="layout/header::common_header(title='カレンダー編集',cssPaths='/pages/content.min.css,' + '/pages/calendar.min.css')">
</head>

<body>
    <div th:replace="layout/loadingBar::loadingBar"></div>
    <main class="content calendaredit-warp" @scroll.passive="handleScroll" ref="layout">
        <div class="content_head">
            <div class="header">
                <div class="title1">
                    <h1>
                        <Icon type="i-emeer colored"></Icon>
                        {{ `カレンダー編集` }}
                    </h1>
                </div>
                <div class="btnbox">
                    <span style="flex:1"></span>
                    <i-button type="primary" icon="md-create" size="large" @click="isEditable = !isEditable"
                        v-if="!isEditable">編集</i-button>
                    <i-button type="success" icon="md-done-all" size="large" @click="isEditable = !isEditable"
                        v-if="isEditable">保存</i-button>
                    <i-button size="large" @click="isEditable = !isEditable" v-if="isEditable">キャンセル</i-button>
                </div>
            </div>
            <div class="searchwrap">
                <span class="label">年</span>
                <date-picker class="mar" v-model="curDate" type="year" :editable="false" :clearable="false"
                    @on-change="handleDatePicker" format="yyyy年"></date-picker>
            </div>
        </div>
        <div class="content_body">
            <div class="content_body">
                <div style="display:inline-block;width:80%;margin-left: -14%;">
                    <div v-for="(e, i) of calData" :key="i" style="display:inline-block;width:30%">
                        <span class="label big" style="display:block;width:87.5%;">{{ `${i + 1}月` }}</span>
                        <Row class="calendar-row">
                            <i-col class="cal-week sun" span="3">日</i-col>
                            <i-col class="cal-week" span="3">月</i-col>
                            <i-col class="cal-week" span="3">火</i-col>
                            <i-col class="cal-week" span="3">水</i-col>
                            <i-col class="cal-week" span="3">木</i-col>
                            <i-col class="cal-week" span="3">金</i-col>
                            <i-col class="cal-week sat" span="3">土</i-col>
                        </Row>
                        <Row class="calendar-row mb20">
                            <i-col class="cal-week" style="background:rgb(245, 247, 249)" span="3"
                                v-for="(n, t) of e.begin" :key="t+500">
                            &nbsp;
                            </i-col>
                            <i-col :class="handleWeekStyle(e, t)" span="3" v-for="(n, t) of e.num" :key="t + 1000"
                                @click.native.stop="changeCalendar(e, t)">
                            {{ n }}
                            </i-col>
                            <i-col class="cal-week" style="background:rgb(245, 247, 249)" span="3"
                                v-for="(q, p) of addGreyCalendar(e)" :key="p+2000">
                            &nbsp;
                            </i-col>
                        </Row>
                    </div>
                </div>
                <div style="display:inline-block;position: relative;width:16%;top: -139px;margin-left: -50px;">
                    <Row>
                        <i-col span="18" class="label big">1月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">18日</span>
                        </i-col>
                        <i-col span="18" class="label big">2月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">18日</span>
                        </i-col>
                        <i-col span="18" class="label big mb30">3月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">21日</span>
                        </i-col>
                        <i-col span="18" class="label big">4月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">21日</span>
                        </i-col>
                        <i-col span="18" class="label big">5月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">18日</span>
                        </i-col>
                        <i-col span="18" class="label big mb30">6月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">22日</span>
                        </i-col>
                        <i-col span="18" class="label big">7月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">21日</span>
                        </i-col>
                        <i-col span="18" class="label big">8月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">20日</span>
                        </i-col>
                        <i-col span="18" class="label big mb30">9月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">20日</span>
                        </i-col>
                        <i-col span="18" class="label big">10月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">22日</span>
                        </i-col>
                        <i-col span="18" class="label big">11月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">19日</span>
                        </i-col>
                        <i-col span="18" class="label big">12月 基準日数</i-col>
                        <i-col span="6">
                        <span class="input-like-span">20日</span>
                        </i-col>
                    </Row>
                </div>
            </div>
    </main>
    <div th:replace="layout/script::common_script"></div>
    <script type="text/babel" th:inline="javascript">
        const CALENDAR_EDIT = new Vue({
            el: '.calendaredit-warp',
            data() {
                return {
                    curDate: new Date(),
                    isEditable: false,
                    loading: false,
                    calData: [
                        { begin: 3, num: 31, restDay: [1, 2, 3, 13] },
                        { begin: 6, num: 29, restDay: [11, 24] },
                        { begin: 0, num: 31, restDay: [20] },
                        { begin: 3, num: 30, restDay: [29] },
                        { begin: 5, num: 31, restDay: [4, 5, 6] },
                        { begin: 1, num: 30 },
                        { begin: 3, num: 31, restDay: [23, 24] },
                        { begin: 6, num: 31, restDay: [10] },
                        { begin: 2, num: 30, restDay: [21, 22] },
                        { begin: 4, num: 31 },
                        { begin: 0, num: 30, restDay: [3, 23] },
                        { begin: 2, num: 31 }
                    ]
                }
            },
            async created() {
                // this.loading = true
                // try {
                //   const { data } = await this.api.mock('deptSumInfo')
                //   this.tableData = data
                // } catch (error) {
                //   return
                // } finally {
                //   this.loading = false
                // }
            },
            methods: {
                handleDatePicker() { },
                handleWeekStyle(e, i) {
                    const weekIndex = e.begin + i
                    const sat = [6, 13, 20, 27, 34]
                    const sun = [0, 7, 14, 21, 28, 35]
                    if (e.extraWorkDay && e.extraWorkDay.includes(i)) {
                        return 'cal-week'
                    }
                    if (e.restDay && e.restDay.includes(weekIndex)) {
                        return 'cal-week rest'
                    }
                    if (e.lawDay && e.lawDay.includes(i)) {
                        return 'cal-week sun'
                    }
                    if (sat.includes(weekIndex)) {
                        return 'cal-week sat'
                    }
                    if (sun.includes(weekIndex)) {
                        return 'cal-week sun'
                    }
                    return 'cal-week'
                },
                addGreyCalendar(e) {
                    const count = e.begin + e.num
                    const full = [28, 35, 42]
                    let reslut = 0
                    full.some(e => {
                        if (e === count) {
                            reslut = 0
                            return true
                        }
                        if (e > count) {
                            reslut = e - count
                            return true
                        }
                    })
                    return reslut
                },
                changeCalendar(e, i) {
                    if (!this.isEditable) return
                    const isLaw =
                        e.lawDay &&
                        e.lawDay.some((t, j) => {
                            if (t === i) {
                                e.lawDay.splice(j, 1)
                                return true
                            }
                        })
                    const isRest =
                        e.restDay &&
                        e.restDay.some((t, j) => {
                            if (t === i + e.begin) {
                                e.restDay.splice(j, 1)
                                return true
                            }
                        })
                    if (!isRest && !isLaw) {
                        if (e.lawDay) this.$set(e, 'lawDay', [...e.lawDay, i])
                        else this.$set(e, 'lawDay', [i])
                    }
                    if (isLaw) {
                        if (e.restDay) this.$set(e, 'restDay', [...e.restDay, i + e.begin])
                        else this.$set(e, 'restDay', [i + e.begin])
                    }
                    if (isRest) {
                        if (e.extraWorkDay) this.$set(e, 'workDay', [...e.extraWorkDay, i])
                        else this.$set(e, 'extraWorkDay', [i])
                    }
                }
            }
        })
    </script>
</body>

</html>