<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head
        th:replace="layout/header::common_header(title='年次休暇管理',cssPaths='/pages/content.min.css,' + '/pages/vacation.min.css')">
</head>

<body>
<div th:replace="layout/loadingBar::loadingBar"></div>
<!-- 菜单导航栏 -->
<div th:replace="layout/sider"></div>
<main class="content vaction-warp">
    <div class="content_head">
        <div class="header">
            <div class="title1">
                <h1>
                    <Icon type="i-happytime colored"></Icon>
                    年次休暇管理
                </h1>
            </div>
            <div class="btnbox">

            </div>
        </div>
        <div class="searchwrap">
            <!-- 共通組織図画面 start-->
            <!--            <span style="display:flex;width: calc(15% + 200px);">-->
            <!--                    <span class="label">所属</span>-->
            <!--                    <i-button v-on:click.native="deptDrawShow = true" class="input-like-span dept-select">-->
            <!--                        <Tooltip trigger="hover" :theme="toolTipTheme()" transfer>{{deptName}}-->
            <!--                            <div slot="content">{{deptName}}</div>-->
            <!--                        </Tooltip>-->
            <!--                    </i-button>-->
            <!--                    <Drawer class="tc" placement="right" width="700" :closable="false"-->
            <!--                            :mask-closable="!isSearchHistory"-->
            <!--                            v-model="deptDrawShow">-->
            <!--                        <div class="titlenorm mb5">-->
            <!--                            <Icon type="logo-buffer"></Icon>-->
            <!--                            所属-->
            <!--                        </div>-->
            <!--                        <Row class="tl mb5">-->
            <!--                            <i-col span="4" class="label tc" style="height: 32px;">基準日</i-col>-->
            <!--                            <i-col span="7" class="no-border-radius">-->
            <!--                            <date-picker type="date" :value="referListObject.txtTmgReferListTreeViewRecordDate" :options="startLimit" transfer-->
            <!--                                         placeholder="基準日" format="yyyy/MM/dd" ref="datePicker" :clearable="false"-->
            <!--                                         @on-change="handleDeptDateChange"></date-picker>-->
            <!--                            </i-col>-->
            <!--                        </Row>-->
            <!--                        <div style="position: relative;">-->
            <!--                            <Tree class="tree mt2" :data="treeData" v-on:on-select-change="handleClickLeaf" ref="tree"-->
            <!--                                  empty-text="所属データなし"></Tree>-->
            <!--                            <Spin size="large" fix v-if="empDeptLoading"></Spin>-->
            <!--                        </div>-->
            <!--                    </Drawer>-->
            <!--                </span>-->


            <span style="display:flex;width: calc(15% + 200px);">
                    <span class="label">所属</span>
                    <i-button v-on:click.native="deptDrawShow = true" class="input-like-span dept-select">
                        <Tooltip trigger="hover" :theme="toolTipTheme()" transfer>{{deptName}}
                            <div slot="content">{{deptName}}</div>
                        </Tooltip>
                    </i-button>
                    ​
                    <Drawer :mask-closable="!isSearchHistory" class="tc" placement="right"
                            v-model="deptDrawShow" width="700">
                        <Tabs :animated="false" @on-click="currentTabChanged" v-model="currentTab">
                            <tab-pane label="ツリー" name="organisationTree">
                                <div class="titlenorm mb5">
                                    <Icon type="logo-buffer"></Icon>
                                    所属
                                </div>
                                <Row class="tl mb5">
                                    <i-col class="label tc" span="4" style="height: 32px;">基準日</i-col>
                                    <i-col class="no-border-radius" span="7">
                                        <date-picker :clearable="false" :options="startLimit"
                                                     :value="referListObject.txtTmgReferListTreeViewRecordDate" @on-change="handleDeptDateChange"
                                                     format="yyyy/MM/dd" placeholder="基準日" ref="datePicker" transfer
                                                     type="date">
                                        </date-picker>
                                    </i-col>
                                </Row>

                                <div style="position: relative;">
                                    <Tree :data="treeData" class="tree mt2" empty-text="所属データなし"
                                          ref="tree" v-on:on-select-change="handleClickLeaf"></Tree>
                                    <Spin fix size="large" v-if="empDeptLoading"></Spin>
                                </div>
                            </tab-pane>
                            <tab-pane label="検索" name="organisationSearch">
                                <Row :gutter="8" class="tl mb2">
                                    <i-col span="15">
                                        <i-input class="mar mb5 like-select"
                                                 enter-button placeholder="検索" search v-model="referListObject.hidSearchData">
                                            <i-select placeholder="項目" slot="prepend" style="width: 108px"
                                                      transfer v-model="referListObject.hidSearchItems">
                                                <i-option :value="item.value" v-for="(item,i) of searchTypesList">
                                                    {{ item.name }}</i-option>
                                            </i-select>
                                            <i-select placeholder="条件" slot="append"
                                                      style="width: 108px" transfer v-model="referListObject.hidSearchCondition">
                                                <i-option :value="item.value" v-for="(item,i) of searchConditionsList">
                                                    {{ item.name }}</i-option>
                                            </i-select>
                                        </i-input>
                                    </i-col>
                                    <i-col class="no-border-radius" span="8">
                                        <i-button :loading="loading" @click="getSearchTableData" ghost icon="md-search" long
                                                  type="primary">検索</i-button>
                                    </i-col>
                                </Row>
                                <Alert class="primary-info mt10">※検索結果の上位100件を表示しています。</Alert>
                            </tab-pane>
                        </Tabs>
                    </Drawer>
                </span>
            <!-- 共通組織図画面 end-->
            <span style="flex:1"></span>
        </div>
    </div>
    <div class="content_body">
        <i-table :class="tableHeadFixed ? 'table-head-fixed' : ''"
                 no-data-text="" border :columns="columns"
                 :row-class-name="() => 'select-col'" :disabled-hover="true" :data="data" :loading="loading">
            <div slot-scope="{ row }" slot="name" class="tc">
                <span class="pl5 pr5 cursor row-label-primary tl no-border-radius width100" @click.stop="showDay(row)">{{ row.name }}</span>
            </div>
            <template slot-scope="{ row }" slot="workertypenm">
                <span>{{ row.workertypenm }}</span>
            </template>
            <template slot-scope="{ row }" slot="tphDyyyymmdd">
                <span>{{ row.tphDyyyymmdd }}</span>
            </template>
            <template slot-scope="{ row }" slot="investDaysSum">
                <span>{{ row.investDaysSum | addNumDeci(true) }}</span>
            </template>

            <template slot-scope="{ row }" slot="investHours">
                <span>{{ row.investHours | addNumDeci }}</span>
            </template>

            <template slot-scope="{ row }" slot="throughoutDaysSum">
                <span>{{ row.throughoutDaysSum | addNumDeci(true)  }}</span>
            </template>

            <template slot-scope="{ row }" slot="throughoutHoursSum">
                <span>{{ row.throughoutHoursSum | addNumDeci }}</span>
            </template>
        </i-table>
    </div>

    <Drawer :title="title" width="1000" v-model="paidHolidayInitRList" :mask-closable="false">
        <div class="content_body">
            <Row>
                <i-col span="6" class="label tc">所属</i-col>
                <i-col span="9">
                    <span class="input-like-span">{{ empDeptName }}</span>
                </i-col>
            </Row>

            <Row>
                <i-col span="6" class="label tc">氏名</i-col>
                <i-col span="9">
                    <span class="input-like-span">{{ name }}</span>
                </i-col>
            </Row>

            <Row>
                <i-col span="6" class="label tc">種別</i-col>
                <i-col span="9">
                    <span class="input-like-span">{{ workertypenm }}</span>
                </i-col>
            </Row>

            <div style="position: relative;">
                <Row :gutter="10" class="mt20 mb10">
                    <i-col span="12">
                        <div class="titlenorm">
                            <Icon type="logo-buffer"></Icon>
                            今期付与情報
                        </div>
                        <Row>
                            <i-col span="6" class="label tc">付与期間</i-col>
                            <i-col span="18">
                                <span class="input-like-span">{{dataDetail.dyyyymmdd}} ～ {{dataDetail.dyyyymmddEnd}} </span>
                            </i-col>
                        </Row>

                        <i-table border :columns="columns3" :data="paidNowData" :span-method="handleSpan" class="mt2" :disabled-hover="true" :loading="updateLoading" no-data-text="">
                            <template slot-scope="{ row ,index }" slot="days">
                                <i-input v-model="paidNowData[index].days" v-if="row.isEditable" class=" tc"></i-input>
                                <p v-else>{{ row.days| addNumDeci(true) }}</p>
                            </template>

                            <template slot-scope="{ row,index }" slot="times">
                                <i-input v-model="paidNowData[index].times" v-if="row.isEditable" class=" tc"></i-input>
                                <p v-else>{{ row.times| addNumDeci }}</p>
                            </template>

                            <template slot-scope="{ row ,index}" slot="expiryDate">
                                <date-picker type="date" v-model="paidNowData[index].expiryDate" class="datepicker-single mb5" placeholder="日付"
                                             format="yyyy/MM/dd" @on-change="paidNowData[index].expiryDate = $event" v-if="row.isEditable" transfer></date-picker>
                                <p v-else>{{ row.expiryDate }}</p>
                            </template>
                        </i-table>
                    </i-col>
                    <i-col span="12">
                        <div class="titlenorm">
                            <Icon type="logo-buffer"></Icon>
                            前年度勤務実績
                        </div>
                        <Row>
                            <i-col span="10" class="label tc">予定勤務日数</i-col>
                            <i-col span="14">
                                <span class="input-like-span">{{dataDetail.nplanworkday}}</span>
                            </i-col>
                            <i-col span="10" class="label tc" style="white-space:pre-line">{{ `実勤務日数\n(付与に必要な日数)` }}
                            </i-col>
                            <i-col span="14">
                              <span class="input-like-span" style="white-space:pre-line;height:51px;line-height:10px">
                                  {{ dataDetail.nconfirm}}{{'\n\n'}}({{dataDetail.nplanworkdayLimit}})
                              </span>
                            </i-col>
                        </Row>
                        <div class="titlenorm mt10">
                            <Icon type="logo-buffer"></Icon>
                            今期付与の基礎情報
                        </div>
                        <Row>
                            <i-col span="10" class="label tc">予定勤務パターン</i-col>
                            <i-col span="14">
                                <span class="input-like-span" style="font-size: 12px;">{{dataDetail.cworkingdaysWeekName}}</span>
                            </i-col>
                            <i-col span="10" class="label tc">勤務開始日</i-col>
                            <i-col span="14">
                                <span class="input-like-span">{{dataDetail.dbegindateWork}}</span>
                            </i-col>
                            <i-col span="10" class="label tc">1日の換算時間数</i-col>
                            <i-col span="14">
                                <span class="input-like-span">{{dataDetail.navgworktimeDisp}}</span>
                            </i-col>
                        </Row>
                        <div class="titlenorm mt10">
                            <Icon type="logo-buffer"></Icon>
                            変更者コメント
                        </div>
                        <!--                        :autosize="{ miFnRows: 2, maxRows: 5 }"-->
                        <i-input type="textarea" :rows="3" v-model.trim="dataDetail.ccomment"></i-input>
                    </i-col>
                </Row>
                <Spin size="large" fix v-if="paidDetailsLoading"></Spin>
            </div>

            <div class="tr mb10">
                <i-button type="primary" ghost class="mr15" @click="calculation">計算</i-button>
                <i-button type="primary" ghost class="mr15" @click="clear">クリア</i-button>
                <i-button type="success" ghost class="mr15" @click="exeUpdate">登録</i-button>
            </div>
            <div class="titlenorm mb10">
                <Icon type="logo-buffer"></Icon>
                年次休暇付与状況
            </div>
<!--            @on-row-click="showDayList(arguments)"-->
            <i-table  :row-class-name="() => 'select-col'" :disabled-hover="true" no-data-text=""
                     border :columns="paidDetailsColumns" :data="paidDetailsData" :loading="paidNowLoading">
                <template slot-scope="{ row }" slot="dyyyymmdd">
                    <span @click.stop="showDayList( row )"  class="pl5 pr5 cursor row-label-primary tl no-border-radius width100">{{ row.dyyyymmdd }}</span>
                </template>

                <template slot-scope="{ row }" slot="ninvest">
                    <span>{{ row.ninvest | addNumDeci(true) }}</span>
                </template>

                <template slot-scope="{ row }" slot="nadjust">
                    <span>{{ row.nadjust | addNumDeci(true) }}</span>
                </template>
                <template slot-scope="{ row }" slot="nadjustHours">
                    <span>{{ row.nadjustHours | addNumDeci }}</span>
                </template>

                <template slot-scope="{ row }" slot="nthroughout">
                    <span>{{ row.nthroughout | addNumDeci(true) }}</span>
                </template>
                <template slot-scope="{ row }" slot="nthroughoutHours">
                    <span>{{ row.nthroughoutHours | addNumDeci }}</span>
                </template>

                <template slot-scope="{ row }" slot="nadjustTo">
                    <span>{{ row.nadjustTo | addNumDeci(true) }}</span>
                </template>
                <template slot-scope="{ row }" slot="nadjustHoursTo">
                    <span>{{ row.nadjustHoursTo | addNumDeci }}</span>
                </template>

                <template slot-scope="{ row }" slot="ninvestDays">
                    <span>{{ row.ninvestDays | addNumDeci(true) }}</span>
                </template>
                <template slot-scope="{ row }" slot="ninvestHours">
                    <span>{{ row.ninvestHours | addNumDeci }}</span>
                </template>
            </i-table>
        </div>
    </Drawer>
</main>
<div th:replace="layout/head::header"></div>
<script type="text/babel" th:inline="javascript">
    const VACATION = new Vue({
        methods: {
            handleScroll: Throttle(function(e) {
                this.contentScrollTop = e.target.documentElement.scrollTop || e.target.body.scrollTop
            }, 50),
            // 職員検索
            async getSearchTableData() {
                if (this.referListObject.hidSearchData === null || this.referListObject.hidSearchData.trim() == '') {
                    this.$Message.error({
                        background: true,
                        closable: true,
                        duration: 6,
                        content: '検索内容が未設定です、検索内容を入力してください'
                    });
                    return
                }
                this.deptName = '検索対象者一覧'
                //ツリー：0、検索：1
                this.referListObject.hidSelectTab = '1'
                this.query.hidSelectTab = '1'
                this.getTableData()
            },
            //データリストを更新する
            async getTableData() {
                try {
                    if (this.query.hidSelectTab == '1') {
                        this.deptName = '検索対象者一覧'
                    }
                    this.loading = true
                    const {data} = await this.http.get('sys/paidholiday/list', this.referListObject)
                    this.data = data
                    if (this.data.length == 0 && this.referListObject.hidSelectTab == '0') {
                        this.Loading = false
                        this.$Message.error({
                            background: true,
                            closable: true,
                            duration: 6,
                            content: '職員が存在している部署を選択してくだい。'
                        });
                    }
                    if (this.data.length == 0 && this.referListObject.hidSelectTab == '1') {
                        this.Loading = false
                        this.$Message.error({
                            background: true,
                            closable: true,
                            duration: 6,
                            content: '条件に一致する職員が見つかりませんでした。'
                        });
                    }

                } catch (error) {
                    return
                } finally {
                    this.loading = false
                    this.isSearchHistory = false
                }
            },
            async getOrgTree() {
                this.empDeptLoading = true
                try {
                    const {orgList, recordDate} = await this.http.get('sys/tree', this.referListObject)
                    // 先将数据转为标准格式，再转为可用数据
                    this.treeData = Utils.convertTreeData(orgList)
                    const date = [[${ TREEVIEW_KEY_RECORD_DATE }]]
                    this.referListObject[date] = recordDate
                } catch (error) {
                    return
                } finally {
                    this.loading = false
                    this.empDeptLoading = false
                }
            },
            async getSearchCondition() {
                const {data} = await this.http.get('sys/tree/conditions', this.referListObject)
                this.searchConditionsList = Object.keys(data.searchConditions).map(e => {
                    return {name: data.searchConditions[e], value: e}
                })
                this.searchTypesList = Object.keys(data.searchTypes).map(e => {
                    return {name: data.searchTypes[e], value: e}
                })
            },
            //ツリーまたは検索を変わる
            async currentTabChanged(name) {
                // if (name=="organisationTree") {
                //     this.referListObject.hidSelectTab='0'
                // } else if (name=="organisationSearch") {
                //     this.referListObject.hidSelectTab='1'
                // }
            },
            //基準日変更対応
            async handleDeptDateChange(e) {
                const date = [[${ TREEVIEW_KEY_RECORD_DATE }]]
                this.referListObject[date] = e
                this.isSearchHistory = true
                await this.getOrgTree()
                if (this.treeData.length !== 0) {
                    this.$Notice.warning({title: '所属図更新完了', desc: "下記の所属リストから対象を選んでください"})
                }
                //検索用職員情報を取得する基準日をセットする
                this.query.txtTmgReferListTreeViewRecordDate = e
            },
            //ツリー検索
            async handleClickLeaf(e) {
                this.deptDrawShow = false
                const section = [[${ TREEVIEW_KEY_ADMIN_TARGET_SECTION }]]
                if(e[0]){
                    this.referListObject[section] = e[0].secid
                    this.deptName = e[0].secnic
                }

                //ツリー検索までリセット
                this.referListObject.hidSelectTab = '0'
                this.query.hidSelectTab = '0'
                this.getTableData()
            },
            handleSpan({rowIndex, columnIndex}) {
                if (rowIndex === 6 && columnIndex === 0) {
                    return [1, 4]
                } else if (
                    (rowIndex === 6 && columnIndex === 3) ||
                    (rowIndex === 6 && columnIndex === 2) ||
                    (rowIndex === 6 && columnIndex === 1)
                ) {
                    return [0, 0]
                }
            },
            // 年次休暇管理編集のレコードを選択する
            showDay(e) {
                this.paidDetailsLoadingFlg = 1
                this.dataDetail = ''
                this.paidDetailsData = []

                this.paidHolidayInitRList = true
                this.title = '年次休暇編集'

                this.name = e.name
                this.workertypenm = e.workertypenm

                this.cemployeeid = e.tphCemployeeid

                // 職員情報取得
                //console.log('this.query.hidSelectTab:', this.query.hidSelectTab)
                if (this.query.hidSelectTab == '1') {
                    //職員検索の場合、リクエスト要
                    this.query.txtTmgReferListTreeViewAdminTargetEmp = e.tphCemployeeid
                    this.getApplyEmployPersonalInfo()
                } else {
                    //部署検索の場合、リクエスト不要
                    this.empDeptName = this.deptName
                }

                this.getDetailList(e.tphDyyyymmdd, e.tphCemployeeid)

            },
            // 年次休暇管理
            async getDetailList(tphDyyyymmdd, tphCemployeeid) {
                if(this.paidDetailsLoadingFlg == 1){
                    this.paidDetailsLoading = true
                }

                //选择职员保存、初期化使用。
                this.param.txtTmgReferListTreeViewAdminTargetEmp = tphCemployeeid

                try {
                    this.tphDyyyymmdd = tphDyyyymmdd
                    this.param.txtDate = tphDyyyymmdd
                    this.param.txtUserCode = tphCemployeeid
                    //年次休暇付与状況取得
                    const {data} = await this.http.get('sys/paidholiday/detailList', this.param)

                    //今期付与情報
                    data.forEach(e => {
                        if (e.dyyyymmdd === tphDyyyymmdd) {
                            this.dataDetail = {...e}
                            this.dataDetailBack = e
                        }
                    })

                    this.paidDetailsData = data

                } catch (error) {
                    return
                } finally {
                    if(this.paidDetailsLoadingFlg == 1){
                        this.paidDetailsLoading = false
                    }
                }
            },
            // async showDayList(e) {
            //     this.dataDetail = ''
            //     this.paidDetailsLoading = true
            //     this.dataDetail = {...e[0]}
            //
            //     this.dataDetailBack = e[0]
            //     setTimeout(() => this.paidDetailsLoading = false)
            // },
            async showDayList(e) {
                this.dataDetail = ''
                this.paidDetailsLoading = true
                this.dataDetail = {...e}

                this.dataDetailBack = e
                this.tphDyyyymmdd = e.dyyyymmdd
                console.log("--------------------1------------------------")
                console.log(e)
                setTimeout(() => this.paidDetailsLoading = false)
            },



            //クリアボタン押下
            async clear() {
                this.dataDetail = ''
                this.paidDetailsLoading = true

                this.$nextTick(()=>this.dataDetail = {...this.dataDetailBack})
                setTimeout(() => this.paidDetailsLoading = false)

            },
            //登録ボタン押下
            exeUpdate: Debounce(async function () {
                if (this.calculation()) {
                    this.$Modal.confirm({
                        title: '注意',
                        width: 480,
                        content: 'この編集内容で登録します。よろしいですか？',
                        okText: 'OK',
                        cancelText: 'キャンセル',
                        onOk: async () => {
                            this.paramters.txtDate = this.tphDyyyymmdd
                            this.paramters.cemployeeid = this.cemployeeid
                            this.paramters.dyyyymmdd = this.dataDetail.dyyyymmdd
                            this.paramters.ninvest = this.dataDetail.ninvest
                            this.paramters.nadjust = this.dataDetail.nadjust
                            // this.paramters.nadjustHours = this.format_hours(this.dataDetail.nadjustHours,2)
                            // this.paramters.nadjustHours = this.format_hours(this.toMinuteFromHours(this.dataDetail.nadjustHours)/60,2)
                            this.paramters.nadjustHours = this.dataDetail.nadjustHours
                            this.paramters.nadjustTo = this.dataDetail.nadjustTo
                            // this.paramters.nadjustHoursTo =  this.format_hours(this.dataDetail.nadjustHoursTo,2)
                            this.paramters.nadjustHoursTo = this.dataDetail.nadjustHoursTo
                            this.paramters.dexpireAdjust = this.dataDetail.dexpireAdjust
                            this.paramters.dexpireAdjustTo = this.dataDetail.dexpireAdjustTo
                            this.paramters.ccomment = this.dataDetail.ccomment
                            this.paidDetailsLoadingFlg = 0
                            this.updateLoading = true
                            this.paidNowLoading = true
                            await this.http.get('sys/paidholiday/execUpdate', this.paramters)
                            await this.getTableData()
                            await this.getDetailList(this.paramters.dyyyymmdd, this.paramters.cemployeeid)
                            this.updateLoading = false
                            this.paidNowLoading = false
                            // this.paidHolidayInitRList = false
                        },
                        onCancel: () => {
                        }
                    })
                }
            }),
            // 計算ボタン押下
            calculation() {

                let nadjust = this.paidNowData[3].days
                let nadjustHours = this.paidNowData[3].times
                let dexpireAdjust = this.paidNowData[3].expiryDate

                let nadjustTo = this.paidNowData[4].days
                let nadjustHoursTo = this.paidNowData[4].times
                let dexpireAdjustTo = this.paidNowData[4].expiryDate
                if (!this.checkError()) {
                    this.dataDetail.nadjust = nadjust
                    this.dataDetail.nadjustHours = nadjustHours
                    this.dataDetail.dexpireAdjust = dexpireAdjust

                    this.dataDetail.nadjustTo = nadjustTo
                    this.dataDetail.nadjustHoursTo = nadjustHoursTo
                    this.dataDetail.dexpireAdjustTo = dexpireAdjustTo
                    return false
                }

                this.paidDetailsLoading = true

                this.dataDetail.ninvestDays = (eval(this.dataDetail.ninvest)
                    + eval(+this.dataDetail.nthroughout)
                    + eval(+nadjust)
                    + eval(+nadjustTo))

                this.dataDetail.ninvestHours = this.toHoursFromMinutes(this.toMinuteFromHours(nadjustHours)
                    + this.toMinuteFromHours(nadjustHoursTo)
                    + this.toMinuteFromHours(this.dataDetail.nthroughoutHours)).toFixed(2)
                this.dataDetail.nadjust = nadjust
                this.dataDetail.nadjustHours = nadjustHours
                this.dataDetail.dexpireAdjust = dexpireAdjust

                this.dataDetail.nadjustTo = nadjustTo
                this.dataDetail.nadjustHoursTo = nadjustHoursTo
                this.dataDetail.dexpireAdjustTo = dexpireAdjustTo

                setTimeout(() => this.paidDetailsLoading = false)

                // 日付不足チェック
                let nKonkiShutoku = parseFloat(this.paidNowData[7].days) + parseFloat(this.paidNowData[7].times) / this.dataDetail.navgworktimeCalc;

                if (
                    (
                        eval(this.paidNowData[0].days)
                        + eval(this.paidNowData[1].days)
                        + eval(this.paidNowData[3].days)
                        + eval(this.paidNowData[4].days)
                        + (
                            this.toHoursFromMinutes(
                                this.toMinuteFromHours(this.paidNowData[1].times) +
                                this.toMinuteFromHours(this.paidNowData[3].times) +
                                this.toMinuteFromHours(this.paidNowData[4].times)
                            ) / this.dataDetail.navgworktimeCalc
                        )
                    ) < nKonkiShutoku
                ) {
                    // MSG_NO_DAY
                    this.$Notice.warning({desc: "調整付与日数が不足しています。"})
                    return false;
                }

                // 合計付与日数と合計付与時間数の合計
                let nDaySum = (eval(this.paidNowData[0].days)
                    + eval(this.paidNowData[1].days)
                    + eval(this.paidNowData[3].days)
                    + eval(this.paidNowData[4].days))
                let nHouSum = (this.toMinuteFromHours(this.paidNowData[1].times)
                    + this.toMinuteFromHours(this.paidNowData[3].times)
                    + this.toMinuteFromHours(this.paidNowData[4].times)) / 60
                let nDHSum = (parseFloat(nDaySum) + (parseFloat(nHouSum) / this.dataDetail.navgworktimeCalc))

                if (nDaySum > 40) {
                    //MSG_OVER_SUM_DAY
                    this.$Notice.warning({desc: "調整付与日数と今期付与日数の合計は40を超えないようにして下さい。 "})
                    this.clear()
                    return false;
                } else if (nDHSum > 40) {
                    // MSG_OVER_SUM_DAYHOURS
                    this.$Notice.warning({desc: "合計付与日数と合計付与時間数の合計は40を超えないようにして下さい。 "})
                    this.clear()
                    return false
                }
                return true

            },
            refresh() {
                console.log("-----------------------------10------------------------------------")
                // 未入力チェック
                // 調整付与日数
                if (this.paidNowData[3].days === '') {
                    this.$Notice.warning({desc: "調整付与日数を入力してください。"})
                    return false
                }
                // 調整付与時間数
                if (this.paidNowData[3].times === '') {
                    this.$Notice.warning({desc: "調整付与時間数を入力してください。"})
                    return false
                }
                // 調整繰越日数
                if (this.paidNowData[4].days === '') {
                    this.$Notice.warning({desc: "調整繰越日数を入力してください。"})
                    return false
                }
                // 調整繰越時間数
                if (this.paidNowData[4].times === '') {
                    this.$Notice.warning({desc: "調整繰越時間数を入力してください。"})
                    return false
                }

                //整数チェック
                // 調整付与日数
                if (isNaN(this.paidNowData[3].days) || this.paidNowData[3].days % 0.5 > 0) {
                    this.$Notice.warning({desc: "調整付与日数は半休単位(0.5)で入力してください。"})
                    return false;
                }
                //調整付与時間数
                if (isNaN(this.paidNowData[3].times)) {
                    this.$Notice.warning({desc: "調整付与時間数には０以上の数を指定してください。"})
                    return false;
                }
                // 調整繰越日数
                if (isNaN(this.paidNowData[4].days) || this.paidNowData[4].days % 0.5 > 0) {
                    this.$Notice.warning({desc: "調整繰越日数は半休単位(0.5)で入力してください。"})
                    return false;
                }
                //調整繰越時間数
                if (isNaN(this.paidNowData[4].times)) {
                    this.$Notice.warning({desc: "調整繰越時間数には０以上の数を指定してください。"})
                    return false;
                }


                // 調整付与時間数
                if (!this.numeric_check(this.paidNowData[3].times * 1000 / 10) ||
                    this.toMinuteFromHours(this.paidNowData[3].times) % 15 > 0 ||
                    (this.paidNowData[3].times * 10 % 10) * 10 > 45) {
                    this.$Notice.warning({desc: "調整付与時間数は0.15単位で入力してください。"})

                    return false;
                }

                // 調整繰越時間数
                if (!this.numeric_check(this.paidNowData[4].times * 1000 / 10) ||
                    this.toMinuteFromHours(this.paidNowData[4].times) % 15 > 0 ||
                    (this.paidNowData[3].times * 10 % 10) * 10 > 45) {
                    this.$Notice.warning({desc: "調整繰越時間数は0.15単位で入力してください。"})

                    return false;
                }

                // 調整付与時間が(週平均勤務時間 - 15分)より大きい場合は入力エラー
                // ただし、調整時間が0の場合は、チェック不要
                if (this.paidNowData[3].times > 0 && this.paidNowData[3].times >= this.dataDetail.navgworktimeCalc) {
                    this.$Notice.warning({desc: "調整付与時間数は週平均勤務時間数を超える値は入力できません。(0～" + this.dataDetail.navgworktimeCalc + ")"})
                    return false;
                }

                // 繰越調整時間が(週平均勤務時間 - 15分)より大きい場合は入力エラー
                if (this.paidNowData[4].times > 0 && this.paidNowData[4].times >= this.dataDetail.navgworktimeCalc) {
                    //繰越調整時間は週平均勤務時間を超える時間は入力できません。(0～
                    this.$Notice.warning({desc: "調整繰越時間数は週平均勤務時間数を超える値は入力できません。(0～" + this.dataDetail.navgworktimeCalc + ")"})
                    return false;
                }

                // 調整付与時間数、前期繰越時間数、調整繰越時間数の合計チェック
                if (
                    this.toHoursFromMinutes(
                        this.toMinuteFromHours(this.paidNowData[3].times) +
                        this.toMinuteFromHours(this.paidNowData[4].times) +
                        this.toMinuteFromHours(this.paidNowData[1].times)
                    ) > 0 &&
                    this.toHoursFromMinutes(
                        this.toMinuteFromHours(this.paidNowData[3].times) +
                        this.toMinuteFromHours(this.paidNowData[4].times) +
                        this.toMinuteFromHours(this.paidNowData[1].times)
                    ) >= this.dataDetail.navgworktimeCalc) {
                    //調整付与時間数、前期繰越時間数、調整繰越時間数の合計が週平均勤務時間数を超えないようにして下さい。(0～
                    this.$Notice.warning({desc: "調整付与時間数、前期繰越時間数、調整繰越時間数の合計が週平均勤務時間数を超えないようにして下さい。(0～" + this.dataDetail.navgworktimeCalc + ")"})

                    return false;
                }

                // 調整付与日数と今期付与日数の合計
                // if (parseInt(this.paidNowData[0].days) + parseInt(this.paidNowData[3].days) > 100) {
                //     // MSG_NO_OVER_SUM_HUYO
                //     this.$Notice.warning({desc: "調整付与日数と今期付与日数の合計は100を超えないようにして下さい。"})
                //
                //     return false;
                // }
                // 調整繰越日数と前期繰越日数の合計
                // if (parseInt(this.paidNowData[1].days) + parseInt(this.paidNowData[4].days) > 100) {
                //     // MSG_NO_OVER_SUM_KURIKOSI
                //     this.$Notice.warning({desc: "調整繰越日数と前期繰越日数の合計は100を超えないようにして下さい。"})
                //
                //     return false;
                // }

                // 付与日数の合計
                if (parseInt(+this.paidNowData[0].days) + eval(+this.paidNowData[3].days) < 0) {
                    //MSG_LESS_KIJUNHUYONISSU
                    this.$Notice.warning({desc: "付与日数の合計はマイナスに設定できません。"})
                    return false;
                }

                // 越日数の合計
                if (+parseInt(+this.paidNowData[1].days) + +eval(+this.paidNowData[4].days) < 0) {
                    //MSG_LESS_TYOSEIKURIKOSINISSU
                    this.$Notice.warning({desc: "繰越日数の合計はマイナスに設定できません。"})
                    return false;
                }

                // 有効期限（調整付与）
                if (this.toNumber(this.paidNowData[3].days) !== 0 || this.toNumber(this.paidNowData[3].times) !== 0) {
                    // 未入力
                    if (this.paidNowData[3].expiryDate == null) {
                        // MSG_NO_INPUT_EXPIRE

                        this.$Notice.warning({desc: "有効期限（調整付与）を入力してください。"})

                        return false;
                    }
                    // // 	形式チェック
                    // if (!this.date_check(this.paidNowData[3].expiryDate)) {
                    //     //MSG_NO_DATE_EXPIRE
                    //     this.$Notice.warning({desc: "有効期限（調整付与）はyyyy/mm/dd形式で入力してください。"})
                    //
                    //     return false;
                    // }
                    //付与日チェック
                    if (this.daysBetween(this.dataDetail.dyyyymmdd, this.paidNowData[3].expiryDate) < 0) {
                        // MSG_BEFORE_EXPIRE
                        this.$Notice.warning({desc: "有効期限（調整付与）は付与日以降の日付を指定してください。"})
                        return false;
                    }

                }
                //有効期限（調整繰越）
                if (this.toNumber(this.paidNowData[4].days) !== 0 || this.toNumber(this.paidNowData[4].times) !== 0) {

                    // 未入力
                    if (this.paidNowData[4].expiryDate == null) {
                        // MSG_NO_INPUT_EXPIRE_TO

                        this.$Notice.warning({desc: "有効期限（調整繰越）を入力してください。"})

                        return false;
                    }
                    // // 	形式チェック
                    // if (!this.date_check(this.paidNowData[4].expiryDate)) {
                    //     //MSG_NO_DATE_EXPIRE_TO
                    //     this.$Notice.warning({desc: "有効期限（調整繰越）はyyyy/mm/dd形式で入力してください。"})
                    //
                    //     return false;
                    // }
                    //付与日チェック
                    if (this.daysBetween(this.dataDetail.dyyyymmdd, this.paidNowData[4].expiryDate) < 0) {
                        // MSG_BEFORE_EXPIRE_TO
                        this.$Notice.warning({desc: "有効期限（調整繰越）は付与日以降の日付を指定してください。"})
                        return false;
                    }
                }

                // 変更者コメント
                if (!this.length_check(this.dataDetail.ccomment, '3', 1000)) {

                    // MSG_LONG_COMMENT
                    this.$Notice.warning({desc: "変更者コメントは半角1000文字、全角500文字以内で入力してください。"})
                    return false;
                }

                return true

            },
            toMinuteFromHours(pHours) {
                let nMin = (Math.floor(Math.abs(pHours)) * 60) + Math.floor(Math.abs(pHours) * 1000 / 10 % 100);
                if (0 > pHours) {
                    nMin = nMin * -1;
                }
                return nMin;
            },
            checkError() {

                // 未入力チェック
                // 調整付与日数
                if (this.paidNowData[3].days === '') {
                    this.$Notice.warning({desc: "調整付与日数を入力してください。"})
                    return false
                }
                // 調整付与時間数
                if (this.paidNowData[3].times === '') {
                    this.$Notice.warning({desc: "調整付与時間数を入力してください。"})
                    return false
                }
                // 調整繰越日数
                if (this.paidNowData[4].days === '') {
                    this.$Notice.warning({desc: "調整繰越日数を入力してください。"})
                    return false
                }
                // 調整繰越時間数
                if (this.paidNowData[4].times === '') {
                    this.$Notice.warning({desc: "調整繰越時間数を入力してください。"})
                    return false
                }

                //整数チェック
                // 調整付与日数
                if (isNaN(this.paidNowData[3].days) || this.paidNowData[3].days % 0.5 > 0) {
                    this.$Notice.warning({desc: "調整付与日数は半休単位(0.5)で入力してください。"})
                    return false;
                }
                //調整付与時間数
                if (isNaN(this.paidNowData[3].times)) {
                    this.$Notice.warning({desc: "調整付与時間数には０以上の数を指定してください。"})
                    return false;
                }
                // 調整繰越日数
                if (isNaN(this.paidNowData[4].days) || this.paidNowData[4].days % 0.5 > 0) {
                    this.$Notice.warning({desc: "調整繰越日数は半休単位(0.5)で入力してください。"})
                    return false;
                }
                //調整繰越時間数
                if (isNaN(this.paidNowData[4].times)) {
                    this.$Notice.warning({desc: "調整繰越時間数には０以上の数を指定してください。"})
                    return false;
                }


                // 調整付与時間数
                if (!this.numeric_check(this.paidNowData[3].times * 1000 / 10) ||
                    this.toMinuteFromHours(this.paidNowData[3].times) % 15 > 0 ||
                    (this.paidNowData[3].times * 10 % 10) * 10 > 45) {
                    this.$Notice.warning({desc: "調整付与時間数は0.15単位で入力してください。"})

                    return false;
                }

                // 調整繰越時間数
                if (!this.numeric_check(this.paidNowData[4].times * 1000 / 10) ||
                    this.toMinuteFromHours(this.paidNowData[4].times) % 15 > 0 ||
                    (this.paidNowData[3].times * 10 % 10) * 10 > 45) {
                    this.$Notice.warning({desc: "調整繰越時間数は0.15単位で入力してください。"})

                    return false;
                }

                // 調整付与時間が(週平均勤務時間 - 15分)より大きい場合は入力エラー
                // ただし、調整時間が0の場合は、チェック不要
                if (this.paidNowData[3].times > 0 && this.paidNowData[3].times >= this.dataDetail.navgworktimeCalc) {
                    this.$Notice.warning({desc: "調整付与時間数は週平均勤務時間数を超える値は入力できません。(0～" + this.dataDetail.navgworktimeCalc + ")"})
                    return false;
                }

                // 繰越調整時間が(週平均勤務時間 - 15分)より大きい場合は入力エラー
                if (this.paidNowData[4].times > 0 && this.paidNowData[4].times >= this.dataDetail.navgworktimeCalc) {
                    //繰越調整時間は週平均勤務時間を超える時間は入力できません。(0～
                    this.$Notice.warning({desc: "調整繰越時間数は週平均勤務時間数を超える値は入力できません。(0～" + this.dataDetail.navgworktimeCalc + ")"})
                    return false;
                }

                // 調整付与時間数、前期繰越時間数、調整繰越時間数の合計チェック
                if (
                    this.toHoursFromMinutes(
                        this.toMinuteFromHours(this.paidNowData[3].times) +
                        this.toMinuteFromHours(this.paidNowData[4].times) +
                        this.toMinuteFromHours(this.paidNowData[1].times)
                    ) > 0 &&
                    this.toHoursFromMinutes(
                        this.toMinuteFromHours(this.paidNowData[3].times) +
                        this.toMinuteFromHours(this.paidNowData[4].times) +
                        this.toMinuteFromHours(this.paidNowData[1].times)
                    ) >= this.dataDetail.navgworktimeCalc) {
                    //調整付与時間数、前期繰越時間数、調整繰越時間数の合計が週平均勤務時間数を超えないようにして下さい。(0～
                    this.$Notice.warning({desc: "調整付与時間数、前期繰越時間数、調整繰越時間数の合計が週平均勤務時間数を超えないようにして下さい。(0～" + this.dataDetail.navgworktimeCalc + ")"})

                    return false;
                }

                // 調整付与日数と今期付与日数の合計
                // if (parseInt(this.paidNowData[0].days) + parseInt(this.paidNowData[3].days) > 100) {
                //     // MSG_NO_OVER_SUM_HUYO
                //     this.$Notice.warning({desc: "調整付与日数と今期付与日数の合計は100を超えないようにして下さい。"})
                //
                //     return false;
                // }
                // 調整繰越日数と前期繰越日数の合計
                // if (parseInt(this.paidNowData[1].days) + parseInt(this.paidNowData[4].days) > 100) {
                //     // MSG_NO_OVER_SUM_KURIKOSI
                //     this.$Notice.warning({desc: "調整繰越日数と前期繰越日数の合計は100を超えないようにして下さい。"})
                //
                //     return false;
                // }

                // 付与日数の合計
                if (parseInt(+this.paidNowData[0].days) + eval(+this.paidNowData[3].days) < 0) {
                    //MSG_LESS_KIJUNHUYONISSU
                    this.$Notice.warning({desc: "付与日数の合計はマイナスに設定できません。"})
                    return false;
                }

                // 越日数の合計
                if (+parseInt(+this.paidNowData[1].days) + +eval(+this.paidNowData[4].days) < 0) {
                    //MSG_LESS_TYOSEIKURIKOSINISSU
                    this.$Notice.warning({desc: "繰越日数の合計はマイナスに設定できません。"})
                    return false;
                }

                // 有効期限（調整付与）
                if (this.toNumber(this.paidNowData[3].days) !== 0 || this.toNumber(this.paidNowData[3].times) !== 0) {
                    // 未入力
                    if (this.paidNowData[3].expiryDate == null) {
                        // MSG_NO_INPUT_EXPIRE

                        this.$Notice.warning({desc: "有効期限（調整付与）を入力してください。"})

                        return false;
                    }
                    // // 	形式チェック
                    // if (!this.date_check(this.paidNowData[3].expiryDate)) {
                    //     //MSG_NO_DATE_EXPIRE
                    //     this.$Notice.warning({desc: "有効期限（調整付与）はyyyy/mm/dd形式で入力してください。"})
                    //
                    //     return false;
                    // }
                    //付与日チェック
                    if (this.daysBetween(this.dataDetail.dyyyymmdd, this.paidNowData[3].expiryDate) < 0) {
                        // MSG_BEFORE_EXPIRE
                        this.$Notice.warning({desc: "有効期限（調整付与）は付与日以降の日付を指定してください。"})
                        return false;
                    }

                }
                //有効期限（調整繰越）
                if (this.toNumber(this.paidNowData[4].days) !== 0 || this.toNumber(this.paidNowData[4].times) !== 0) {

                    // 未入力
                    if (this.paidNowData[4].expiryDate == null) {
                        // MSG_NO_INPUT_EXPIRE_TO

                        this.$Notice.warning({desc: "有効期限（調整繰越）を入力してください。"})

                        return false;
                    }
                    // // 	形式チェック
                    // if (!this.date_check(this.paidNowData[4].expiryDate)) {
                    //     //MSG_NO_DATE_EXPIRE_TO
                    //     this.$Notice.warning({desc: "有効期限（調整繰越）はyyyy/mm/dd形式で入力してください。"})
                    //
                    //     return false;
                    // }
                    //付与日チェック
                    if (this.daysBetween(this.dataDetail.dyyyymmdd, this.paidNowData[4].expiryDate) < 0) {
                        // MSG_BEFORE_EXPIRE_TO
                        this.$Notice.warning({desc: "有効期限（調整繰越）は付与日以降の日付を指定してください。"})
                        return false;
                    }
                }

                // 変更者コメント
                if (!this.length_check(this.dataDetail.ccomment, '3', 1000)) {

                    // MSG_LONG_COMMENT
                    this.$Notice.warning({desc: "変更者コメントは半角1000文字、全角500文字以内で入力してください。"})
                    return false;
                }

                return true

            },
            toHoursFromMinutes(pMin) {
                let nHours = Math.floor(Math.abs(pMin) / 60) + (Math.floor(Math.abs(pMin) % 60) / 100);
                if (0 > pMin) {
                    nHours = nHours * -1;
                }
                return nHours;
            },
            numeric_check(pValue) {
                let parm1 = pValue;

                for (let i = 0; i < parm1.length; i++) {

                    if (i === 0) {
                        if (parm1.substring(i, i + 1) !== "-" && (parm1.substring(i, i + 1) < "0" || parm1.substring(i, i + 1) > "9")) {
                            return false;
                        }
                    } else if (parm1.substring(i, i + 1) < "0" || parm1.substring(i, i + 1) > "9") {
                        return false;
                    }
                }
                return true;
            },
            toNumber(Ps_para) {
                let Ln_result = '';
                let Ln_offset = Ps_para.length;
                let Ln_point;
                let Ln_j
                // \記号を除く
                if (Ps_para.charAt(0) === '\\') {
                    Ps_para = Ps_para.substring(1, Ps_para.length);
                }
                // サインをチェック
                if (Ps_para.charAt(Ps_para.length - 1) === '-') {
                    Ln_offset = Ps_para.length - 1;
                }
                // 小数点のチェック
                Ln_point = Ps_para.lastIndexOf('.', Ln_offset);
                if (Ln_point >= 0) {
                    Ln_result = Ps_para.substring(Ln_point + 1, Ln_offset);
                    if (this.numeric_check(Ln_result) === true) {
                        Ln_result = '.' + Ln_result;
                        Ln_point = Ln_point - 1;
                    } else {
                        return (false);
                    }
                } else {
                    Ln_point = Ln_offset - 1;
                }

                for (let Ln_i = Ln_point; Ln_i >= 0;) {
                    for (Ln_j = 0; Ln_j < 3; Ln_j++) {
                        if ((this.numeric_check(Ps_para.charAt(Ln_i)) === true) ||
                            ((Ps_para.charAt(Ln_i) === '-') && (Ln_i === 0))) {
                            Ln_result = Ps_para.charAt(Ln_i--) + Ln_result;
                        } else {
                            return (false);//			 illegal value
                        }
                        if (Ln_i < 0) {
                            break;
                        }
                    }
                    if ((Ln_j == 3) && (Ps_para.charAt(Ln_i) === ',')) {
                        Ln_i = Ln_i - 1;
                    }
                }
                if (Ln_offset === Ps_para.length - 1) {//		 back sign
                    if (Ln_result.charAt(0) !== '-') {
                        Ln_result = '-' + Ln_result;
                    } else {
                        return (false);
                    }
                }
                Ln_result = parseFloat(Ln_result);
                return (Ln_result);
            },
            date_check(psDate) {
                let y;
                let m;
                let d;
                let sy, sm, sd;

                /* null チェック */
                if (psDate === void (0) || psDate === null || psDate === "") {
                    return false;
                }
                /* 形式チェック（9999/#9/#9） */
                if (!psDate.match(/^(\d\d\d\d)\/(\d?\d)\/(\d?\d)$/)) {
                    return false;
                }
                /* 年、月、日の範囲チェック */
                y = parseInt(RegExp.$1, 10);
                m = parseInt(RegExp.$2, 10);
                d = parseInt(RegExp.$3, 10);
                // 年：1900～2222
                if (y < 1900 || y > 2222) {
                    return false;
                }
                // 月：1～12
                if (m < 1 || m > 12) {
                    return false;
                }
                // 日：1～月末
                if (d < 1 || d > this.lastDate(y, m)) {
                    return false;
                }

                sy = "" + y;
                sm = "" + m;
                if (m < 10) {
                    sm = "0" + m;
                }
                sd = "" + d;
                if (d < 10) {
                    sd = "0" + d;
                }
                return "" + sy + sm + sd;
            },
            daysBetween(pDate1, pDate2) {
                let date1 = this.toDate(pDate1);
                let date2 = this.toDate(pDate2);
                let day = (date2 - date1) / 1000 / 60 / 60 / 24;
                return day;
            },
            toDate(pDate) {

                let dateArr = Utils.formatDate(pDate, 'yyyy/mm/dd').split("/");

                for (let i = dateArr.length; i < 3; i++) {
                    dateArr[i] = 1;
                }
                let date = new Date(dateArr[0], dateArr[1] - 1, dateArr[2]);
                return date;
            },
            lastDate(Pn_yyyy, Pn_mm) {
                let Ln_last = new Array(0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);

                if ((Pn_yyyy % 400 === 0) || ((Pn_yyyy % 4 === 0) && !(Pn_yyyy % 100 === 0))) {
                    Ln_last[2] = 29;
                }
                return (Ln_last[eval(Pn_mm)]);
            },
            getLengthB(moji) {

                let i, j, cnt = 0;

                // "§", "¨", "°", "±", "´", "¶"を追加。2005.08.22 Oyama
                let multiStr = new Array("×", "§", "¨", "°", "±", "´", "¶");

                for (i = 0; i < moji.length; i++) {
                    for (j = 0; j < multiStr.length; j++) {
                        if (multiStr[j].length == 0) {
                            continue;
                        }
                        moji = moji.replace(multiStr[j], "00");
                    }
                }

                // MAC OSの場合、改行コードが「\n」となり、Windowsの改行コード「\r\n」とバイト数が異なるので、
                // 改行コードは「\r\n」で桁数を計算する様にする。
                moji = moji.split("\r\n").join("\n"); // 一旦「\r\n」 ⇒ 「\n」の変換を行い、改行コードを「\n」に合わせる。
                moji = moji.split("\n").join("\r\n"); // 「\n」 ⇒ 「\r\n」の変換を行い、改行コード全てを「\r\n」にする。

                // バイト数を求めます。
                for (i = 0; i < moji.length; i++)
                    if (escape(moji.charAt(i)).length >= 4) cnt += 2; else cnt++;
                return cnt;

            },
            length_check(Ps_para, Pn_type, Pn_keta) {
                if (!Ps_para) return true

                let Ln_length = this.getLengthB(Ps_para)
                if (Ln_length > Pn_keta)
                    return false
                else
                    return true
            },
            format_hours(sHours, nLowerLength) {
                try {

                    return eval(sHours).toFixed(nLowerLength);
                } catch (e) {
                    return sHours;
                }
            },
            displayJudgment(days, times) {
                if (days != 0.0 && times != 0.00) {
                    return true;
                }
                return false;
            },
            //初期化処理
            async getInit() {
                //console.log("getInit")
                //console.log([[${ session.txtTmgReferListTreeViewAdminTargetSection }]])
                //console.log(this.referListObject)

                this.referListObject.txtTmgReferListTreeViewRecordDate = Utils.formatDate([[${ session.TmgReferListSYSDATE }]], 'yyyy/mm/dd')
                await this.getOrgTree()
                this.getSearchCondition()

                //検索の初期化対応 add by chenyl
                this.query.hidSelectTab = [[${ session.hidSelectTab }]]
                this.query.hidSearchItems = [[${ session.hidSearchItems }]]
                this.query.hidSearchCondition = [[${ session.hidSearchCondition }]]
                this.query.hidSearchData = [[${ session.hidSearchData }]]

                this.referListObject.hidSelectTab = [[${ session.hidSelectTab }]]
                this.referListObject.hidSearchItems = [[${ session.hidSearchItems }]] || 'EMPLOYEEID'
                this.referListObject.hidSearchCondition = [[${ session.hidSearchCondition }]] || 'BROADMATCH'
                this.referListObject.hidSearchData = [[${ session.hidSearchData }]]

                this.targetAdminSection = ''
                this.targetAdminSection = [[${ session.txtTmgReferListTreeViewAdminTargetSection }]]
                this.loginDesignationSection = [[${ session.psSession.loginDesignation[0].section }]]
                //　初回管理サイトの画面にアクセスするなら、targetSectionがnullであることから、下記通りでデフォルト所属を設定する
                // １．ログインユーザが本人所属部署の管理権限がある場合、ログインユーザの所属部署をデフォルト所属とする。
                // ２．ログインユーザが本人所属部署の管理権限がない場合、ログインユーザの管理対象部署のTOP部署をデフォルト所属とする
                // console.log("getDeptCode")
                // console.log(this.loginDesignationSection)
                // console.log(this.targetAdminSection)

                if (this.targetAdminSection == null || this.targetAdminSection == '') {
                    this.getDeptCode(this.treeData)
                    if (this.targetAdminSectionFlag) {
                        console.log("getDeptCode_true")
                        this.deptName = [[${ session.psSession.loginDesignation[0].sectionName }]]
                        this.referListObject.txtTmgReferListTreeViewAdminTargetSection = [[${ session.psSession.loginDesignation[0].section }]]
                        this.referListObject.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        this.referListObject.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        // add by chenyl
                        this.query.txtTmgReferListTreeViewAdminTargetSection = [[${ session.psSession.loginDesignation[0].section }]]
                        this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        this.query.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    } else {
                        console.log("getDeptCode_false")
                        this.deptName = this.treeData[0].children[0].secnic
                        this.referListObject.txtTmgReferListTreeViewAdminTargetSection = this.treeData[0].children[0].secid
                        this.referListObject.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        this.referListObject.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        // add by chenyl
                        this.query.txtTmgReferListTreeViewAdminTargetSection = [[${ session.psSession.loginDesignation[0].section }]]
                        this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        this.query.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate

                    }
                } else {
                    this.deptName = [[${ session.txtTmgReferListTreeViewAdminTargetSectionName }]]
                    this.referListObject.txtTmgReferListTreeViewAdminTargetSection = [[${ session.txtTmgReferListTreeViewAdminTargetSection }]]
                    this.referListObject.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    this.referListObject.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    // add by chenyl
                    this.query.txtTmgReferListTreeViewAdminTargetSection = [[${ session.txtTmgReferListTreeViewAdminTargetSection }]]
                    this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    this.query.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                }

                //一覧画面取得
                this.getTableData()
            },
            getDeptCode(data) {
                data.forEach(e => {
                    if (e.secid === this.loginDesignationSection) {
                        this.targetAdminSectionFlag = true
                    } else {
                        const children = e.child || e.children
                        if (children) {
                            this.getDeptCode(children)
                        }
                    }
                })
            },
            // 職員情報取得
            async getApplyEmployPersonalInfo() {
                // 職員情報取得
                const {data} = await this.http.get('sys/vapply/EmployInfo', this.query)
                this.empDeptName = data.section
            },
        },
        el: '.vaction-warp',
        data() {
            return {
                columns: [
                    {
                        title: '氏名',
                        slot: 'name',
                        align: 'right'
                    },
                    {
                        title: '種別',
                        slot: 'workertypenm',
                        minWidth: 250,
                        align: 'left'
                    },
                    {
                        title: '年次休暇付与日',
                        slot: 'tphDyyyymmdd',
                        align: 'center'
                    },
                    {
                        title: '年次休暇付与',
                        children: [
                            {
                                title: '日数',
                                slot: 'investDaysSum',
                                align: 'center'
                            },
                            {
                                title: '時間数',
                                slot: 'investHours',
                                align: 'center'
                            }
                        ]
                    },
                    {
                        title: '年次休暇繰越',
                        children: [
                            {
                                title: '日数',
                                slot: 'throughoutDaysSum',
                                align: 'center'
                            },
                            {
                                title: '時間数',
                                slot: 'throughoutHoursSum',
                                align: 'center'
                            }
                        ]
                    }
                ],
                paidDetailsLoading: false,
                paidDetailsLoadingFlg: 0,
                columns3: [
                    {
                        title: ' ',
                        key: 'name',
                        align: 'center'
                    },
                    {
                        title: '日数',
                        slot: 'days',
                        align: 'center'
                    },
                    {
                        title: '時間数',
                        slot: 'times',
                        align: 'center'
                    },
                    {
                        title: '有効期限',
                        align: 'center',
                        width: 140,
                        slot: 'expiryDate'
                    }
                ],
                data: [],
                loading: false,
                updateLoading: false,
                referListObject: {
                    txtTmgReferListTreeViewRecordDate: '',
                    txtTmgReferListTreeViewAdminTargetSection: '',
                    [[${ TREEVIEW_KEY_ADMIN_TARGET_SECTION }]]: '',
                    [[${ TREEVIEW_KEY_ADMIN_TARGET_EMP }]]: '',
                    [[${ TREEVIEW_KEY_RECORD_DATE }]]: '',
                    hidSearchItems: 'EMPLOYEEID',
                    hidSearchCondition: 'BROADMATCH',
                    hidSearchData: '',
                    hidSelectTab: '0',
                    psSite: Utils.getUrlParam(location.href, 'psSite'),
                    psApp: Utils.getUrlParam(location.href, 'psApp'),
                    type: 31
                },
                paidDetailsColumns: [
                    {
                        title: '年次休暇付与日',
                        slot: 'dyyyymmdd',
                        width: 120,
                        align: 'center'
                    },
                    {
                        title: '今期付与日数',
                        slot: 'ninvest',
                        width: 120,
                        align: 'center'
                    },
                    {
                        title: '調整付与',
                        children: [
                            {
                                title: '日数',
                                slot: 'nadjust',
                                align: 'center'
                            },
                            {
                                title: '時間数',
                                slot: 'nadjustHours',
                                align: 'center'
                            }
                        ]
                    },
                    {
                        title: '前期繰越',
                        children: [
                            {
                                title: '日数',
                                slot: 'nthroughout',
                                align: 'center'
                            },
                            {
                                title: '時間数',
                                slot: 'nthroughoutHours',
                                align: 'center'
                            }
                        ]
                    },
                    {
                        title: '調整繰越',
                        children: [
                            {
                                title: '日数',
                                slot: 'nadjustTo',
                                align: 'center'
                            },
                            {
                                title: '時間数',
                                slot: 'nadjustHoursTo',
                                align: 'center'
                            }
                        ]
                    },
                    {
                        title: '合計',
                        children: [
                            {
                                title: '日数',
                                slot: 'ninvestDays',
                                align: 'center'
                            },
                            {
                                title: '時間数',
                                slot: 'ninvestHours',
                                align: 'center'
                            }
                        ]
                    }
                ],
                //selectedTab: 'organisationTree',
                searchTypesList: [],     //組織ツリー用
                searchConditionsList: [],//組織ツリー用
                // hidSearchData: '',
                paidNowLoading: false,
                paidDetailsData: [],
                isSearchHistory: false,
                empDeptLoading: false,
                deptDrawShow: false,
                treeData: [],
                deptName: '選んでください',
                empDeptName: this.deptName,
                paidHolidayInitRList: false,
                isShow: false,
                contentScrollTop: 0,
                title: '',
                name: '',
                tphDyyyymmdd: '',
                workertypenm: '',
                cemployeeid: '',
                param: {
                    txtDate: '',
                    txtUserCode: '',
                    txtTmgReferListTreeViewAdminTargetEmp: '',
                    psSite: Utils.getUrlParam(location.href, 'psSite'),
                    psApp: Utils.getUrlParam(location.href, 'psApp'),
                    type: 31
                },
                paramters: {
                    txtDate: '',
                    cemployeeid: '',
                    ninvest: '',
                    dyyyymmdd: '',
                    nadjust: '',
                    nadjustHours: '',
                    nadjustTo: '',
                    nadjustHoursTo: '',
                    dexpireAdjust: '',
                    dexpireAdjustTo: '',
                    ccomment: ''
                },
                dataDetailBack: [],
                dataDetail: {
                    dyyyymmdd: '',
                    dyyyymmddEnd: '',
                    ninvest: '',
                    nthroughout: '',
                    nthroughoutHours: '',
                    nadjust: '',
                    nadjustHours: '',
                    nadjustTo: '',
                    nadjustHoursTo: '',
                    ninvestDays: '',
                    ninvestHours: '',
                    nconfirm: '',
                    nplanworkday: '',
                    nplanworkdayLimit: '',
                    npaidUsedDays: '',
                    npaidUsedHours: '',
                    npaidRestDays: '',
                    npaidRestHours: '',
                    dbegindateWork: '',
                    cworkingdaysWeekName: '',
                    navgworktimeCalc: '',
                    navgworktimeDisp: '',
                    dexpireInvest: '',
                    dexpireAdjust: '',
                    dexpireAdjustTo: '',
                    nloseDays: '',
                    nloseHours: '',
                    ccomment: ''
                },
                query: {
                    hidSearchItems: [[${ session.SearchItems }]],     //検索種別
                    hidSearchCondition: [[${ session.SearchCondition }]], //検索条件
                    hidSearchData: [[${ session.SearchData }]],      //検索対象
                    hidSelectTab: [[${ session.hidSelectTab }]] === 1 ? '1' : '0',
                    txtTmgReferListTreeViewRecordDate: '',
                    txtTmgReferListTreeViewAdminTargetSection: '',
                    txtTmgReferListTreeViewAdminTargetEmp: '',
                    recordDate: '',
                    psSite: Utils.getUrlParam(location.href, 'psSite'),
                    psApp: Utils.getUrlParam(location.href, 'psApp')
                },
                currentTab: [[${ session.hidSelectTab }]] === 1 ? "organisationSearch" : "organisationTree",         //組織のツリーと検索タブーを切り替え
            }
        },
        computed: {
            tableHeadFixed() {
                if (this.contentScrollTop > 180) return true
                else return false
            },
            paidNowData() {
                return [
                    {
                        name: '今期付与',
                        days: this.dataDetail.ninvest,
                        times: '',
                        cellClassName: {name: 'rest-title'},
                        expiryDate: this.dataDetail.dexpireInvest
                    },
                    {
                        name: '前期繰越',
                        days: this.dataDetail.nthroughout,
                        cellClassName: {name: 'rest-title'},
                        times: this.dataDetail.nthroughoutHours
                    },
                    {
                        name: '喪失',
                        cellClassName: {name: 'rest-title'},
                        days: this.dataDetail.nloseDays,
                        times: this.dataDetail.nloseHours
                    },
                    {
                        name: '調整付与',
                        days: this.format_hours(this.dataDetail.nadjust, 1),
                        cellClassName: {name: 'rest-title'},
                        isEditable: true,
                        times: this.format_hours(this.dataDetail.nadjustHours, 2),
                        expiryDate: this.dataDetail.dexpireAdjust
                    },
                    {
                        name: '調整繰越',
                        days: this.format_hours(this.dataDetail.nadjustTo, 1),
                        cellClassName: {name: 'rest-title'},
                        isEditable: true,
                        times: this.format_hours(this.dataDetail.nadjustHoursTo, 2),
                        expiryDate: this.dataDetail.dexpireAdjustTo
                    },
                    {
                        name: '合計付与',
                        days: this.dataDetail.ninvestDays,
                        cellClassName: {name: 'rest-title', days: 'sub-title'},

                        times: this.dataDetail.ninvestHours
                    },
                    {
                        name: '今期取得/残情報',
                        cellClassName: {name: 'rest-title'}
                    },
                    {
                        name: '今期取得',
                        cellClassName: {name: 'rest-title'},
                        days: this.dataDetail.npaidUsedDays,
                        times: this.dataDetail.npaidUsedHours
                    },
                    {
                        name: '今期残',
                        cellClassName: {name: 'rest-title'},
                        days: this.dataDetail.npaidRestDays,
                        times: this.dataDetail.npaidRestHours
                    }
                ]
            }
        },
        async mounted() {
            await this.getInit()
            window.addEventListener('scroll',this.handleScroll,{ passive: true })
        }
    })
</script>
</body>

</html>