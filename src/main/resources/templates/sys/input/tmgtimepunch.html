<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/header::common_header(title='ホームページ',cssPaths='/pages/content.min.css,' + '/pages/sign.min.css')">
</head>

<body th:with="baseUrl = ${#httpServletRequest.getScheme() + '://' + #httpServletRequest.getServerName() + ':' + #request.getServerPort()  + #request.getContextPath()},
      now = ${new java.util.Date().getTime()
    }">
<div th:replace="layout/loadingBar::loadingBar"></div>
<!-- 菜单导航栏 -->
<div th:replace="layout/sider"></div>
<main class="content">
    <Row class="stamp-warp tc" ref="stamp">
        <i-col span="8" offset="1">
            <Clock ref="clock"></Clock>
            <Row :gutter="16" style="padding: 0 20px;">
                <i-col span="12">
                    <i-button class="gowork-btn" type="primary" @click="clock('ACT_EXEC_OPEN')" :loading="clocking" :disabled="clockDisable" long>{{ clockBtn.clock }}
                    </i-button>
                </i-col>
                <i-col span="12" class="mb20">
                    <i-button class="offwork-btn" type="primary" @click="clock('ACT_EXEC_CLOSE')" :loading="exiting" :disabled="clockDisable" long>{{ clockBtn.exit }}
                    </i-button>
                </i-col>
                <i-col span="24">
                    <i-button class="addwork-btn" type="primary" ghost @click="showDay(null)" 　:disabled="discretionDisable" long>超過勤務申請</i-button>
                </i-col>
            </Row>
        </i-col>
        <i-col span="13" class="pl20 pt5">
            <Carousel :loop="cardData.length > 1">
                <carousel-item v-for="item of cardData">
                    <Row>
                        <i-col span="11" class="card" style="margin: 15px 10px 10px 15px;">
                            <div class="title">{{ item[0] && item[0].title || '--- ---' }}</div>
                            <span v-if="item[0] && item[0].num.length > 0">
                                <span v-for="(detail, i) of item[0].num">
                                    <span class="num">{{ item[0].num[i] }}</span><span class="mr5 lp">{{ item[0].unit[i] }}</span>
                                </span>
                            </span>
                            <span class="num" v-else>-- --</span>
                        </i-col>
                        <i-col span="11" class="card" style="margin: 15px 10px 10px 10px;">
                            <div class="title">{{ item[1] && item[1].title || '--- ---' }}</div>
                            <span v-if="item[1] && item[1].num.length > 0">
                                <span v-for="(detail, i) of item[1].num">
                                    <span class="num">{{ item[1].num[i] }}</span><span class="mr5 lp">{{ item[1].unit[i] }}</span>
                                </span>
                            </span>
                            <span class="num" v-else>-- --</span>
                        </i-col>
                        <i-col span="11" class="card" style="margin: 10px 10px 15px 15px;">
                            <div class="title">{{ item[2] && item[2].title || '--- ---' }}</div>
                            <span v-if="item[2] && item[2].num.length > 0">
                                <span v-for="(detail, i) of item[2].num">
                                    <span class="num">{{ item[2].num[i] }}</span><span class="mr5 lp">{{ item[2].unit[i] }}</span>
                                </span>
                            </span>
                            <span class="num" v-else>-- --</span>
                        </i-col>
                        <i-col span="11" class="card" style="margin: 10px 10px 15px 10px;">
                            <div class="title">{{ item[3] && item[3].title || '--- ---' }}</div>
                            <span v-if="item[3] && item[3].num.length > 0">
                                <span v-for="(detail, i) of item[3].num">
                                    <span class="num">{{ item[3].num[i] }}</span><span class="mr5 lp">{{ item[3].unit[i] }}</span>
                                </span>
                            </span>
                            <span class="num" v-else>-- --</span>
                        </i-col>
                    </Row>
                </carousel-item>
            </Carousel>
        </i-col>
        <i-col span="21" class="mt30" style="margin-left: 5.5%;width: 83.7%;">
            <div class="schedule">
                <div class="title-wrap">
                    <div class="time-title">時間</div>
                    <div class="plan-title">本日の勤務予定</div>
                </div>
                <ul class="time-list">
                    <li v-model="scheduleTime" class="li" v-for="(item, i) of scheduleTime" :key="i"><span style="width:14.44px; text-align:center;  display:inline-block; margin-left: -5px;">{{ item }}</span>
                    </li>
                    <abbr :class="isActivated ? 'real-schedule stamp-actived' : 'real-schedule stamp-deactived'" v-for="(item, i) of dynamicSchedule" :key="i" :style="item.style">
                        <Tooltip trigger="hover" :theme="toolTipTheme()" transfer><b>{{ item.style.width.split('px')[0] > 100 ? item.time : '~' }}</b>
                            <div slot="content">予定勤務時間:<br/>{{ item.time }}</div>
                        </Tooltip>
                    </abbr>
                    <abbr v-model="overWorkData" :class="isOverActivated ? 'real-schedule-overwork stamp-actived' : 'real-schedule-overwork'"
                          v-for="(item, i) of dynamicSchedule2" :key="i" :style="item.style">
                        <Tooltip trigger="hover" :theme="toolTipTheme()" transfer><b>{{ item.style.width.split('px')[0] > 100 ? item.time : '~' }}</b>
                            <div slot="content">超過勤務時間:<br/>{{ item.time }}</div>
                        </Tooltip>
                    </abbr>
                </ul>
            </div>
        </i-col>
        <!--日次就業実績-->
        <Drawer :title="title" width="850" v-model="isShow" @on-close="handleClose()" :mask-closable="false">
            <div style="position: relative">
                <Alert type="error" class="error-info" v-show="errorFlag">{{ errorMsg }}</Alert>
                <div class="mb15 tr">
                    <i-button type="primary" ghost class="mr10" v-if="!bFixed" icon="md-chatbubbles" @click="updateInp">コメントのみ登録</i-button>
                    <i-button type="primary" ghost v-if="!bFixed" @click="updateDaily" icon="md-done-all" :loading="updateDailyLoading">
                        登録
                    </i-button>
                </div>
                <div class="titlenorm mb10">
                    <Icon type="logo-buffer"></Icon>
                    就業実績
                </div>
                <div class="mb15" style="position: relative;">
                    <Row>
                        <i-col span="8" class="label tc">就業区分</i-col>
                        <i-col span="8" class="no-border-radius">
                            <i-select v-model="workingId" ref="select1"
                                      class="mr30 tc" @on-change="changeWorkingID"
                                      v-if="isEdiTableResult4Inp && !bFixed">
                                <i-option v-for="(item, index) of workingIdList" :key="index"
                                          :label="item.mgdCgenericdetaildesc" 　:value="item.mgdCmastercode">
                                </i-option>
                            </i-select>
                            <p class="input-like-span tc" v-else align="center">{{dailyEdit.tdaCworkingidRName}}</p>
                        </i-col>
                    </Row>
                    <Row class="mb5">
                        <i-col span="8" class="label tc">出張</i-col>
                        <i-col span="8" class="no-border-radius" v-if="!bDisable">
                            <i-select v-model="businessTrip" ref="select2"
                                      class="mr30 tc" @on-change="" v-if="(!bHoliday && !bFixed)">
                                <i-option v-for="(item, index) of businessTripList" :key="index"
                                          :label="item.mgdCgenericdetaildesc" 　:value="item.mgdCmastercode">
                                </i-option>
                            </i-select>
                            <p class="input-like-span" v-else align="center">{{dailyEdit.tdaCbusinesstripidRName}}</p>
                        </i-col>
                        <i-col span="8" class="no-border-radius" v-else>
                            <i-select v-model="businessTrip" class="mr30" @on-change="" disabled
                                      v-if="(!bHoliday && !bFixed)">
                                <i-option v-for="(item, index) of businessTripList" :key="index"
                                          :label="item.mgdCgenericdetaildesc" 　:value="item.mgdCmastercode">
                                </i-option>
                            </i-select>
                            <p class="input-like-span" v-else align="center">{{dailyEdit.tdaCbusinesstripidRName}}</p>
                        </i-col>
                    </Row>
                    <i-table :columns="columnsWork" :data="workData" :span-method="handleSpan" :disabled-hover="true">
                        <template slot-scope="{ row, index }" slot="workStart">
                            <i-input v-model="workData[2].workStart" v-if="!bFixed && isEdiTableResult4Inp && row.isResultTime" :disabled="workTimeDisable" class="tc"
                                     @on-blur="handleInputChange(index,  workData[index],'workStart', $event.target)"></i-input>
                            <span v-else>{{ row.workStart }}</span>
                            <i-input class="tl" v-model="dailyEdit.tdaCowncommentR" type="textarea" v-if="row.isOwnComment && !bFixed"></i-input>
                            <span class="tl input-like-span" v-if="row.isOwnComment && bFixed" style="border-radius: 5px; white-space: pre-line;">{{ dailyEdit.tdaCowncommentR}}</span>

                            <span class="tl input-like-span" style="border-radius: 5px; white-space: pre-line;" v-if="row.isBSComment">{{ dailyEdit.tdaCbosscommentR}}
                        </span>
                            <span class="bs-comment-approved" v-if="row.isBSComment && bApproved">{{ dailyEdit.tdaCmodifieruseridR}} ({{dailyEdit.tdaDmodifieddateR }})</span>

                        </template>
                        <template slot-scope="{ row , index}" slot="workEnd">
                            <i-input v-model="workData[2].workEnd"
                                     v-if="!bFixed && isEdiTableResult4Inp && row.isResultTime " :disabled="workTimeDisable" class="tc"
                                     @on-blur="handleInputChange(index,  workData[index],'workEnd', $event.target)"></i-input>
                            <span v-else>{{ row.workEnd }}</span>
                        </template>
                    </i-table>
                </div>


                <!-- 非勤務 -->
                <div class="titlenorm mb10">
                    <Icon type="logo-buffer"></Icon>
                    非勤務
                </div>
                <div class="mb15 tr" v-if="!bHoliday && !bFixed ">
                    <i-select v-model="categoryNonduty" class="mr10" style="display: inline-block;width: 200px;" ref="select3" v-if="!bDisable && categoryNondutyList.length > 0">
                        <i-option v-for="(item, index) of categoryNondutyList" :key="index" :label="item.itemName" :value="item.itemCode">
                        </i-option>
                    </i-select>
                    <!--                <p class="input-like-span tc" v-else>{{categoryNonduty}}</p>-->
                    <i-button type="primary" ghost @click="addNotWork" v-if="!bDisable">追加</i-button>
                    <i-button disabled v-else>追加</i-button>
                </div>
                <i-table :columns="columnsNotWork" :data="detailNonDutyVOList" class="mb20" :disabled-hover="true"
                         no-data-text="">
                    <template slot-scope="{ row, index }" slot="tdadNopen">
                        <i-input v-model="detailNonDutyVOList[index].tdadNopen" v-if=" !bFixed" @on-blur="handleInputChange(index, detailNonDutyVOList[index],'tdadNopen', $event.target)"></i-input>
                        <span v-else>{{  row.tdadNopen | toTime  }}</span>
                    </template>

                    <template slot-scope="{ row, index }" slot="tdadNclose">
                        <i-input v-model="detailNonDutyVOList[index].tdadNclose" v-if="!bFixed " @on-blur="handleInputChange(index, detailNonDutyVOList[index],'tdadNclose', $event.target)"></i-input>
                        <span v-else>{{ row.tdadNclose | toTime }}</span>
                    </template>

                    <template slot-scope="{ row ,index}" slot="tdadCsparechar1">
                        <i-input v-model="detailNonDutyVOList[index].tdadCsparechar1" type="textarea"
                                 :autosize="{ maxRows: 3 }"
                                 v-if="row.tdadCnotworkid !== 'TMG_ITEMS|ResultRest' && !bFixed "></i-input>
                        <span v-else>{{ row.tdadCsparechar1 | toTime }}</span>
                    </template>

                    <template slot-scope="{ row }" slot="tdadNdeleteflg" v-if="!bFixed">
                        <Poptip v-model="lightDelBtnVisible2[row._index]" placement="left" transfer>
                            <div class="operateBtn" slot="content">
                                <a @click="cancelNotWork(row._index)">いいえ</a>
                                <a @click="delNotWork(row, row._index)">はい</a>
                            </div>
                            <i-button type="error" ghost size="small" style="position: relative;left: 3px;width: 60px;">削除</i-button>
                        </Poptip>
                    </template>
                </i-table>

                <div v-if="!isDiscretion">
                    <!-- 超過勤務 -->
                    <div class="titlenorm mb10">
                        <Icon type="logo-buffer"></Icon>
                        超過勤務
                    </div>
                    <div class="mb15 tr" v-if="!bHoliday && !bFixed ">
                        <i-select v-model="categoryOverhours" class="mr10" style="display: inline-block;width: 200px;" @on-change="" ref="select4" v-if="!bDisable && categoryOverhoursList.length>0 ">
                            <i-option v-for="(item, index) of categoryOverhoursList" :key="index" :label="item.itemName" :value="item.itemCode">
                            </i-option>
                        </i-select>
                        <!--                <p class="input-like-span tc" v-else>{{categoryOverhours}}</p>-->
                        <i-button type="primary" ghost @click="addOverWork" v-if="!bDisable">追加</i-button>
                        <i-button disabled v-else>追加</i-button>
                        <!--                <i-col span="4">-->
                        <!--                    <i-button type="primary" ghost v-if="!bDisable">時刻補完</i-button>-->
                        <!--                    <i-button type="primary" ghost disabled v-else>時刻補完</i-button>-->
                        <!--                </i-col>-->
                    </div>

                    <i-table :columns="columnsOverWork" :data="detailOverhoursVOList" class="mb20" :disabled-hover="true"
                             no-data-text="">
                        <template slot-scope="{ row ,index }" slot="tdadNopen">
                            <i-input v-model="detailOverhoursVOList[index].tdadNopen" v-if=" !bFixed"
                                     @on-blur="handleInputChange(index, detailOverhoursVOList[index],'tdadNopen', $event.target)"></i-input>
                            <span v-else>{{ row.tdadNopen | toTime }}</span>
                        </template>

                        <template slot-scope="{ row ,index}" slot="tdadNclose">
                            <i-input v-model="detailOverhoursVOList[index].tdadNclose" v-if=" !bFixed"
                                     @on-blur="handleInputChange(index, detailOverhoursVOList[index],'tdadNclose', $event.target)"></i-input>
                            <span v-else>{{ row.tdadNclose | toTime }}</span>
                        </template>

                        <template slot-scope="{ row ,index}" slot="tdadCsparechar1">
                            <i-input v-model="detailOverhoursVOList[index].tdadCsparechar1" type="textarea"
                                     :autosize="{ maxRows: 3 }"
                                     v-if="!bFixed"></i-input>
                            <span v-else>{{ row.tdadCsparechar1}}</span>
                        </template>

                        <template slot-scope="{ row ,index}" slot="tdadNdeleteflg" v-if="!bFixed">
                            <Poptip v-model="lightDelBtnVisible[row._index]" placement="left" transfer>
                                <div class="operateBtn" slot="content">
                                    <a @click="cancelOverWork(row._index)">いいえ</a>
                                    <a @click="delOverWork(row, row._index)">はい</a>
                                </div>
                                <i-button type="error" ghost size="small" style="position: relative;left: 3px;width: 60px;">削除</i-button>
                            </Poptip>
                        </template>
                    </i-table>
                </div>
                <div class="titlenorm mb10">
                    <Icon type="logo-buffer"></Icon>
                    更新履歴
                </div>
                <i-table :columns="columnsDailyLog" :data="dailyLog" class="mb20" no-data-text="" :disabled-hover="true">
                </i-table>
                <Spin size="large" fix v-if="dailyloading"></Spin>
            </div>
        </Drawer>
    </Row>


</main>
<script th:src="${baseUrl + '/static/component/clock.js'}"></script>
<div th:replace="layout/head::header"></div>
<script th:src="${baseUrl + '/static/lang/input/sign.js?t='+ now}"></script>
<script type="text/babel" th:inline="javascript">
    const SIGN = new Vue({
        el: '.stamp-warp',
        components: {Clock},
        data() {
            return {
                isShow: false,
                data: {
                    serverTime: 0,
                    clockOnTime: '',
                    clockOffTime: '',
                    scheduleStartTime: '',
                    scheduleEndTime: ''
                },
                clockData: {
                    startTime: '',
                    endTime: ''
                },
                clockBtn: {
                    clock: '出勤',
                    exit: '退勤'
                },
                query_clockInfo: {
                    pAction: '',
                    custId: [[${ session.psSession.loginCustomer}]],
                    compCode: [[${ session.psSession.loginCompany}]],
                    language: [[${ session.psSession.language}]],
                    employeId: [[${ session.psSession.loginEmployee }]]
                },
                query_schedule: {
                    custId: [[${ session.psSession.loginCustomer}]],
                    compCode: [[${ session.psSession.loginCompany}]],
                    language: [[${ session.psSession.language}]],
                    employeId: [[${ session.psSession.loginEmployee }]],
                    targetDate: ''
                },
                query_overWork: {
                    custId: [[${ session.psSession.loginCustomer}]],
                    compCode: [[${ session.psSession.loginCompany}]],
                    language: [[${ session.psSession.language}]],
                    employeId: [[${ session.psSession.loginEmployee }]],
                    userCode: [[${ session.psSession.loginEmployee }]]
                },
                scheduleData: ['', ''],
                overWorkData: [''],
                scheduleSection: [5, 29],
                scheduleTime: Utils.getNumArray(5, 29).map(e => e),
                checkInLoading: false,
                checkOutLoading: false,
                loading: false,
                clocking: false,
                exiting: false,
                clockDisable: false,
                discretionDisable: true,
                cardData: [
                    []
                ],
                requestFlag: false,
                monthlyLoading: false,
                dailyloading: false,
                contentScrollTop: 0,
                selectDisabled: false,   　//年月選択可否制御
                lightDelBtnVisible: [],
                lightDelBtnVisible2: [],
                dispMonthlyList: [],       //年月リスト
                model1: '',
                targetUser: '',
                monthlyTilteMapList: [],
                monthlyMap: [],
                columns: [],
                dailyDataList: [],
                data: [],
                loading: false,
                selHealthStatus: 'TMG_ONOFF|0',
                selHealthStatusList: [
                    {
                        code: 'TMG_ONOFF|0',
                        name: 'いない'
                    },
                    {
                        code: 'TMG_ONOFF|1',
                        name: 'いる'
                    }
                ],
                query: {
                    txtDYYYYMMDD: '',
                    txtAction: 'ACT_DISP_RMONTHLY',
                    txtDYYYYMM: '',
                    today: '',
                    selHealthStatus: '',
                    psSite: 'TMG_INP',
                    psApp: 'TmgResults',
                    EmployeeCode: [[${ session.psSession.loginEmployee }]],
                    UserCode: [[${ session.psSession.loginEmployee }]],
                    txtTmgReferListTreeViewPermSelectedView: '',
                    txtTmgReferListTreeViewPermTargetSection: '',
                    txtTmgReferListTreeViewPermTargetGroup: '',
                    txtTmgReferListTreeViewPermTargetEmp: '',
                },
                updateInpQuery: {
                    txtAction: 'ACT_EDITINP_UCOMMENT',
                    holiday: false,
                    txtTdaNopenR: '',
                    txtTdaNcloseR: '',
                    workingId: '',
                    selMgdCbusinessTrip: '',
                    txtDYYYYMMDD: '',
                    tdaCowncommentR: '',
                    psSite: 'TMG_INP',
                    psApp: 'TmgResults',
                    EmployeeCode: [[${ session.psSession.loginEmployee }]],
                    UserCode: [[${ session.psSession.loginEmployee }]],
                    txtTmgReferListTreeViewPermSelectedView: '',
                    txtTmgReferListTreeViewPermTargetSection: '',
                    txtTmgReferListTreeViewPermTargetGroup: '',
                    txtTmgReferListTreeViewPermTargetEmp: '',
                },
                tmgResultsDto: {
                    txtAction: '',
                    holiday: false,
                    txtTdaNopenR: '',
                    txtTdaNcloseR: '',
                    workingId: '',
                    selMgdCbusinessTrip: '',
                    txtDYYYYMMDD: '',
                    tdaCowncommentR: '',
                    nonDutyList: [],
                    overHoursList: [],
                    hasAuthority: true,
                    psSite: 'TMG_INP',
                    psApp: 'TmgResults',
                    EmployeeCode: [[${ session.psSession.loginEmployee }]],
                    UserCode: [[${ session.psSession.loginEmployee }]],
                    txtTmgReferListTreeViewPermSelectedView: '',
                    txtTmgReferListTreeViewPermTargetSection: '',
                    txtTmgReferListTreeViewPermTargetGroup: '',
                    txtTmgReferListTreeViewPermTargetEmp: '',
                },
                workingId: '',
                today: '',
                workingIdList: [],
                businessTrip: '',
                businessTripList: [],
                categoryNonduty: '',
                categoryNondutyName: '',
                categoryNondutyList: [],
                categoryOverhours: '',
                categoryOverhoursName: '',
                categoryOverhoursList: [],
                dailyEdit: [],
                workTimeDisable: false,
                isShow: false,
                title: {
                    type: String,
                    default: ''
                },
                width: {
                    type: [String, Number],
                    default: 650
                },
                isAdmin: {
                    type: Boolean,
                    default: false
                },
                errorFlag: false,
                errorMsg: '',
                columnsWork: [
                    {
                        title: '勤務時間',
                        align: 'center',
                        key: 'workTime'
                    },
                    {
                        title: '始業',
                        slot: 'workStart',
                        align: 'center'
                    },
                    {
                        title: '終業',
                        slot: 'workEnd',
                        align: 'center'
                    }
                ],
                columnsNotWork: [
                    {
                        title: '内容',
                        align: 'center',
                        width: '120',
                        key: 'itemName'
                    },
                    {
                        title: '開始時刻',
                        width: '80',
                        slot: 'tdadNopen',
                        align: 'center'
                    },
                    {
                        title: '終了時刻',
                        slot: 'tdadNclose',
                        width: '80',
                        align: 'center'
                    },
                    {
                        title: '備考',
                        slot: 'tdadCsparechar1',
                        align: 'center'
                    },
                    {
                        title: '削除',
                        slot: 'tdadNdeleteflg',
                        width: '80',
                        align: 'center'
                    }
                ],
                detailNonDutyVOList: [],
                columnsOverWork: [
                    {
                        title: '内容',
                        align: 'center',
                        width: '120',
                        key: 'itemName'
                    },
                    {
                        title: '開始時刻',
                        width: '80',
                        slot: 'tdadNopen',
                        align: 'center'
                    },
                    {
                        title: '終了時刻',
                        slot: 'tdadNclose',
                        width: '80',
                        align: 'center'
                    },
                    {
                        title: '用務内容',
                        slot: 'tdadCsparechar1',
                        align: 'center'
                    },
                    {
                        title: '状態',
                        key: 'tdadCsparechar2Name',
                        align: 'center'
                    },
                    {
                        title: '削除',
                        slot: 'tdadNdeleteflg',
                        width: '80',
                        align: 'center'
                    }
                ],
                detailOverhoursVOList: [],
                columnsDailyLog: [
                    {
                        title: '更新者',
                        key: 'cmodifierusernm',
                        width: '120'
                    },
                    {
                        title: '更新日時',
                        key: 'dmodifieddate',
                        width: '140',
                        align: 'center'
                    },
                    {
                        title: '画面',
                        key: 'cmodifierprogramnm',
                        width: '100',
                        align: 'center'

                    },
                    {
                        title: '操作',
                        key: 'cactionnm',
                        width: '130',
                        align: 'center'
                    },
                    {
                        title: '更新内容',
                        key: 'cchangelogstr'
                    }
                ],
                dailyLog: [],
                notWorkType: 1,
                dailyData: {},
                workData0: [],
                mgdCsparechar4VOList: [],
                bHoliday: false,
                bFixed: false,
                isEdiTableResult4Inp: false,
                isCommonDiscretionaryLabor: false,
                isDiscretion: false,//裁量労働制

                // 承認者コメントの入力制御
                bApproved: false,

                txtDYYYYMMDD: '',
                index: 0,
                // 承認ステータス
                isConfirm: '',
                // 更新履歴の表示制御
                isLogShow: false,
                updateDailyLoading: false,
                // 就業区分切替の表示制御
                bDisable: false,
                overHourLimit: '',
                otDaily: '',
                targetForOverTime: '',
                errMsg: [],
                bDispKinmujokyoKakunin: false,
                bDispKenkojotaiKakunin: false,
                bWorkChkStatus: false,
                bHealthChkStatus: false,
                kinmujokyoEnd: 0,
                workData: []
            }
        },
        async mounted() {
            this.$refs.clock.showTime()
            this.getClockInfo()
            this.getIsDiscretion()
            this.getDutyAndRelaxDate()
            await this.getScheduleInfo()
            await this.getOverTime()
            this.dynamicScheduleFit()
        },
        beforeDestroy() {
            this.$refs.clock.cleanClock()
        },
        computed: {
            //予定時間表示かどうか
            isActivated() {
                if (this.data.clockOnTime && !this.data.clockOffTime) return true
                return false
            },
            //超過勤務時間表示かどうか
            isOverActivated() {
                if (!this.overWorkData[0]) {
                    if (this.overWorkData[0].length > 0)
                        return true
                }
                return false
            },
            //予定時間
            dynamicSchedule() {
                if (this.scheduleData[0]) {
                    return this.scheduleData.map((e, i) => {
                        const startTime = Utils.timeToMinute(e.split('-')[0])
                        const endTime = Utils.timeToMinute(e.split('-')[1])
                        const contentWidth = ((endTime - startTime) / 60) * 55.44
                        const left = (startTime / 60 - this.scheduleSection[0]) * 55.44 + 25
                        return {
                            time: e,
                            style: {
                                width: `${contentWidth}px`,
                                lineHeight: `123px`,
                                left: `${left}px`,
                                top: '35%',
                                textDecoration: 'none',
                                color: contentWidth > 100 ? 'var(--real-schedule)' : 'transparent'
                            }
                        }
                    })
                } else {
                    /*if (this.requestFlag) {
                        this.scheduleData[0] = '勤務予定時間がなし'
                        return this.scheduleData.map((e, i) => {
                            this.scheduleData[0] = ''
                            const startTime = 780
                            const endTime = 1080
                            const contentWidth = ((endTime - startTime) / 60) * 55.44
                            const left = 358
                            return {
                                time: '勤務予定時間がなし',
                                style: {
                                    width: `${contentWidth}px`,
                                    lineHeight: `123px`,
                                    left: `${left}px`,
                                    top: '35%',
                                    textDecoration: 'none',
                                    color: contentWidth > 100 ? 'var(--real-schedule-overwork)' : 'transparent'
                                }
                            }
                        })
                    } else {*/
                        return
                    //}
                }
            },
            //超過勤務時間
            dynamicSchedule2() {
                if (!this.overWorkData[0]) {
                    return
                }
                return this.overWorkData.map((e, i) => {
                    const startTime = Utils.timeToMinute(e.split('-')[0])
                    const endTime = Utils.timeToMinute(e.split('-')[1])
                    const contentWidth = ((endTime - startTime) / 60) * 55.44
                    const left = (startTime / 60 - this.scheduleSection[0]) * 55.44 + 25
                    return {
                        time: e,
                        style: {
                            width: `${contentWidth}px`,
                            lineHeight: `123px`,
                            left: `${left}px`,
                            top: '35%',
                            textDecoration: 'none',
                            color: contentWidth > 100 ? 'var(--real-schedule-overwork)' : 'transparent'
                        }
                    }
                })
            }
        },
        methods: {
            //超過勤務時間を取得する
            async getOverTime() {
                const {data} = await this.http.post('sys/timePunch/queryOverWorkTime', this.query_overWork)
                if (data) {
                    this.overWorkData = data
                }
            },
            //打刻
            async clock(pAction) {
                this.query_clockInfo.pAction = pAction
                if (pAction) {
                    if (pAction === "ACT_EXEC_OPEN") {
                        this.clocking = true
                    } else {
                        this.exiting = true
                    }
                    this.clockDisable = true
                    try {
                        const {data} = await this.http.postForm('sys/timePunch/stamping', this.query_clockInfo)
                        //console.log(data)
                        if (data) {
                            //チェック合格
                            if (data.resultCode === "0") {
                                //打刻成功(0)
                                if (pAction === "ACT_EXEC_OPEN") {
                                    this.clockData.startTime = data.clockTime
                                    this.clockBtn.clock = '出勤(' + data.clockTime + ')'
                                    this.$Notice.info({title: '打刻しました', desc: data.resultMsg})
                                } else {
                                    this.clockData.endTime = data.clockTime
                                    this.clockBtn.exit = '退勤(' + data.clockTime + ')'
                                    this.$Notice.info({title: '打刻しました', desc: data.resultMsg})
                                }
                            } else {
                                //打刻失敗(10,20,30)
                                this.$Notice.error({title: '打刻エラー', desc: data.resultMsg})
                            }
                        } else {
                            //チェック不合格
                            this.$Notice.warning({title: '打刻エラー', desc: MSG.ACTION.SIGN_ERROR})
                        }
                    } catch (error) {
                        this.clocking = false
                        this.exiting = false
                        this.clockDisable = false
                    }
                } else {
                    //
                    this.$Notice.warning({title: '打刻エラー', desc: MSG.ACTION.PARA_ERROR})
                }
                this.clocking = false
                this.exiting = false
                this.clockDisable = false
            },
            //打刻情報を取得する
            async getClockInfo() {
                const {data} = await this.http.postForm('sys/timePunch/clockInfo', this.query_clockInfo)
                if (data) {
                    var startTime = data.nopen
                    var endTime = data.nclose
                    if (startTime) {
                        this.clockData.startTime = startTime
                        this.clockBtn.clock = '出勤(' + startTime + ')'
                    }
                    if (endTime) {
                        this.clockData.endTime = endTime
                        this.clockBtn.exit = '退勤(' + endTime + ')'
                    }
                } else {
                    //まだ、打刻していない 何もしない
                }
            },
            // 職員勤務予定データを取得する
            async getScheduleInfo() {
                const {data} = await this.http.postForm('sys/timePunch/selectScheduleInfo', this.query_schedule)
                this.requestFlag = true;
                if (data) {
                    this.scheduleData = data
                } else {
                    this.scheduleData = ['', '']
                }
            },
            //　職員有休等情報を取得する
            async getDutyAndRelaxDate() {
                try {
                  let {data} = await this.http.postForm('sys/timePunch/selectDutyAndRelaxDate', this.query_schedule)
                  data = data.map(e=> {
                    return {
                      title: e.title,
                      num: e.context.split(/\D+/).slice(0,-1),
                      unit: e.context.split(/\d+/).slice(1),
                    }
                  })
                  let list = []
                  for(let i=0; data.length > i; i=i+4){
                    list.push(data.slice(i,i+4));
                  }
                  this.cardData = list
                } catch (error) {
                } finally {
                }

            },
            //裁量労働の場合、超勤申請できない
            async getIsDiscretion() {
                const {data} = await this.http.postForm('sys/timePunch/isDiscretion', this.query_clockInfo)
                //console.log('裁量労働：',data)
                if (!data) {
                    this.discretionDisable = data
                }
            },
            handleClose() {
                this.errorFlag = false
                this.isShow = false
                this.$emit('close')
            },
            //予定時間帯の自動適応
            async dynamicScheduleFit() {
                const {data} = await this.http.postForm('sys/timePunch/queryEmpScheduleSection', this.query_overWork)
                var endTime = "";
                if (this.overWorkData.length > 0) {
                    //もし超過勤務時間があれば、超過勤務時間に基く
                    if (this.overWorkData[this.overWorkData.length - 1]) {
                        endTime = Utils.timeToMinute(this.overWorkData[this.overWorkData.length - 1].split('-')[1])
                    }
                } else {
                    //無ければ、勤務予定時間に基く
                    if (this.scheduleData[this.scheduleData.length - 1]) {
                        endTime = Utils.timeToMinute(this.scheduleData[this.scheduleData.length - 1].split('-')[1])
                    } else {
                        //予定時間がない場合
                    }
                }
                if (data) {
                    var startSection = parseInt(data[0])
                    var endSection = parseInt(data[1])
                    if (parseInt(endTime) / 60 > data[1]) {
                        this.scheduleTime = Utils.getNumArray(startSection, 48)
                        this.scheduleSection = [startSection, 48]
                    } else {
                        this.scheduleTime = Utils.getNumArray(startSection, endSection)
                        this.scheduleSection = [startSection, endSection]
                    }
                }
            },

            //一覧から日次実績をクリックする
            async showDay() {
                // 業登録画面表示
                this.isShow = true
                this.dailyloading = true

                // 就業登録画面項目クリアする
                this.categoryNonduty = ''
                this.categoryOverhours = ''
                this.dailyEdit = []
                this.workData0 = []
                this.detailNonDutyVOList = []
                this.detailOverhoursVOList = []

                this.title = '  '
                this.query.txtDYYYYMMDD = Utils.formatDate(new Date(), "yyyy/MM/dd")
                this.txtDYYYYMMDD = Utils.formatDate(new Date(), "yyyy/MM/dd")
                this.query.txtAction = 'ACT_EDITINP_RDAILY'
                this.query.txtDYYYYMM = Utils.formatDate(new Date(), "yyyy/MM/dd")
                this.bFixed = false
                this.bHoliday = false
                // 業登録画面データ取得
                await this.dailyDetail()
                this.dailyloading = false
            },

            // 就業登録画面情報取得・設定する
            async dailyDetail() {
                if (this.$refs.select1) {
                    this.$refs.select1.clearSingleSelect()
                }
                if (this.$refs.select2) {
                    this.$refs.select2.clearSingleSelect()
                }
                if (this.$refs.select3) {
                    this.$refs.select3.clearSingleSelect()
                }
                if (this.$refs.select4) {
                    this.$refs.select4.clearSingleSelect()
                }
                // 画面情報取得
                const {data} = await this.http.get('sys/tmgResults/dailyDetail', this.query)

                // 就業区分ドロップダウン
                this.workingIdList = data.workIdList

                // 出張ドロップダウン
                this.businessTripList = data.businessTripList

                // 非勤務ドロップダウン
                this.categoryNondutyList = data.categoryNondutyList
                //console.log(this.categoryNondutyList)
                if (this.categoryNondutyList.length > 0) {
                    this.categoryNonduty = this.categoryNondutyList[0].itemCode
                }
                // 超過勤務ドロップダウン
                this.categoryOverhoursList = data.categoryOverhoursList
                if (this.categoryNondutyList.length > 0) {
                    this.categoryOverhours = this.categoryOverhoursList[0].itemCode
                }
                this.mgdCsparechar4VOList = data.mgdCsparechar4VOList

                // 詳細:欠勤離籍以外
                this.workData0 = data.dailyDetail0List

                // 就業実績
                this.dailyEdit = data.dailyEditVO

                if (('TMG_DATASTATUS|9' === this.dailyEdit.tdaCstatusflg || 'TMG_DATASTATUS|5' === this.dailyEdit.tdaCstatusflg)
                    && '' !== this.dailyEdit.tdaCmodifieruseridR
                    && '' !== this.dailyEdit.tdaDmodifieddateR
                ) {
                    this.bApproved = true
                } else {
                    this.bApproved = false
                }

                // 登録ボタンとコメントのみ登録ボタンの表示制御
                this.bFixed = !data.isEditable
                if (data.workIdList.length < 2) {
                    this.bHoliday = true
                }

                //就業入力サイトでの就業実績編集機能を使用するか判定し値を返却します
                this.isEdiTableResult4Inp = data.isEdiTableResult4Inp

                this.isCommonDiscretionaryLabor = data.isCommonDiscretionaryLabor
                this.isDiscretion = data.isDiscretion


                if (this.isEdiTableResult4Inp) {
                    this.dailyEdit.tdaNopenR = this.dailyEdit.tdaNopenRHidden
                    this.dailyEdit.tdaNcloseR = this.dailyEdit.tdaNcloseRHidden
                }

                if (this.dailyEdit.tdaNopenTp === null) {
                    this.dailyEdit.tdaNopenTp = '---'
                }
                if (this.dailyEdit.tdaNcloseTp === null) {
                    this.dailyEdit.tdaNcloseTp = '---'
                }
                if (this.isDiscretion) {
                    this.dailyEdit.tdaNopenN = '---'
                    this.dailyEdit.tdaNcloseN = '---'
                }

                this.workingId = this.dailyEdit.tdaCworkingidR
                this.businessTrip = this.dailyEdit.tdaCbusinesstripidR
                this.title = this.dailyEdit.tdaDyyyymmddDy

                if (this.dailyEdit.tdaCerrcode) {

                    let tempErrCode = JSON.parse(this.dailyEdit.tdaCerrcode)
                    Object.keys(tempErrCode).some(e => {

                        if (e === 'ERRTYPE_10') {

                            this.$Notice.error({desc: tempErrCode.ERRTYPE_10[0].ERRMSG})
                            return true
                        }
                    })

                }
                this.workData = [
                    {
                        workTime: '予定時間',
                        workStart: this.dailyEdit.tdaNopenN,
                        workEnd: this.dailyEdit.tdaNcloseN,
                        cellClassName: {
                            workTime: 'sub-title'
                        }
                    },
                    {
                        workTime: '打刻',
                        workStart: this.dailyEdit.tdaNopenTp,
                        workEnd: this.dailyEdit.tdaNcloseTp,
                        cellClassName: {
                            workTime: 'sub-title'
                        }
                    },
                    {
                        workTime: '就業時間',
                        isResultTime: true,
                        workStart: this.dailyEdit.tdaNopenR,
                        workEnd: this.dailyEdit.tdaNcloseR,
                        cellClassName: {
                            workTime: 'sub-title'
                        }
                    }
                ]
                this.workData0.forEach(e => {
                    this.workData = this.workData.concat(
                        {
                            workTime: e.tdadCnotworkName,
                            workStart: e.tdadNopenHhmi,
                            workEnd: e.tdadNcloseHhmi,
                            cellClassName: {
                                workTime: 'sub-title'
                            }
                        }
                    )
                })
                this.workData = this.workData.concat([
                    {
                        workTime: '本人コメント	',
                        isOwnComment: true,
                        cellClassName: {
                            workTime: 'like-title'
                        }
                    },
                    {
                        workTime: '承認者コメント	',
                        isBSComment: true,
                        cellClassName: {
                            workTime: 'like-title'
                        }
                    }])
                // 非勤務
                this.detailNonDutyVOList = data.detailNonDutyVOList
                // 超過勤務
                this.detailOverhoursVOList = data.detailOverhoursVOList
                //
                const turnLine = Vue.filter('turnLine');
                this.dailyLog = data.columnsDailyLog.map(e => {
                    return {
                        ...e,
                        cchangelogstr: turnLine(e.cchangelogstr)

                    }
                })
                let limitOfBasedateVO = data.limitOfBasedateVO
                this.overHourLimit = limitOfBasedateVO.dailyConvMinute
                this.otDaily = limitOfBasedateVO.otDaily
                this.targetForOverTime = data.targetForOverTime
                this.changeWorkingID(this.workingId)
                //console.log(this.bHoliday)
                //console.log(this.bFixed)
                //console.log(this.isEdiTableResult4Inp)

            },

            handleClose() {
                this.errorFlag = false
                this.isShow = false
                this.$emit('close')
            },
            addOverWork() {
                let detailOverhoursVO = this.categoryOverhoursList.find(e => e.itemCode === this.categoryOverhours)

                this.detailOverhoursVOList.push({
                    attributeUrl: detailOverhoursVO.attributeUrl,
                    tdadCnotworkid: detailOverhoursVO.itemCode,
                    itemName: detailOverhoursVO.itemName,
                    tdadNopen: '',
                    tdadNclose: '',
                    tdadNdeleteflg: '0',
                    tdadSeq: Date.now(),
                    tdadCsparechar1: '',
                    tdadNsparenum1: '',
                    tdadCcode01: '',
                    tdadCcode01Name: '',
                    tdadCsparechar2: '',
                    tdadCsparechar2Name: ''

                })
            },
            addNotWork() {
                let categoryNondutyVO = this.categoryNondutyList.find(e => e.itemCode === this.categoryNonduty)

                this.detailNonDutyVOList.push({
                    attributeUrl: categoryNondutyVO.attributeUrl,
                    tdadCnotworkid: categoryNondutyVO.itemCode,
                    itemName: categoryNondutyVO.itemName,
                    tdadNdeleteflg: "0",
                    tdadNopen: '',
                    tdadNclose: '',
                    tdadSeq: Date.now(),
                    tdadCsparechar1: '',
                    tdadNsparenum1: null

                })

            },
            delNotWork(row, i) {
                this.detailNonDutyVOList = this.detailNonDutyVOList.filter(e => e.tdadSeq !== row.tdadSeq)
                this.$set(this.lightDelBtnVisible2, i, false)
            },
            delOverWork(row, i) {
                this.detailOverhoursVOList = this.detailOverhoursVOList.filter(e => e.tdadSeq !== row.tdadSeq)
                this.$set(this.lightDelBtnVisible, i, false)
            },
            cancelNotWork(i) {
                this.$set(this.lightDelBtnVisible2, i, false)
            },
            cancelOverWork(i) {
                this.$set(this.lightDelBtnVisible, i, false)
            },
            //コメントのみ登録
            updateInp: Debounce(function () {
                this.tmgResultsDto.txtAction = 'ACT_EDITINP_UCOMMENT'
                this.tmgResultsDto.holiday = this.bHoliday
                this.tmgResultsDto.workingId = this.workingId
                this.tmgResultsDto.txtDYYYYMMDD = this.txtDYYYYMMDD
                this.tmgResultsDto.selMgdCbusinessTrip = this.businessTrip
                this.tmgResultsDto.txtTdaNopenR = this.dailyEdit.tdaNopenR
                this.tmgResultsDto.txtTdaNcloseR = this.dailyEdit.tdaNcloseR
                this.tmgResultsDto.tdaCowncommentR = this.dailyEdit.tdaCowncommentR

                if (this.tmgResultsDto.tdaCowncommentR !== null && this.getLengthB(this.tmgResultsDto.tdaCowncommentR) > 100) {
                    this.$Notice.error({desc: MSG.LENGTH.COMMENT_INT})
                    return false
                }
                this.$Modal.confirm({
                    inDrawer: true,
                    title: '注意',
                    width: 480,
                    content: MSG.ACTION.COMMENT_CONFIRM,
                    okText: 'OK',
                    cancelText: 'キャンセル',
                    onOk: () => {
                        try {
                            this.http.post('sys/tmgResults/updateInp', this.tmgResultsDto)
                        } catch (error) {

                        } finally {
                            this.isShow = false

                            //超過勤務時間を追加するかもしれないので、データリストを更新する
                            this.getOverTime()

                            //自動で時間帯に適応性する
                            this.dynamicScheduleFit()
                        }
                    }
                })
            }),
            //登録
            async updateDaily() {
                const [check, msg] = this.errorCheck(this.workingId)
                if (!check) {
                    return
                }
                this.tmgResultsDto.txtDYYYYMMDD = this.txtDYYYYMMDD
                this.tmgResultsDto.txtAction = 'ACT_EDITINP_UDAILY'

                this.tmgResultsDto.workingId = this.workingId
                this.tmgResultsDto.selMgdCbusinessTrip = this.businessTrip
                this.tmgResultsDto.holiday = null
                this.tmgResultsDto.txtTdaNopenR = ''
                this.tmgResultsDto.txtTdaNcloseR = ''
                this.tmgResultsDto.tdaCowncommentR = ''
                this.tmgResultsDto.hasAuthority = ''
                this.tmgResultsDto.holiday = this.bHoliday
                this.tmgResultsDto.tdaCowncommentR = this.dailyEdit.tdaCowncommentR
                if (!this.bDisable) {
                    this.tmgResultsDto.txtTdaNopenR = this.workData[2].workStart
                    if (!this.workData[2].workStart) {
                        this.tmgResultsDto.txtTdaNopenR = this.workData[0].workStart
                    } else {
                        this.tmgResultsDto.txtTdaNopenR = this.workData[2].workStart
                    }
                    if (!this.workData[2].workEnd) {
                        this.tmgResultsDto.txtTdaNcloseR = this.workData[0].workEnd
                    } else {
                        this.tmgResultsDto.txtTdaNcloseR = this.workData[2].workEnd
                    }
                    this.tmgResultsDto.nonDutyList = this.detailNonDutyVOList
                    this.tmgResultsDto.overHoursList = this.detailOverhoursVOList
                    if (this.bFixed || this.bHoliday) {
                        this.tmgResultsDto.hasAuthority = false
                    } else {
                        this.tmgResultsDto.hasAuthority = true
                    }
                }

                this.$Modal.confirm({
                    inDrawer: true,
                    title: '注意',
                    content: msg || MSG.ACTION.CONFIRM,
                    width: 480,
                    okText: 'OK',
                    cancelText: 'キャンセル',
                    onOk: async () => {
                        try {
                            this.updateDailyLoading = true
                            const {msg} = await this.http.post('sys/tmgResults/updateDaily', this.tmgResultsDto)
                            if (msg === '0') {
                                this.updateDailyLoading = false
                                this.isShow = false
                                this.getTitleData()
                                return
                            }
                            this.errMsg = JSON.parse(msg)
                            let errMsg20
                            let check = Object.keys(this.errMsg).some(e => {
                                if (e === 'ERRTYPE_10') {
                                    this.$Notice.error({desc: this.errMsg.ERRTYPE_10[0].ERRMSG})
                                    return true
                                }
                                if (e === 'ERRTYPE_20') {
                                    this.errMsg.ERRTYPE_20.forEach(e20 => {
                                        errMsg20 = errMsg20 + e20.ERRMSG + '/n'
                                    })
                                    this.$Notice.error({desc: errMsg20})
                                }

                            })
                            if (check) {
                                return false
                            }

                        } catch (error) {
                            return
                        } finally {
                            this.updateDailyLoading = false

                            //超過勤務時間を追加するかもしれないので、データリストを更新する
                            await this.getOverTime()
                            //自動で時間帯に適応性する
                            this.dynamicScheduleFit()
                        }
                    }
                })

            },

            // 就業区分の切り替え表示制御
            changeWorkingID(workingid) {
                if (!workingid) {
                    return
                }
                this.bDisable = false
                // 休暇
                if (this.bHoliday) {
                    this.bDisable = true
                    this.workTimeDisable = true
                    // 休暇以外
                } else {
                    let mgdCsparechar4VO = this.mgdCsparechar4VOList.find(e => e.mgdCmastercode === workingid)
                    // 出勤 or 休日出勤
                    if (mgdCsparechar4VO.mgdCsparechar5 == '0') {
                        this.bDisable = false
                        this.workTimeDisable = false
                        // 欠勤
                    } else {
                        this.bDisable = true;
                        this.workTimeDisable = true
                    }
                }
                if (this.bDisable === true) {
                    this.workData[2].workStart = ''
                    this.workData[2].workEnd = ''
                    this.detailNonDutyVOList = []
                    this.detailOverhoursVOList = []
                    if (this.businessTripList[0].mgdCmastercode) {
                        this.businessTrip = this.businessTripList[0].mgdCmastercode
                    } else {
                        this.businessTrip = ''
                    }

                }
            },
            // エラーチェック
            errorCheck(workingid) {
                let mgdCsparechar4VO = this.mgdCsparechar4VOList.find(e => e.mgdCmastercode === workingid)
                // 出勤 or 休日出勤
                if (!mgdCsparechar4VO || mgdCsparechar4VO.mgdCsparechar5 != '0') {
                    return [true];
                }
                // 修正出社時刻形式
                if (this.workData[2].workStart && !this.time_check(this.workData[2].workStart)) {
                    this.$Notice.error({desc: MSG.TIME_CHECK.START})
                    return [false];
                }

                // 修正退社時刻形式

                if (this.workData[2].workEnd && !this.time_check(this.workData[2].workEnd)) {
                    this.$Notice.error({desc: MSG.TIME_CHECK.END})
                    return [false];
                }

                if (this.dailyEdit.tdaCowncommentR !== null && this.getLengthB(this.dailyEdit.tdaCowncommentR) > 100) {
                    this.$Notice.error({desc: MSG.LENGTH.COMMENT_SELF})
                    return [false];
                }

                //非勤務
                const checkNonDuty = this.detailNonDutyVOList.some(e => {

                    if (e.tdadNopen ===null ||  !this.time_check(e.tdadNopen)) {
                        this.$Notice.error({desc: MSG.TIME_CHECK.START_OFFWORK})
                        return true;
                    }
                    if (e.tdadNclose ===null || !this.time_check(e.tdadNclose)) {
                        this.$Notice.error({desc: MSG.TIME_CHECK.END_OFFWORK})
                        return true;
                    }
                    if (e.tdadCsparechar1 !== null && this.getLengthB(e.tdadCsparechar1) > 100) {
                        this.$Notice.error({desc: MSG.LENGTH.COMMENT_INT})
                        return true
                    }
                })
                if (checkNonDuty) return [false]
                // 超過勤務
                const checkOverhour = this.detailOverhoursVOList.some(e => {

                    if (e.tdadCsparechar1 !== null && e.tdadCsparechar1.length > 100) {
                        this.$Notice.error({desc: MSG.LENGTH.COMMENT_OVER})
                        return true
                    }
                })
                if (checkOverhour) return [false]
                let nOverTimeTotal = 0;
                // 超過勤務命令の明細部配下を行単位で取得
                this.detailOverhoursVOList.forEach(e => {
                    // 超過勤務命令の時間数を算出
                    let sOpen = this.toMinuteFromHHcMI60(e.tdadNopen);
                    let sClose = this.toMinuteFromHHcMI60(e.tdadNclose);
                    nOverTimeTotal = nOverTimeTotal + (sClose - sOpen);
                })
                // 超過勤務命令時間が入力されていて、超過勤務対象「無」の場合は警告メッセージを表示する
                if (nOverTimeTotal > 0 && this.targetForOverTime === "1") {
                    // 警告メッセージの表示および、応答の確認
                    return [true, MSG.ACTION.OVERWORK_CONFIRM]
                }
                // 超過勤務命令時間数合計が登録された超勤限度時間を超える場合は警告メッセージを表示する
                if (nOverTimeTotal > this.overHourLimit) {
                    // 警告メッセージの表示および、応答の確認
                    return [true, MSG.TIME_CHECK.OVERWORK_FC(this.otDaily)]
                }
                return [true];
            },
            getLengthB(moji) {
                let i, j, cnt = 0;
                let multiStr = new Array("×", "§", "¨", "°", "±", "´", "¶");
                for (i = 0; i < moji.length; i++) {
                    for (j = 0; j < multiStr.length; j++) {
                        if (multiStr[j].length == 0) {
                            continue;
                        }
                        moji = moji.replace(multiStr[j], "00");
                    }
                }
                // MAC OSの場合、改行コードが「\n」となり、Windowsの改行コード「\r\n」とバイト数が異なるので、
                moji = moji.split("\r\n").join("\n"); // 一旦「\r\n」 ⇒ 「\n」の変換を行い、改行コードを「\n」に合わせる。
                // バイト数を求めます。
                for (i = 0; i < moji.length; i++)
                    if (escape(moji.charAt(i)).length >= 4) cnt += 2; else cnt++;
                return cnt;
            },
            time_check(sTime) {
                return sTime.match(/^(([0-3]?[0-9])|([4][0-7])):([0-5]?[0-9])$/);
            },
            toHHHcMI60FromHHHMI60(pHHMM) {
                let colonSTR = ':';
                let retHHMM;
                let bColonIs = 0
                if (!pHHMM.match(/^\d{2}([0-5]?[0-9])$/)) {
                    // フォーマットが不正である場合は入力された値をそのまま返す
                    return pHHMM;
                }
                if (pHHMM.length < 3) {
                    return "0:" + pHHMM;
                }
                // ３桁の場合
                if (pHHMM.length === 3) {
                    retHHMM = pHHMM.substring(0, 1) + colonSTR + pHHMM.substring(1, 3);
                    // ４桁の場合
                } else {
                    retHHMM = pHHMM.substring(0, 2) + colonSTR + pHHMM.substring(2, 4);
                }
                return retHHMM;
            },
            toMinuteFromHHcMI60(pHHMM) {
                // 何もパラメータが渡されなかった場合、そのまま返す
                if (pHHMM === '') {
                    return '';
                }
                let retMinute;
                let nHour = new Number();
                let nMinute = new Number();
                // 分に変換します
                nHour = eval(+(pHHMM.split(":")[0] * 60));
                nMinute = eval(+(pHHMM.split(":")[1]));
                retMinute = eval(nHour + nMinute);
                return retMinute;
            },

            rowClass(row) {
                if (row.today) {
                    return 'sun select-col'
                }
                if (!row.dayDivisionCode || row.dayDivisionCode === '1') {
                    return 'select-col'
                }
                return 'sat select-col'
            },
            dayRed(e, i) {
                const dayOfWeek = e.TMG_HOLFLG
                if (i === 0) {
                    if (e.TDA_DYYYYMMDD === this.today) {
                        return 'brown cursor'
                    }

                    if (dayOfWeek.trim() === 'TMG_HOLFLG|0') {
                        return 'cursor'
                    }
                    if (dayOfWeek.trim() != 'TMG_HOLFLG|0') {
                        return 'blue cursor'
                    }

                } else {
                    if (e.TDA_DYYYYMMDD === this.today) {
                        return 'brown'
                    }
                    if (dayOfWeek.trim() === 'TMG_HOLFLG|0') {
                        return
                    }
                    if (dayOfWeek.trim() != 'TMG_HOLFLG|0') {
                        return 'blue'
                    }

                }
            },
            handleInputChange(i, object, value, el) {
                // 填完后自动checkbox
                if (object) {
                    this.hasPassedTimeCheck = Utils.checkTime(object, value, el)
                }
            },
            handleSpan({rowIndex, columnIndex}) {
                const len = this.workData.length
                if (rowIndex === len - 2 && columnIndex === 1) {
                    return [1, 2]
                } else if (rowIndex === len - 1 && columnIndex === 1) {
                    return [1, 2]
                }
            }

        }
    })
</script>
</body>
</html>