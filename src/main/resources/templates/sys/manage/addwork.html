<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head
    th:replace="layout/header::common_header(title='就業承認',cssPaths='/pages/content.min.css,' + '/pages/vacation.min.css')">
</head>

<body>
    <div th:replace="layout/loadingBar::loadingBar"></div>
<!-- 菜单导航栏 -->
<div th:replace="layout/sider"></div>
    <main class="content monthWorkConfirm-warp" @scroll.passive="handleScroll" ref="layout">
        <div class="content_head">
            <div class="header">
                <div class="title1">
                    <h1>
                        <Icon type="i-emeer colored"></Icon>
                        就業承認
                    </h1>
                </div>
                <div class="btnbox" v-if="isMonthlyApproval">
                    <span style="flex:1"></span>
                    <i-button type="text" class="pr15" style="height: 40px;line-height: 45px;font-size: 16px;font-weight: bold;" :loading="monthlyLoading">
                        {{ `月次承認状況： ${isConfirm==='TMG_DATASTATUS|5' ? '承認済' : '未承認'}` }}
                    </i-button>
                    <i-button type="primary" ghost  icon="md-nutrition" v-if="countNotApprovalDay ==='0' && isConfirm !== 'TMG_DATASTATUS|5' && flexTime ==='0:00'"  @click="updateMonth('approval')" :loading="updateMonthloading">承認</i-button>
                    <i-button  icon="md-nutrition" disabled v-else-if="isConfirm !== 'TMG_DATASTATUS|5'">承認</i-button>
                    <i-button type="error" icon="md-done-all" v-if="isConfirm === 'TMG_DATASTATUS|5' && isFixed !=1 " @click="updateMonth('cancel')" :loading="updateMonthloading">解除</i-button>
                    <i-button type="error" icon="md-done-all" v-else-if="isConfirm === 'TMG_DATASTATUS|5' && isFixed ===1 " disabled>解除</i-button>
                </div>
            </div>
            <div class="searchwrap">
                <span class="label">年月</span>
                <i-select v-model="model1" :disabled="!selectDisabled" class="mr30" @on-change="handleStartMonth($event)"
                          placeholder="選択ください">
                    <i-option v-for="(item, index) of dispMonthlyList" :key="index" :label="item.val" :value="item.code">
                    </i-option>
                </i-select>

                <!-- 共通組織図画面 start-->
                <span style="display:flex;width: calc(15% + 200px);">
                    <span class="label">所属</span>
                    <i-button v-on:click.native="deptDrawShow = true" class="input-like-span dept-select">
                        <Tooltip trigger="hover" :theme="toolTipTheme()" transfer>{{deptName}}
                            <div slot="content">{{deptName}}</div>
                        </Tooltip>
                    </i-button>

               <Drawer class="tc" title="所属を選択してください" placement="right" width="700" :closable="false"
                       :mask-closable="!isSearchHistory" v-model="deptDrawShow">
                <Tabs :animated="false" v-model="currentTab" @on-click="currentTabChanged">
                <tab-pane label="ツリー" name="organisationTree">
                        <div class="titlenorm mb5">
                            <Icon type="logo-buffer"></Icon>
                            所属
                        </div>
                        <Row class="tl mb5">
                            <i-col span="4" class="label tc" style="height: 32px;">基準日</i-col>
                            <i-col span="7" class="no-border-radius">
                            <date-picker type="date" :value="referListObject.txtTmgReferListTreeViewRecordDate"
                                         placeholder="基準日" format="yyyy/MM/dd" ref="datePicker" :clearable="false" @on-change="handleDeptDateChange"></date-picker>
                            </i-col>
                            <i-col span="4" class="label ml5 tc" style="height: 32px;">ビュー選択</i-col>
                            <div style="display: inline-block;width: 32.5%;" class="no-border-radius">
                            <i-select v-model="selectedDeptViewType" @on-change="handleDeptViewTypeChange">
                                <i-option :value="1">全て</i-option>
                                <i-option :value="2">グループごとに</i-option>
                                <i-option :value="3">部署ごとに</i-option>
                            </i-select>
                            </div>
                        </Row>
                        <div style="position: relative;">
                            <Tree class="tree mt2" :data="treeData" v-on:on-select-change="handleClickLeaf" ref="tree"
                                  empty-text="所属データなし"></Tree>
                            <Spin size="large" fix v-if="empDeptLoading"></Spin>
                        </div>
                </tab-pane>
                <tab-pane label="検索" name="organisationSearch">
                        <Row class="tl mb2" :gutter="8">
                            <i-col span="15">
                                <i-input v-model="referListObject.hidSearchData" @on-search="searchOrgTree" class="mar mb5 like-select" search enter-button placeholder="検索">
                                    <i-select v-model="referListObject.hidSearchItems" slot="prepend" style="width: 108px" placeholder="項目">
                                        <i-option v-for="(item,i) of searchTypesList" :value="item.value">{{ item.name }}</i-option>
                                    </i-select>
                                    <i-select v-model="referListObject.hidSearchCondition"  slot="append" style="width: 108px" placeholder="条件">
                                        <i-option v-for="(item,i) of searchConditionsList" :value="item.value">{{ item.name }}</i-option>
                                    </i-select>
                                </i-input>
                            </i-col>
                            <i-col span="8" class="no-border-radius">
                                <i-button long type="primary" icon="md-search" ghost :loading="empDeptLoading" @click="searchOrgTree">検索</i-button>
                            </i-col>
                        </Row>
                        <div class="titlenorm mt15">
                            <Icon type="logo-buffer"></Icon>
                            社員
                        </div>
                        <div style="position: relative;">
                            <Tree class="tree mt2" :data="empTreeData" v-on:on-select-change="handleClickLeaf" ref="tree"
                                  empty-text="社員データなし"></Tree>
                            <Spin size="large" fix v-if="empDeptLoading"></Spin>
                        </div>
                </tab-pane>
               </Tabs>
                </Drawer>
                    <!-- 共通組織図画面 end-->
                </span>
                <span class="label">氏名</span>
                <span class="input-like-span width15">
                    <Tooltip trigger="hover"　:theme="toolTipTheme()" transfer　v-if="kanjiName">{{kanjiName}}
                        <div slot="content">{{kanjiName}}</div>
                    </Tooltip>
                </span>
            </div>

        </div>



        <div class="content_body" style="position: relative">
            <Alert type="error" class="error-info" v-show="flexTime !='0:00' && dailyDataList != '' && countNotApprovalDay ==='0' && isConfirm != 'TMG_DATASTATUS|5'  ">月の勤務実績が「 {{ flexTime }}  時間」不足しています、勤務実績をご確認ください。</Alert>
            <Row :gutter="10" class="mb10" v-if="(bDispKinmujokyoKakunin ) || (bDispKenkojotaiKakunin )">
                <i-col span="12" v-if="bDispKinmujokyoKakunin">
                    <div class="label tc">勤務状況確認</div>
                    <div class="tl">
                        <div class="person-info">
                            <span class="time tl" style="width: 100%;">{{this.kinmujokyoEnd -2}}～{{this.kinmujokyoEnd}}月の勤務実績に、相違がないことを確認しました。</span>
                        </div>
                        <div class="person-info">
                            <span class="with-split" style="width: 70%;" v-if="bWorkChkStatus">現在の状況：確認済 </span>
                            <span class="with-split" style="width: 25%;" v-if="bWorkChkStatus">
                                <i-button type="primary" ghost size="small" @click="confWork">解除</i-button>
                             </span>
                            <span class="with-split" style="width: 100%;" v-else>現在の状況：未確認 </span>

                        </div>
                    </div>
                </i-col>
                <i-col span="12" v-if="bDispKenkojotaiKakunin">
                    <div class="label tc">健康状態確認</div>
                    <div class="tl">
                        <div class="person-info">
                        <span class="time tl" style="width: 100%;">健康状態に問題が生じて
                                <i-select v-model="selHealthStatus" :disabled="bHealthChkStatus" size="small" style="width:80px">
                                    <i-option v-for="(item, index) of selHealthStatusList" :key="index" :label="item.name" :value="item.code"></i-option>
                                </i-select>ことを報告します。</span>

                        </div>
                        <div class="person-info">
                            <span class="with-split" style="width: 70%;" v-if="bHealthChkStatus">現在の状況：確認済 </span>
                            <span class="with-split" style="width: 25%;" v-if="bHealthChkStatus">
                            <i-button type="primary" ghost size="small" @click="confHealth">解除</i-button>
                            </span>
                            <span class="with-split" style="width: 100%;" v-else>現在の状況：未確認 </span>

                        </div>
                    </div>
                </i-col>

            </Row>
            <div span="8" v-if="hatuReiDisp">
                <div class="label tc">発令</div>
                <div class="tl">
                    <div class="person-info">
                        <span style="width: 100%;">{{hatuReiName}}</span>
                    </div>
                    <div class="person-info">
                        <span style="width: 100%;" >{{hatuResTimeRange}}</span>
                    </div>
                </div>
            </div>
            <div class="titlenorm mb10 ">
                <Icon type="logo-buffer"></Icon>
                就業実績
            </div>

            <div class="month-sum tl">
                <div class="son" v-for="(item, i) of monthlyTilteMapList" :key="i">
                    <span class="label-monthSum">{{item.title | turnLine}}</span>
                    <span class="num">{{monthlyMap[item.key]}}</span>
                </div>
            </div>
            <Alert class="primary-info mt10">「日」もしくは「曜日」をクリックすると、就業実績画面を表示します。</Alert>
            <i-table :class="tableHeadFixed ? 'table-head-fixed long-table' : 'long-table'"
                     border :columns="columns"
                     :row-class-name="rowClass" :disabled-hover="true" :data="dailyDataList" :loading="loading"
                     no-data-text="勤怠シート未作成">
                <template slot-scope="{ row }" slot="TDA_DYYYYMMDD_DD">
                    <span :class="dayRed(row,0)" style="text-decoration: underline" @click="showDay(row.TDA_DYYYYMMDD)" >{{ row.TDA_DYYYYMMDD_DD }}</span>
                </template>
                <template slot-scope="{ row }" slot="TDA_DYYYYMMDD_DY">
                    <span :class="dayRed(row,0)" style="text-decoration: underline" @click="showDay(row.TDA_DYYYYMMDD)">{{ row.TDA_DYYYYMMDD_DY }}</span>
                </template>
                <template slot-scope="{ row }" slot="TDA_CWORKINGID_R_NAME">
                    <span :class="dayRed(row,1)">{{ row.TDA_CWORKINGID_R_NAME }}</span>
                </template>
                <template slot-scope="{ row }" slot="TDA_CSTATUSFLG_NAME">
                    <span v-if="row.TDA_CSTATUSFLG_NAME === '待'" class="confirm-sytle ing">待</span>
                    <span v-if="row.TDA_CSTATUSFLG_NAME === '済'" class="confirm-sytle">済</span>
                    <span v-if="row.TDA_CSTATUSFLG_NAME === '確'" class="confirm-sytle rest">確</span>
                    <span v-if="row.TDA_CSTATUSFLG_NAME === 'エ'" class="confirm-sytle undo">エ</span>
                </template>
                <template slot-scope="{ row }" slot="TDA_CNTFSTATUSFLG_NAME">
                    <span v-if="row.TDA_CNTFSTATUSFLG_NAME === '待'" class="confirm-sytle ing">待</span>
                    <span v-if="row.TDA_CNTFSTATUSFLG_NAME === '済'" class="confirm-sytle">済</span>
                    <span v-if="row.TDA_CNTFSTATUSFLG_NAME === 'エ'" class="confirm-sytle undo">エ</span>
                </template>
            </i-table>
            <Spin size="large" fix v-if="monthlyLoading"></Spin>
        </div>



        <!--日次就業実績-->
        <Drawer :title="title" width="850" v-model="isShow" @on-close="handleClose()" :mask-closable="false">
            <div style="position: relative">
                <Alert type="error" class="error-info" v-show="errorFlag">{{ errorMsg }}</Alert>
                <Row class="mb15 tr">
                    <div v-if="!bFixed">
                        <i-col span="6" offset="16" class="mr15" v-if="notapproval">
                            <i-button type="error" ghost  @click="updateRemandsStatus" icon="md-hand" :loading="updateDailyLoading">
                                差戻
                            </i-button>
                        </i-col>
                        <i-col  span="8" offset="16" v-if="!notapproval">
                            <i-button type="primary" ghost  @click="updateDaily"　icon="md-done-all" :loading="updateDailyLoading">
                                承認
                            </i-button>
                        </i-col>
                        <i-col  span="1"  v-if="notapproval">
                            <i-button type="primary" ghost  @click="updateDaily"　icon="md-done-all" :loading="updateDailyLoading">
                                承認
                            </i-button>
                        </i-col>
                    </div>
                    <div v-else>
                        <i-col  span="7" offset="16">
                            <i-button disabled>
                                承認
                            </i-button>
                        </i-col>
                    </div>
                </Row>
                <div class="titlenorm mb10">
                    <Icon type="logo-buffer"></Icon>
                    就業実績
                </div>
                <div style="position: relative;">
                    <Row>
                        <i-col span="8" class="label tc">就業区分</i-col>
                        <i-col span="8" class="no-border-radius">
                            <i-select v-model="workingId" class="mr30" @on-change="changeWorkingID"
                                      clearable ref="select1"
                                      v-if="!bHoliday && !bFixed">
                                <i-option v-for="(item, index) of workingIdList" :key="index"
                                          :label="item.mgdCgenericdetaildesc" 　:value="item.mgdCmastercode">
                                </i-option>
                            </i-select>
                            <p v-else align="center">{{dailyEdit.tdaCworkingidRName}}</p>
                        </i-col>
                    </Row>
                    <Row>
                        <i-col span="8" class="label tc">出張</i-col>
                        <i-col span="8" class="no-border-radius" v-if="!bDisable">
                            <i-select v-model="businessTrip" class="mr30" @on-change=""
                                      clearable ref="select2" v-if="(!bHoliday && !bFixed)">
                                <i-option v-for="(item, index) of businessTripList" :key="index"
                                          :label="item.mgdCgenericdetaildesc" 　:value="item.mgdCmastercode">
                                </i-option>
                            </i-select>
                            <p v-else align="center">{{dailyEdit.tdaCbusinesstripidRName}}</p>
                        </i-col>
                        <i-col span="8" class="no-border-radius" v-else>
                            <i-select v-model="businessTrip" class="mr30" @on-change="" disabled
                                      v-if="(!bHoliday && !bFixed)">
                                <i-option v-for="(item, index) of businessTripList" :key="index"
                                          :label="item.mgdCgenericdetaildesc" 　:value="item.mgdCmastercode">
                                </i-option>
                            </i-select>
                            <p v-else align="center">{{dailyEdit.tdaCbusinesstripidRName}}</p>
                        </i-col>
                    </Row>
                    <i-table :columns="columnsWork" :data="workData">
                        <template slot-scope="{ row, index }" slot="workStart">
                            <div v-if="row.isInput && bFixed" >
                                <i-input v-model="workData[index].workStart" v-if="!isCommonDiscretionaryLabor" :disabled="workTimeDisable" class="tc" @on-blur="handleInputChange(index, workData[index],'workStart', $event.target)"></i-input>
                                <span v-else>{{ row.workStart | toTime }}</span>
                            </div>
                            <div  v-else-if="row.isInput" >
                                <i-input v-model="workData[index].workStart" class="tc" :disabled="workTimeDisable" @on-blur="handleInputChange(index,  workData[index],'workStart', $event.target)"></i-input>
                            </div>
                            <span v-else>{{ row.workStart | toTime }}</span>
                        </template>
                        <template slot-scope="{ row, index }" slot="workEnd">
                            <div v-if="row.isInput && bFixed" >
                                <i-input v-model="workData[index].workEnd" v-if="!isCommonDiscretionaryLabor" :disabled="workTimeDisable" class="tc" @on-blur="handleInputChange(index, workData[index],'workEnd', $event.target)"></i-input>
                                <span v-else>{{ row.workEnd | toTime }}</span>
                            </div>
                            <div  v-else-if="row.isInput" >
                                <i-input v-model="workData[index].workEnd" class="tc" :disabled="workTimeDisable" @on-blur="handleInputChange(index, workData[index],'workEnd', $event.target)"></i-input>
                            </div>
                            <span v-else>{{ row.workEnd | toTime }}</span>
                        </template>

                    </i-table>

                    <div class="mt5 no-border-radius" style="display: flex; align-items: stretch;">
                        <span class="label tr" style="display: inline-block;width: 33%;margin-bottom: 1px;">本人コメント</span>
                        <i-input class="tl" style="width: 67%;margin-bottom: 1px;" v-model="dailyEdit.tdaCowncommentR" type="textarea" v-if="!bFixed">
                        </i-input>
                        <span class="input-like-span tl" style="width: 67%;margin-bottom: 1px;" v-if="bFixed">{{ dailyEdit.tdaCowncommentR}}</span>
                      </div>

                      <div class="mb5 no-border-radius" style="display: flex; align-items: stretch;">
                        <span class="label tr" style="display: inline-block;width: 33%;margin-bottom: 1px;">承認者コメント</span>
                        <i-input class="tl" style="width: 67%;margin-bottom: 1px;" v-model="dailyEdit.tdaCbosscommentR" type="textarea" v-if="!bApproved">
                        </i-input>
                        <span class="input-like-span tl" style="width: 67%;margin-bottom: 1px;" v-if="bApproved">{{ dailyEdit.tdaCmodifieruseridR}} ({{dailyEdit.tdaDmodifieddateR }})</span>
                      </div>
                </div>


                <!-- 非勤務 -->
                <div class="titlenorm mb10">
                    <Icon type="logo-buffer"></Icon>
                    非勤務
                </div>
                <Row class="mb15 tr" v-if=" !bHoliday && !bFixed ">
                    <i-col span="6" offset="15">
                        <i-select v-model="categoryNonduty" class="mr30" @on-change="" clearable ref="select3" v-if="!bDisable">
                            <i-option v-for="(item, index) of categoryNondutyList" :key="index" :label="item.itemName"
                                      　:value="item.itemCode">
                            </i-option>
                        </i-select>
                        <i-select v-model="categoryNonduty" class="mr30" @on-change="" disabled v-else>
                            <i-option v-for="(item, index) of categoryNondutyList" :key="index" :label="item.itemName"
                                      　:value="item.itemCode">
                            </i-option>
                        </i-select>
                    </i-col>
                    <i-col span="3">
                        <i-button type="primary" ghost @click="addNotWork" v-if="!bDisable">追加</i-button>
                        <i-button disabled v-else>追加</i-button>
                    </i-col>
                </Row>
                <i-table :columns="columnsNotWork" :data="detailNonDutyVOList" class="mb20"
                         no-data-text="">
                    <template slot-scope="{ row, index }" slot="tdadNopen">
                        <i-input v-model="detailNonDutyVOList[index].tdadNopen" v-if=" !bFixed" @on-blur="handleInputChange(index, detailNonDutyVOList[index],'tdadNopen', $event.target)"></i-input>
                        <span v-else>{{  row.tdadNopen | toTime  }}</span>
                    </template>

                    <template slot-scope="{ row, index }" slot="tdadNclose">
                        <i-input v-model="detailNonDutyVOList[index].tdadNclose" v-if="!bFixed " @on-blur="handleInputChange(index, detailNonDutyVOList[index],'tdadNclose', $event.target)"></i-input>
                        <span v-else>{{ row.tdadNclose | toTime }}</span>
                    </template>

                    <template slot-scope="{ row ,index}" slot="tdadCsparechar1">
                        <i-input v-model="detailNonDutyVOList[index].tdadCsparechar1" type="textarea"
                                 :autosize="{ maxRows: 3 }"
                                 v-if="row.tdadCnotworkid !== 'TMG_ITEMS|ResultRest' && !bFixed "></i-input>
                        <span v-else>{{ row.tdadCsparechar1 | toTime }}</span>
                    </template>

                    <template slot-scope="{ row }" slot="tdadNdeleteflg" v-if="!bFixed">
                        <i-button type="error" ghost size="small" class="width100" @click="delNotWork(row)">削除</i-button>
                    </template>
                </i-table>

                <div v-if="!isDiscretion">
                    <!-- 超過勤務 -->
                    <div class="titlenorm mb10">
                        <Icon type="logo-buffer"></Icon>
                        超過勤務
                    </div>
                    <Row class="mb15 tr" v-if="!bHoliday && !bFixed ">

                        <i-col span="6" offset="15">
                            <i-select v-model="categoryOverhours" class="mr30" @on-change=""  clearable ref="select4" v-if="!bDisable">
                                <i-option v-for="(item, index) of categoryOverhoursList" :key="index" :label="item.itemName"
                                          　:value="item.itemCode">
                                </i-option>
                            </i-select>
                            <i-select v-model="categoryOverhours" class="mr30" @on-change="" disabled v-else>
                                <i-option v-for="(item, index) of categoryOverhoursList" :key="index" :label="item.itemName"
                                          　:value="item.itemCode">
                                </i-option>
                            </i-select>
                        </i-col>

                        <i-col span="3">
                            <i-button type="primary" ghost @click="addOverWork" v-if="!bDisable">追加</i-button>
                            <i-button disabled v-else>追加</i-button>
                        </i-col>
                        <!--                <i-col span="4">-->
                        <!--                    <i-button type="primary" ghost v-if="!bDisable">時刻補完</i-button>-->
                        <!--                    <i-button type="primary" ghost disabled v-else>時刻補完</i-button>-->
                        <!--                </i-col>-->
                    </Row>

                    <i-table :columns="columnsOverWork" :data="detailOverhoursVOList" class="mb20"
                              no-data-text="">
                        <template slot-scope="{ row ,index }" slot="tdadNopen">
                            <i-input v-model="detailOverhoursVOList[index].tdadNopen" v-if=" !bFixed" @on-blur="handleInputChange(index, detailOverhoursVOList[index],'tdadNopen', $event.target)"></i-input>
                            <span v-else>{{ row.tdadNopen | toTime }}</span>
                        </template>

                        <template slot-scope="{ row ,index}" slot="tdadNclose">
                            <i-input v-model="detailOverhoursVOList[index].tdadNclose" v-if=" !bFixed" @on-blur="handleInputChange(index, detailOverhoursVOList[index],'tdadNclose', $event.target)"></i-input>
                            <span v-else>{{ row.tdadNclose | toTime }}</span>
                        </template>

                        <template slot-scope="{ row ,index}" slot="tdadCsparechar1">
                            <i-input v-model="detailOverhoursVOList[index].tdadCsparechar1" type="textarea"
                                     :autosize="{ maxRows: 3 }"
                                     v-if="!bFixed"></i-input>
                            <span v-else>{{ row.tdadCsparechar1}}</span>
                        </template>

                        <template slot-scope="{ row ,index}" slot="tdadNdeleteflg" v-if="!bFixed">
                            <i-button type="error" ghost size="small" class="width100" @click="delOverWork(row)">削除</i-button>
                        </template>
                    </i-table>
                </div>

                <div class="titlenorm mb10">
                    <Icon type="logo-buffer"></Icon>
                    更新履歴
                </div>
                <i-table :columns="columnsDailyLog" :data="dailyLog" class="mb20">
                </i-table>
                <Spin size="large" fix v-if="dailyloading"></Spin>
            </div>
        </Drawer>


    </main>
    <div th:replace="layout/head::header"></div>
    <script type="text/babel" th:inline="javascript">
        const WORK_YEAR_SCHEDULE = new Vue({
            // 特别注意要对上这个class
            el: '.monthWorkConfirm-warp',
            data() {
                return {

        //header 使用参数
                    selectDisabled: false,   　//年月選択可否制御
                    model1: '', //年月选择（Date）
                    dispMonthlyList: [],       //年月リスト
                    deptName: '選んでください',   //選択した職員の所属
                    kanjiName: '',
                    monthlyLoading:false, //承认状态刷新
                    isConfirm: '', // 承認ステータス
                    isFixed:'', //月次確定情報
                    isSearchHistory: false, //是否允许点击遮罩层关闭
                    selectedDeptViewType: 3, //类型选择
                    currentTab: '',         //組織のツリーと検索タブーを切り替え
                    deptDrawShow: false,    //組織ツリー用
                    treeData:[],            //組織ツリー用
                    empDeptLoading: false,  // 組織ツリーloading用
                    searchTypesList: [],     //組織ツリー用
                    searchConditionsList: [],//組織ツリー用
                    empTreeData: [],        //組織ツリー用
        //月次テーブル 使用参数
                    flexTime:'', //flex対応
                    bDispKinmujokyoKakunin:false,  //勤務欄表示
                    bDispKenkojotaiKakunin:false,　//健康欄表示
                    hatuReiDisp:false, //発令
                    hatuReiName:'',
                    hatuResTimeRange:'',
                    bWorkChkStatus:false,　　　　　　//勤務データ有無
                    bHealthChkStatus:false,　　　　　//健康データ有無
                    monthlyTilteMapList: [],　　　　　//月次情報表示項目
                    columns: [], //月次情報
                    dailyDataList: [],　//月次情報
                    loading: false,
                    selHealthStatusList: [
                        {
                            code:'TMG_ONOFF|0',
                            name:'いない'
                        },
                        {
                            code:'TMG_ONOFF|1',
                            name:'いる'
                        }
                    ],
                    countNotApprovalDay:'', //未承认日数
                    referListObject: {       //組織ツリー共通
                        [[${ TREEVIEW_KEY_PERM_TARGET_SECTION }]]: '',
                        [[${ TREEVIEW_KEY_PERM_TARGET_EMP }]]: '',
                        [[${ TREEVIEW_KEY_PERM_TARGET_GROUP }]]: '',
                        [[${ TREEVIEW_KEY_RECORD_DATE }]]: '',
                        [[${ TREEVIEW_KEY_REFRESH_FLG }]]: '',
                        hidSearchItems:'EMPLOYEEID',
                        hidSearchCondition:'BROADMATCH',
                        hidSearchData:'',
                        psSite: Utils.getUrlParam(location.href, 'psSite'),
                        psApp: Utils.getUrlParam(location.href,'psApp'),
                        type: 11
                    },

        //body 使用参数
                    query: {
                        txtTmgReferListTreeViewPermTargetEmp: '',        //組織ツリーで選択した職員番号
                        txtTmgReferListTreeViewPermTargetSection:'',
                        txtTmgReferListTreeViewRecordDate:'',
                        txtTmgReferListTreeViewPermTargetGroup:'',
                        hidSelectTab:'0',      //組織タブー0：ツリ、1:検索
                        psSite: Utils.getUrlParam(location.href, 'psSite'),
                        psApp: Utils.getUrlParam(location.href,'psApp'),
                        txtDYYYYMM: '',
                        txtDYYYYMMDD: '',
                        txtAction:''
                    },
                    updateMonthloading:false,
                    today:'',

        //日次承认画面使用参数
                    dailyloading:false,
                    title: {
                        type: String,
                        default: ''
                    },
                    isShow: false, //抽屉开关
                    errorFlag: false, //错误信息开关
                    errorMsg: '',//错误信息
                    bHoliday: false, //就業区分マスタ
                    bFixed: false, //確定状態
                    hasPassedTimeCheck: false,
                    // 更新履歴の表示制御
                    isLogShow: false,
                    updateDailyLoading: false,
                    //就業区分
                    workingId: '',
                    workingIdList: [],
                    // 就業区分切替の表示制御
                    bDisable: false,
                    overHourLimit: '',
                    // 出張区分切替の表示制御
                    businessTrip: '',
                    businessTripList: [],
                    // 非勤務と超過勤務区分切替の表示制御
                    categoryNonduty: '',
                    categoryNondutyName: '',
                    categoryNondutyList: [],
                    categoryOverhours: '',
                    categoryOverhoursName: '',
                    categoryOverhoursList: [],
                    dailyEdit:[],
                    notapproval:false,
                    columnsWork: [
                        {
                            title: '勤務時間',
                            align: 'center',
                            key: 'workTime'
                        },
                        {
                            title: '始業',
                            slot: 'workStart',
                            align: 'center'
                        },
                        {
                            title: '終業',
                            slot: 'workEnd',
                            align: 'center'
                        }
                    ],
                    columnsNotWork: [
                        {
                            title: '内容',
                            align: 'center',
                            width: '120',
                            key: 'itemName'
                        },
                        {
                            title: '開始時刻',
                            width: '80',
                            slot: 'tdadNopen',
                            align: 'center'
                        },
                        {
                            title: '終了時刻',
                            slot: 'tdadNclose',
                            width: '80',
                            align: 'center'
                        },
                        {
                            title: '備考',
                            slot: 'tdadCsparechar1',
                            align: 'center'
                        },
                        {
                            title: '削除',
                            slot: 'tdadNdeleteflg',
                            width: '80',
                            align: 'center'
                        }
                    ],
                    detailNonDutyVOList: [],
                    columnsOverWork: [
                        {
                            title: '内容',
                            align: 'center',
                            width: '120',
                            key: 'itemName'
                        },
                        {
                            title: '開始時刻',
                            width: '80',
                            slot: 'tdadNopen',
                            align: 'center'
                        },
                        {
                            title: '終了時刻',
                            slot: 'tdadNclose',
                            width: '80',
                            align: 'center'
                        },
                        {
                            title: '用務内容',
                            slot: 'tdadCsparechar1',
                            align: 'center'
                        },
                        {
                            title: '状態',
                            key: 'tdadCsparechar2Name',
                            align: 'center'
                        },
                        {
                            title: '削除',
                            slot: 'tdadNdeleteflg',
                            width: '80',
                            align: 'center'
                        }
                    ],
                    detailOverhoursVOList: [],
                    columnsDailyLog: [
                        {
                            title: '更新者',
                            key: 'cmodifierusernm',
                            width: '120'
                        },
                        {
                            title: '更新日時',
                            key: 'dmodifieddate',
                            width: '140',
                            align: 'center'
                        },
                        {
                            title: '画面',
                            key: 'cmodifierprogramnm',
                            width: '100',
                            align: 'center'

                        },
                        {
                            title: '操作',
                            key: 'cactionnm',
                            width: '130',
                            align: 'center'
                        },
                        {
                            title: '更新内容',
                            key: 'cchangelogstr'
                        }
                    ],
                    dailyLog: [],
                    workData0: [],
                    // 承認者コメントの入力制御
                    bApproved: false,
                    isCommonDiscretionaryLabor: false,//裁量労働制+就业实际时间修改控制
                    isDiscretion:false,//裁量労働制
                    tmgResultsDto: {
                        txtAction: '',
                        holiday: false,
                        txtTdaNopenR: '',
                        txtTdaNcloseR: '',
                        workingId: '',
                        selMgdCbusinessTrip: '',
                        txtDYYYYMMDD: '',
                        tdaCowncommentR: '',
                        nonDutyList: [],
                        overHoursList: [],
                        hasAuthority: true,
                        targetEmp:'',
                        psSite: Utils.getUrlParam(location.href, 'psSite')
                    },　//参数
                    workData:[],//就业时间
                    workTimeDisable:false, //就業時間制御
                    isMonthlyApproval:false
                }
            },
            async mounted() {
                await this.getInit()
            },
            created() {
            },
            computed: {
                tableHeadFixed() {
                    if (this.contentScrollTop > 310) return true
                    else return false
                },

            },
            methods: {
//head用　所属　年月　氏名
                //初期化処理
                async getInit() {
                    let targetPermEmp = [[${ session.txtTmgReferListTreeViewPermTargetEmp }]]
                    let targetPermSection = [[${ session.txtTmgReferListTreeViewPermTargetSection }]]

                    if(Utils.formatDate([[${ session.TmgReferListSYSDATE }]], 'yyyy/mm/dd')){
                        this.referListObject.txtTmgReferListTreeViewRecordDate =  Utils.formatDate([[${ session.TmgReferListSYSDATE }]], 'yyyy/mm/dd')
                    }
                    await this.getOrgTree()
                    console.log([[${ session }]])
                    //　初回サイトの画面にアクセスするなら、targetSectionがnullであることから、下記通りでデフォルト所属を設定する
                    if (targetPermSection) {
                        let getEmpCode=this.getEmpCode(this.treeData,targetPermEmp,targetPermSection)
                        console.log(getEmpCode)
                        if (getEmpCode) {
                            console.log(1)
                            this.getDeptName(this.treeData,targetPermSection)
                            this.getEmpName(this.treeData,targetPermEmp)
                            this.referListObject.txtTmgReferListTreeViewPermTargetSection = [[${ session.txtTmgReferListTreeViewPermTargetSection }]]
                            this.referListObject.txtTmgReferListTreeViewPermTargetGroup = [[${ session.txtTmgReferListTreeViewPermTargetGroup }]]
                            this.referListObject.txtTmgReferListTreeViewPermTargetEmp = [[${ session.txtTmgReferListTreeViewPermTargetEmp }]]
                            this.query.txtTmgReferListTreeViewPermTargetSection = this.referListObject.txtTmgReferListTreeViewPermTargetSection
                            this.query.txtTmgReferListTreeViewPermTargetEmp = this.referListObject.txtTmgReferListTreeViewPermTargetEmp
                            this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                            this.query.txtDYYYYMM = this.referListObject.txtTmgReferListTreeViewRecordDate.slice(0,8)+'01'
                        } else {
                            console.log(2)
                            this.getDeptName(this.treeData,targetPermSection)
                            this.getEmpName(this.treeData,this.referListObject.txtTmgReferListTreeViewPermTargetEmp)
                            this.referListObject.txtTmgReferListTreeViewPermTargetSection = [[${ session.txtTmgReferListTreeViewPermTargetSection }]]
                            this.referListObject.txtTmgReferListTreeViewPermTargetGroup = [[${ session.txtTmgReferListTreeViewPermTargetGroup }]]
                            this.query.txtTmgReferListTreeViewPermTargetSection = this.referListObject.txtTmgReferListTreeViewPermTargetSection
                            this.query.txtTmgReferListTreeViewPermTargetEmp = this.referListObject.txtTmgReferListTreeViewPermTargetEmp
                            this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                            this.query.txtDYYYYMM = this.referListObject.txtTmgReferListTreeViewRecordDate.slice(0,8)+'01'
                        }
                    }else{
                        console.log(0)
                        console.log(this.treeData)
                        this.deptName = this.treeData[0].label
                        this.referListObject.txtTmgReferListTreeViewAdminTargetSection = this.treeData[0].secid
                        this.referListObject.txtTmgReferListTreeViewPermTargetGroup = this.treeData[0].groupid
                        this.referListObject.txtTmgReferListTreeViewPermTargetEmp =this.treeData[0].children[0].empid
                        this.getEmpName(this.treeData,this.referListObject.txtTmgReferListTreeViewPermTargetEmp)
                        this.query.txtTmgReferListTreeViewPermTargetSection = this.referListObject.txtTmgReferListTreeViewPermTargetSection
                        this.query.txtTmgReferListTreeViewPermTargetEmp = this.referListObject.txtTmgReferListTreeViewPermTargetEmp
                        this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    }
                    //一覧画面取得
                    await this.getSearchCondition()
                    await this.getWorkDateList()
                    this.getTitleData()
                },
                getEmpCode(data,empId,sectionId) {
                    let dept =false
                    data.forEach(e => {
                        if (e.secid === sectionId) {
                            e.children.forEach(j => {
                                if (j.empid === empId) {
                                    console.log(j)
                                    dept=true
                                }
                            })
                            if(!dept){
                                this.referListObject.txtTmgReferListTreeViewPermTargetEmp=e.children[0].empid
                            }
                        }

                    })
                    return dept
                },
                getDeptName(data,section) {
                    // idによりループ処理でdeptNameを取得する
                    data.forEach(e => {
                        if (e.secid === section) {
                            this.deptName = e.label
                        }
                    })
                },
                getEmpName(data,empId) {
                    // idによりループ処理でdeptNameを取得する
                    data.forEach(e => {
                        e.children.forEach(j => {
                            if (j.empid === empId) {
                                this.kanjiName = j.empname
                            }
                        })
                    })
                },
                async getOrgTree() {
                    this.empDeptLoading = true
                    try {
                        const { groupMemberList, memberList, sectionMemberList, recordDate } = await this.http.get('sys/tree', this.referListObject)
                        // 先将数据转为标准格式，再转为可用数据
                        if(this.selectedDeptViewType === 3) {
                            this.treeData = Utils.convertTreeData(sectionMemberList)
                        }
                        if(this.selectedDeptViewType === 2) {
                            this.treeData = Utils.convertTreeData(groupMemberList)
                        }
                        if(this.selectedDeptViewType === 1) {
                            this.treeData = Utils.convertTreeData(memberList)
                        }
                        this.referListObject.txtTmgReferListTreeViewRecordDate = recordDate
                        //await this.getWorkDateList()
                    } catch (error) {
                        return
                    } finally {
                        this.loading = false
                        this.empDeptLoading = false
                    }
                },

                currentTabChanged(name) {
                    if (name=="organisationTree") {
                        this.query.hidSelectTab='0'
                    } else if (name=="organisationSearch") {
                        this.query.hidSelectTab='1'
                    }
                },
                async handleDeptDateChange(e) {
                    this.referListObject.txtTmgReferListTreeViewRecordDate = e
                    this.isSearchHistory = true
                    await this.getOrgTree()
                    this.$Notice.warning({ title:'所属図更新完了',desc:"下記の所属リストから対象を選んでください" })
                    this.empTreeData= []
                },
                async handleDeptViewTypeChange() {
                    await this.getOrgTree()
                    this.$Notice.success({ title:'所属図更新完了' })
                },
                async handleClickLeaf(e) {
                    //同一部署を二回目でクリックすると、取消とするためで、エラーあり
                    //よって、二回目クリックすると、何もしない
                    if(!e[0]) return
                    if(e[0].children) return
                    this.deptDrawShow = false
                    const section = [[${ TREEVIEW_KEY_PERM_TARGET_SECTION }]]
                    const group = [[${ TREEVIEW_KEY_PERM_TARGET_GROUP }]]
                    console.log(e)
                    this.query.txtTmgReferListTreeViewPermTargetSection = e[0].secid
                    this.referListObject[section] = e[0].secid

                    this.query.txtTmgReferListTreeViewPermTargetGroup = e[0].groupid
                    this.referListObject[group] = e[0].groupid

                    this.deptName = e[0].secnic
                    this.query.txtTmgReferListTreeViewPermTargetEmp = e[0].empid
                    this.referListObject.txtTmgReferListTreeViewPermTargetEmp = e[0].empid
                    this.kanjiName = e[0].empname
                    this.selectDisabled = true
                    await this.getWorkDateList()


                    if (!this.query.txtDYYYYMM){
                        this.$Notice.warning({ title: '年月を選択して下さい' })
                    }else{
                        await this.getTitleData()
                    }
                },
                searchOrgTree: Debounce( async function() {
                    this.empDeptLoading = true
                    try {
                        const { data } = await this.http.get('sys/tree/search', this.referListObject)
                        this.empTreeData = Utils.convertTreeData(data)
                        this.$Notice.success({ title:'所属図更新完了' })
                    } catch (error) {
                        return
                    } finally {
                        this.empDeptLoading = false
                    }
                }),
                // 年月選択
                async handleStartMonth(e) {
                    this.query.txtAction = 'ACT_DISP_RMONTHLY'
                    this.query.txtDYYYYMM = e
                    //this.query.txtDYYYYMMDD = this.query.today
                    // 就業実績 --月次・日次実績
                    await this.getTitleData()

                },
                handleScroll: Throttle(function (e) {
                    this.contentScrollTop = e.target.scrollTop
                    if (e.target.scrollTop > 200) {
                        this.isScroll = true
                    } else {
                        this.isScroll = false
                    }
                }, 50),
                async getSearchCondition() {
                    const { data } = await this.http.get('sys/tree/conditions', this.referListObject)
                    this.searchConditionsList= Object.keys(data.searchConditions).map(e=> { return { name:data.searchConditions[e], value:e }})
                    this.searchTypesList = Object.keys(data.searchTypes).map(e=> { return { name:data.searchTypes[e], value:e }})
                },

//月次一覧画面用
                // 勤務年月一覧取得
                async getWorkDateList() {
                    this.query.txtAction = 'ACT_DISP_RMONTHLY'
                    try {
                        const {data} = await this.http.get('sys/tmgResults/workDateList', this.query)

                        this.dispMonthlyList = data.monthLy
                        if (data.monthLy.length > 0) {
                            let check　= false
                            check =  this.dispMonthlyList.map(e =>{

                                if(this.query.txtDYYYYMM === e.code){
                                    return true
                                }
                            })
                            console.log(check)
                            if(!check || this.query.txtDYYYYMM ===''){
                                this.model1 = this.dispMonthlyList[0].code
                                this.query.txtDYYYYMM = this.model1
                            }else{
                                this.model1 = this.query.txtDYYYYMM
                            }
                            //年月リストを取得する時に、活性化にする
                            this.selectDisabled = true
                        }

                        //年月リスト.lengthがゼロ場合、非活性化にする
                        if (data.monthLy.length === 0) {
                            this.model1 = ''
                            this.selectDisabled = false
                        }
                    } catch (error) {
                        return
                    }
                },
                // 発令
                async getHatuRei() {
                    try {
                       const { data } = await this.http.get('sys/tmgResults/hatuRei', this.referListObject)
                        if(data !=null){
                            this.hatuReiDisp=true
                            this.hatuReiName=data.name
                            this.hatuResTimeRange=data.timerange
                        }else{
                            this.hatuReiDisp=false
                        }
                    } catch (error) {
                        return
                    }finally {

                    }
                },
                // 就業実績のタイトルとデータを取得
                async getTitleData() {

                    this.getHatuRei()
                    this.query.txtAction = 'ACT_EDITINP_RDAILY'
                    this.monthlyMap = ''
                    this.dailyDataList = []
                    try {
                        this.monthlyLoading=true
                        this.updateMonthloading=true
                        const {data,sysDate} = await this.http.get('sys/tmgResults/getTitleData', this.query)
                        this.isMonthlyApproval = data.isMonthlyApproval
                        this.bDispKinmujokyoKakunin = data.workHealthChkVO.bdispKinmujokyoKakunin
                        this.bDispKenkojotaiKakunin = data.workHealthChkVO.bdispKenkojotaiKakunin
                        this.bWorkChkStatus = data.workHealthChkVO.bworkChkStatus
                        this.bHealthChkStatus = data.workHealthChkVO.bhealthChkStatus
                        this.kinmujokyoEnd = data.workHealthChkVO.kinmujokyoEnd
                        this.selHealthStatus = data.workHealthChkVO.selHealthStatus
                        this.countNotApprovalDay=data.countNotApprovalDay
                        this.monthlyTilteMapList = data.monthlyTilteMapList
                        this.monthlyMap = data.monthlyDateMap
                        this.flexTime=data.flexTime
                        this.isConfirm = data.monthlyDateMap.TMO_CSTATUSFLG
                        this.isFixed = data.monthlyDateMap.FIXED
                        this.today=sysDate
                        this.columns = data.dailyTittleMapList.map(e => {
                            return {
                                ...e,
                                title: e.title.replace(TURN_LINE_STR, '\n')
                            }
                        })
                        this.dailyDataList = data.dailyMapList
                    } catch (error) {
                        return
                    }finally {
                        this.monthlyLoading= false
                        this.updateMonthloading=false
                    }
                },
                rowClass(row) {
                    if (row.today) {
                        return 'select-col sun'
                    }
                    if (!row.dayDivisionCode || row.dayDivisionCode === '1') {
                        return 'select-col'
                    }
                    return 'select-col sat'
                },
                dayRed(e,i) {
                    const dayOfWeek = e.TMG_HOLFLG
                    if(i === 0){
                        if (e.TDA_DYYYYMMDD === this.today) {
                            return 'brown cursor'
                        }
                        if (dayOfWeek.trim() === 'TMG_HOLFLG|0') {
                            return 'cursor'
                        }
                        if (dayOfWeek.trim() != 'TMG_HOLFLG|0') {
                            return 'blue cursor'
                        }

                    }else{
                        if (e.TDA_DYYYYMMDD === this.today) {
                            return 'brown'
                        }
                        if (dayOfWeek.trim() === 'TMG_HOLFLG|0') {
                            return
                        }
                        if (dayOfWeek.trim() != 'TMG_HOLFLG|0') {
                            return 'blue'
                        }

                    }
                },
                async updateMonth(e) {
                    if (e === 'approval') {
                        this.query.txtAction = 'ACT_FIXED'
                    } else if (e === 'cancel') {
                        this.query.txtAction = 'ACT_RESCISSION'
                    }
                    try{
                        this.updateMonthloading=true
                        await this.http.postForm('sys/tmgResults/updateMonth', this.query)
                        this.getTitleData()
                    }catch(error){
                        return
                    }finally {
                        this.updateMonthloading=false
                    }

                },
                async confWork(){
                    this.query.txtAction='ACT_CONF_WORK_OFF'
                    this.query.txtDYYYYMM = this.model1
                    await this.http.get('sys/tmgResults/updateWorkChk', this.query)
                    this.bWorkChkStatus = true
                    this.getTitleData()
                },
                async confHealth(){
                    this.query.txtAction='ACT_CONF_HEALTH_OFF'
                    this.query.txtDYYYYMM = this.model1
                    this.query.selHealthStatus= this.selHealthStatus
                    await this.http.get('sys/tmgResults/updateHealthChk', this.query)
                    this.bHealthChkStatus = true
                    this.getTitleData()
                },



//日次承認画面用
                //一覧から日次実績をクリックする
                async showDay(e) {
                    // 業登録画面表示
                    this.isShow = true
                    this.dailyloading = true

                    // 就業登録画面項目クリアする
                    this.categoryNonduty = ''
                    this.categoryOverhours = ''
                    this.dailyEdit = []
                    this.workData0 = []
                    this.detailNonDutyVOList = []
                    this.detailOverhoursVOList = []

                    this.title = '  '
                    this.query.txtDYYYYMMDD = e
                    this.query.txtAction = 'ACT_EDITINP_RDAILY'
                    this.bFixed = false
                    this.bHoliday = false
                    // 業登録画面データ取得
                    await this.dailyDetail()
                    this.dailyloading = false
                },

                // 就業登録画面情報取得・設定する
                async dailyDetail() {
                    if(this.$refs.select1){
                        this.$refs.select1.clearSingleSelect()
                    }
                    if(this.$refs.select2){
                        this.$refs.select2.clearSingleSelect()
                    }
                    if(this.$refs.select3){
                        this.$refs.select3.clearSingleSelect()
                    }
                    if(this.$refs.select4){
                        this.$refs.select4.clearSingleSelect()
                    }
                    // 画面情報取得
                    const {data} = await this.http.get('sys/tmgResults/dailyDetail', this.query)

                    // 就業区分ドロップダウン
                    this.workingIdList = data.workIdList

                    // 出張ドロップダウン
                    this.businessTripList = data.businessTripList

                    // 非勤務ドロップダウン
                    this.categoryNondutyList = data.categoryNondutyList
                    this.categoryNonduty = this.categoryNondutyList[0].itemCode

                    // 超過勤務ドロップダウン
                    this.categoryOverhoursList = data.categoryOverhoursList
                    this.categoryOverhours = this.categoryOverhoursList[0].itemCode
                    this.mgdCsparechar4VOList = data.mgdCsparechar4VOList

                    // 詳細:欠勤離籍以外
                    this.workData0 = data.dailyDetail0List
                    // 就業実績
                    this.dailyEdit = data.dailyEditVO

                    if (('TMG_DATASTATUS|9' === this.dailyEdit.tdaCstatusflg || 'TMG_DATASTATUS|5' === this.dailyEdit.tdaCstatusflg)
                        && '' !== this.dailyEdit.tdaCmodifieruseridR
                        && '' !== this.dailyEdit.tdaDmodifieddateR
                    ) {
                        this.bApproved = true
                    } else {
                        this.bApproved = false
                    }

                    // 登録ボタンとコメントのみ登録ボタンの表示制御
                    this.bFixed = !data.isEditable
                    if (data.workIdList.length < 2) {
                        this.bHoliday = true
                    }


                    this.isCommonDiscretionaryLabor = data.isCommonDiscretionaryLabor
                    this.isDiscretion=data.isDiscretion

                    if (this.dailyEdit.tdaNopenR !== this.dailyEdit.tdaNopenTp) {
                        this.bOpen = true
                    } else {
                        this.bOpen = false
                    }
                    if (this.dailyEdit.tdaNcloseR !== this.dailyEdit.tdaNcloseTp) {
                        this.bClose = true
                    } else {
                        this.bClose = false
                    }


                    this.dailyEdit.tdaNcloseR = this.dailyEdit.tdaNopenRHidden
                    this.dailyEdit.tdaNcloseR = this.dailyEdit.tdaNcloseRHidden


                    if (this.dailyEdit.tdaNopenTp === null) {
                        this.dailyEdit.tdaNopenTp = '---'
                    }
                    if (this.dailyEdit.tdaNcloseTp === null) {
                        this.dailyEdit.tdaNcloseTp = '---'
                    }
                    if (this.isDiscretion) {
                        this.dailyEdit.tdaNopenN = '---'
                        this.dailyEdit.tdaNcloseN = '---'
                    }

                    this.workingId = this.dailyEdit.tdaCworkingidR
                    this.businessTrip = this.dailyEdit.tdaCbusinesstripidR
                    this.title = this.dailyEdit.tdaDyyyymmddDy

                    if(this.dailyEdit.tdaCerrcode !== null){

                        let tempErrCode = JSON.parse(this.dailyEdit.tdaCerrcode)
                        Object.keys(tempErrCode).some(e => {

                            if (e === 'ERRTYPE_10') {

                                this.$Notice.error({desc: tempErrCode.ERRTYPE_10[0].ERRMSG})
                                return true
                            }
                        })

                    }
                    this.workData=[
                        {
                            workTime: '予定時間',
                            workStart: this.dailyEdit.tdaNopenN,
                            workEnd: this.dailyEdit.tdaNcloseN,
                            cellClassName: {
                                workTime: 'sub-title'
                            }
                        },
                        {
                            workTime: '打刻',
                            workStart: this.dailyEdit.tdaNopenTp,
                            workEnd: this.dailyEdit.tdaNcloseTp,
                            cellClassName: {
                                workTime: 'sub-title'
                            }
                        },
                        {
                            workTime: '就業時間',
                            workStart: this.dailyEdit.tdaNopenR,
                            workEnd: this.dailyEdit.tdaNcloseR,
                            isInput: true,
                            cellClassName: {
                                workTime: 'sub-title'
                            }
                        }]
                    this.workData0.forEach(e => {
                        this.workData = this.workData.concat(
                            {
                                workTime: e.tdadCnotworkName,
                                workStart: e.tdadNopenHhmi,
                                workEnd: e.tdadNcloseHhmi,
                                cellClassName: {
                                    workTime: 'sub-title'
                                }
                            }
                        )
                    })
                    // 非勤務
                    this.detailNonDutyVOList = data.detailNonDutyVOList
                    // 超過勤務
                    this.detailOverhoursVOList = data.detailOverhoursVOList
                    //
                    const turnLine = Vue.filter('turnLine');
                    this.dailyLog = data.columnsDailyLog.map(e => {
                        return {
                            ...e,
                            cchangelogstr: turnLine(e.cchangelogstr)

                        }
                    })
                    let limitOfBasedateVO = data.limitOfBasedateVO
                    this.overHourLimit = limitOfBasedateVO.dailyConvMinute
                    this.otDaily = limitOfBasedateVO.otDaily
                    this.targetForOverTime = data.targetForOverTime
                    this.changeWorkingID(this.workingId)
                    if(data.dailyEditVO.tdaCstatusflg==='TMG_DATASTATUS|5' && 'TMG_DATASTATUS|0'===this.monthlyMap.TMO_CSTATUSFLG ){
                        this.notapproval=true
                    }else{
                        this.notapproval=false
                    }

                },
                //承認
                async updateDaily() {
                    if (!this.errorCheck(this.workingId)) {
                        return
                    }


                    this.tmgResultsDto.txtDYYYYMMDD = this.query.txtDYYYYMMDD
                    this.tmgResultsDto.txtAction = 'ACT_EDITPERM_UPERMIT'

                    this.tmgResultsDto.workingId = this.workingId
                    this.tmgResultsDto.selMgdCbusinessTrip = this.businessTrip
                    this.tmgResultsDto.txtTdaNopenR = ''
                    this.tmgResultsDto.txtTdaNcloseR = ''
                    this.tmgResultsDto.txtTdaCbosscommentR = this.dailyEdit.tdaCbosscommentR
                    this.tmgResultsDto.hasAuthority = ''
                    this.tmgResultsDto.nonDutyList = []
                    this.tmgResultsDto.overHoursList = []
                    this.tmgResultsDto.targetEmp=this.query.txtTmgReferListTreeViewPermTargetEmp
                    this.tmgResultsDto.holiday = this.bHoliday
                    if (!this.bDisable) {
                        this.tmgResultsDto.txtTdaNopenR = this.workData[2].workStart
                        this.tmgResultsDto.txtTdaNcloseR = this.workData[2].workEnd
                        this.tmgResultsDto.nonDutyList = this.detailNonDutyVOList
                        this.tmgResultsDto.overHoursList = this.detailOverhoursVOList
                        if (this.bFixed || this.bHoliday) {
                            this.tmgResultsDto.hasAuthority = false
                        } else {
                            this.tmgResultsDto.hasAuthority = true
                        }
                    }
                    this.$Modal.confirm({
                        inDrawer: true,
                        title: 'この内容で承認します。よろしいですか？',
                        width: 400,
                        okText: 'OK',
                        inDrawer: true,
                        cancelText: 'キャンセル',
                        onOk: async () => {
                            try {
                                this.updateDailyLoading = true
                                const {msg} = await this.http.post('sys/tmgResults/updateDaily', this.tmgResultsDto)
                                if (msg === '0') {
                                    this.updateDailyLoading = false
                                    this.isShow = false
                                    this.getTitleData()
                                    return
                                }
                                this.errMsg = JSON.parse(msg)
                                let errMsg20
                                let check = Object.keys(this.errMsg).some(e => {
                                    if (e === 'ERRTYPE_10') {
                                        this.$Notice.error({desc: this.errMsg.ERRTYPE_10[0].ERRMSG})
                                        return true
                                    }
                                    if (e === 'ERRTYPE_20') {
                                        this.errMsg.ERRTYPE_20.forEach(e20 => {
                                            errMsg20 = errMsg20 + e20.ERRMSG + '/n'
                                        })
                                        this.$Notice.error({desc: errMsg20})
                                    }

                                })
                                if (check) {

                                    return false
                                }
                            }catch(error){
                                return
                            }finally {
                                this.updateDailyLoading = false
                            }
                        }
                    })
                },
                //差戻
                async updateRemandsStatus() {
                    this.$Modal.confirm({
                        inDrawer: true,
                        title: '勤務実績の内容を入力者へ差戻します。よろしいですか？\n'+'※今回、入力した内容は、承認者コメントのみ保存されます',
                        width: 490,
                        inDrawer: true,
                        okText: 'OK',
                        cancelText: 'キャンセル',
                        onOk: async () => {

                            this.tmgResultsDto.txtDYYYYMMDD = this.query.txtDYYYYMMDD
                            this.tmgResultsDto.txtAction = 'ACT_REMANDS'
                            this.tmgResultsDto.workingId = this.workingId
                            this.tmgResultsDto.selMgdCbusinessTrip = this.businessTrip
                            this.tmgResultsDto.holiday = this.bHoliday
                            this.tmgResultsDto.txtTdaNopenR = this.dailyEdit.tdaNopenR
                            this.tmgResultsDto.txtTdaNcloseR = this.dailyEdit.tdaNcloseR
                            this.tmgResultsDto.txtTdaCbosscommentR = this.dailyEdit.tdaCbosscommentR
                            if (this.bFixed || this.bHoliday) {
                                this.tmgResultsDto.hasAuthority = false
                            } else {
                                this.tmgResultsDto.hasAuthority = true
                            }
                            this.tmgResultsDto.targetEmp=this.query.txtTmgReferListTreeViewPermTargetEmp
                            try{
                                this.updateDailyLoading = true
                                const {msg} = await this.http.post('sys/tmgResults/updateDaily', this.tmgResultsDto)
                                this.updateDailyLoading = false
                                this.isShow = false
                                this.getTitleData()
                                return
                            }catch (error) {
                                return
                            }finally {
                                this.updateDailyLoading = false
                            }
                        }
                    })
                },
                // 就業区分の切り替え表示制御
                changeWorkingID(workingid) {
                    if(!workingid){
                        return
                    }
                    this.bDisable = false;
                    // 休暇
                    if (this.bHoliday) {
                        this.bDisable = true;
                        this.workTimeDisable=true
                        // 休暇以外
                    } else {
                        let mgdCsparechar4VO = this.mgdCsparechar4VOList.find(e => e.mgdCmastercode === workingid)
                        // 出勤 or 休日出勤
                        if (mgdCsparechar4VO.mgdCsparechar5 == '0') {
                            this.bDisable = false;
                            this.workTimeDisable=false
                            // 欠勤
                        } else {
                            this.bDisable = true;
                            this.workTimeDisable=true
                        }
                    }
                    if (this.bDisable === true) {
                        this.workData[2].workStart=''
                        this.workData[2].workEnd=''
                        this.detailNonDutyVOList = []
                        this.detailOverhoursVOList = []

                    }
                },
                // エラーチェック
                errorCheck(workingid) {
                    let mgdCsparechar4VO = this.mgdCsparechar4VOList.find(e => e.mgdCmastercode === workingid)
                    // 出勤 or 休日出勤
                    if (mgdCsparechar4VO.mgdCsparechar5 != '0') {
                        return true;
                    }
                    // 修正出社時刻形式
                    if (this.workData[2].workStart ===null || !this.time_check(this.workData[2].workStart)) {
                        this.$Notice.error({desc: "就業時間・始業は適切な時刻ではありません。(hh:mm)形式で時刻を入力してください。"})
                        return false;
                    }

                    // 修正退社時刻形式
                    if (this.workData[2].workEnd ===null || !this.time_check(this.workData[2].workEnd)) {
                        this.$Notice.error({desc: "就業時間・終業は適切な時刻ではありません。(hh:mm)形式で時刻を入力してください。"})
                        return false;
                    }

                    if (this.dailyEdit.tdaCbosscommentR !== null && this.getLengthB(this.dailyEdit.tdaCbosscommentR) > 100) {
                        this.$Notice.error({desc: "承認者コメント考が設定値を超えています。全角・半角カナ50字以内、半角英数100字以内。"})
                        return false;
                    }

                    //非勤務
                    const checkNonDuty = this.detailNonDutyVOList.some(e => {

                        if (e.tdadNopen ===null ||  !this.time_check(e.tdadNopen)) {
                            this.$Notice.error({desc: "非勤務の開始時刻は適切な時刻ではありません。(hh:mm)形式で時刻を入力してください。"})
                            return true;
                        }
                        if (e.tdadNclose ===null ||  !this.time_check(e.tdadNclose)) {
                            this.$Notice.error({desc: "非勤務の終了時刻は適切な時刻ではありません。(hh:mm)形式で時刻を入力してください。"})
                            return true;
                        }
                        if (e.tdadCsparechar1 !== null && this.getLengthB(e.tdadCsparechar1) > 100) {
                            this.$Notice.error({desc: "中断備考が設定値を超えています。全角・半角カナ50字以内、半角英数100字以内。"})
                            return true
                        }
                    })
                    if (checkNonDuty) return false
                    // 超過勤務
                    const checkOverhour = this.detailOverhoursVOList.some(e => {

                        if (e.tdadCsparechar1 !== null && e.tdadCsparechar1.length > 100) {
                            this.$Notice.error({desc: "超過勤務備考が設定値を超えています。全角・半角カナ50字以内、半角英数100字以内。"})
                            return true
                        }
                    })
                    if (checkOverhour) return false
                    let nOverTimeTotal = 0;
                    // 超過勤務命令の明細部配下を行単位で取得
                    this.detailOverhoursVOList.forEach(e => {
                        // 超過勤務命令の時間数を算出
                        let sOpen = this.toMinuteFromHHcMI60(e.tdadNopen);
                        let sClose = this.toMinuteFromHHcMI60(e.tdadNclose);
                        nOverTimeTotal = nOverTimeTotal + (sClose - sOpen);
                    })
                    // 超過勤務命令時間が入力されていて、超過勤務対象「無」の場合は警告メッセージを表示する
                    if (nOverTimeTotal > 0 && this.targetForOverTime === "1") {
                        // 警告メッセージの表示および、応答の確認

                        if(!confirm('超過勤務対象外として設定されています。\n超過勤務命令を登録してもよろしいですか？')){
                            return false
                        }
                    }
                    // 超過勤務命令時間数合計が登録された超勤限度時間を超える場合は警告メッセージを表示する
                    if (nOverTimeTotal > this.overHourLimit) {
                        // 警告メッセージの表示および、応答の確認
                        if(!confirm('超過勤務命令の時間数が' +this.otDaily +'時間を超えています。\nこの超過勤務時間で登録してよろしいですか？')){
                            return false
                        }
                    }
                    return true;
                },
                getLengthB(moji) {
                    let i, j, cnt = 0;
                    let multiStr = new Array("×", "§", "¨", "°", "±", "´", "¶");
                    for (i = 0; i < moji.length; i++) {
                        for (j = 0; j < multiStr.length; j++) {
                            if (multiStr[j].length == 0) {
                                continue;
                            }
                            moji = moji.replace(multiStr[j], "00");
                        }
                    }
                    // MAC OSの場合、改行コードが「\n」となり、Windowsの改行コード「\r\n」とバイト数が異なるので、
                    moji = moji.split("\r\n").join("\n"); // 一旦「\r\n」 ⇒ 「\n」の変換を行い、改行コードを「\n」に合わせる。
                    // バイト数を求めます。
                    for (i = 0; i < moji.length; i++)
                        if (escape(moji.charAt(i)).length >= 4) cnt += 2; else cnt++;
                    return cnt;
                },
                time_check(sTime) {
                    return sTime.match(/^(([0-3]?[0-9])|([4][0-7])):([0-5]?[0-9])$/);
                },
                toMinuteFromHHcMI60(pHHMM) {
                    // 何もパラメータが渡されなかった場合、そのまま返す
                    if (pHHMM === '') {
                        return '';
                    }
                    let retMinute;
                    let nHour = new Number();
                    let nMinute = new Number();
                    // 分に変換します
                    nHour = eval(+(pHHMM.split(":")[0] * 60));
                    nMinute = eval(+(pHHMM.split(":")[1]));
                    retMinute = eval(nHour + nMinute);
                    return retMinute;
                },
                handleInputChange(i,object,value,el) {
                    // 填完后自动checkbox
                    if(object) {
                        this.hasPassedTimeCheck = Utils.checkTime(object, value,el)
                    }
                },
                addOverWork() {
                    let detailOverhoursVO = this.categoryOverhoursList.find(e => e.itemCode === this.categoryOverhours)

                    this.detailOverhoursVOList.push({
                        attributeUrl: detailOverhoursVO.attributeUrl,
                        tdadCnotworkid: detailOverhoursVO.itemCode,
                        itemName: detailOverhoursVO.itemName,
                        tdadNopen: '',
                        tdadNclose: '',
                        tdadNdeleteflg: '0',
                        tdadSeq: Date.now(),
                        tdadCsparechar1: '',
                        tdadNsparenum1: '',
                        tdadCcode01: '',
                        tdadCcode01Name: '',
                        tdadCsparechar2: '',
                        tdadCsparechar2Name: ''

                    })
                },
                addNotWork() {
                    let categoryNondutyVO = this.categoryNondutyList.find(e => e.itemCode === this.categoryNonduty)

                    this.detailNonDutyVOList.push({
                        attributeUrl: categoryNondutyVO.attributeUrl,
                        tdadCnotworkid: categoryNondutyVO.itemCode,
                        itemName: categoryNondutyVO.itemName,
                        tdadNdeleteflg: "0",
                        tdadNopen: '',
                        tdadNclose: '',
                        tdadSeq: Date.now(),
                        tdadCsparechar1: '',
                        tdadNsparenum1: null

                    })

                },
                delNotWork(row) {
                    this.detailNonDutyVOList = this.detailNonDutyVOList.filter(e => e.tdadSeq !== row.tdadSeq)
                },
                delOverWork(row) {
                    this.detailOverhoursVOList = this.detailOverhoursVOList.filter(e => e.tdadSeq !== row.tdadSeq)
                },
                handleClose() {
                    this.errorFlag = false
                    this.isShow = false
                    this.$emit('close')
                },
            }
        })
    </script>
</body>

</html>