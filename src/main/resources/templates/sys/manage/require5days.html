<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/header::common_header(title='年5日有給指定',cssPaths='/pages/content.min.css,' + '/pages/tmgacquired5daysholiday.min.css')">
</head>

<body>
<div th:replace="layout/loadingBar::loadingBar"></div>
<!-- 菜单导航栏 -->
<div th:replace="layout/sider"></div>
<main class="content tmgacquired5daysholiday-warp" ref="layout">
    <div class="content_head">
        <div class="header">
            <div class="title1">
                <h1>
                    <Icon type="i-emeer colored"></Icon>
                    {{  '年5日有給指定' }}
                </h1>
            </div>
        </div>
        <div class="searchwrap" >
<!--            <span class="label">年度</span>-->
<!--            <date-picker type="year" :value="query.year" :disabled="!yearShow" class="pr15" placeholder="選択ください" format="yyyy年" ref="datePicker" @on-change="handleYearChange">-->
<!--            </date-picker>-->
            <span style="display:flex;width: calc(15% + 200px);">
                    <span class="label">所属</span>
                    <i-button v-on:click.native="deptDrawShow = true" class="input-like-span dept-select">
                        <Tooltip trigger="hover" :theme="toolTipTheme()" transfer>{{deptName}}
                            <div slot="content">{{deptName}}</div>
                        </Tooltip>
                    </i-button>
                <!-- 共通組織図画面 start-->
                <Drawer class="tc" placement="right" width="700" :closable="false" :mask-closable="!isSearchHistory" v-model="deptDrawShow">
                  <Tabs :animated="false" v-model="currentTab" >
                   <tab-pane label="ツリー" name="organisationTree">
                       <div class="titlenorm mb5">
                            <Icon type="logo-buffer"></Icon>
                            所属
                        </div>
                        <Row class="tl mb5">
                            <i-col span="4" class="label tc" style="height: 32px;">基準日</i-col>
                            <i-col span="7" class="no-border-radius">
                            <date-picker type="date" :value="referListObject.txtTmgReferListTreeViewRecordDate" transfer :options="startLimit"
                                         placeholder="基準日" format="yyyy/MM/dd" ref="datePicker" :clearable="false" @on-change="handleDeptDateChange"></date-picker>
                            </i-col>
                        </Row>
                        <Tree class="tree mt2" :data="treeData" @on-select-change="handleClickLeaf" ref="tree" empty-text="所属データなし">
                        </Tree>
                   </tab-pane>
                   <tab-pane label="検索" name="organisationSearch">
                                <Row :gutter="8" class="tl mb2">
                                    <i-col span="15">
                                        <i-input class="mar mb5 like-select"
                                                 enter-button placeholder="検索" search v-model="referListObject.hidSearchData">
                                            <i-select placeholder="項目" slot="prepend" style="width: 108px"
                                                      transfer v-model="referListObject.hidSearchItems">
                                                <i-option :value="item.value" v-for="(item,i) of searchTypesList">
                                                    {{ item.name }}</i-option>
                                            </i-select>
                                            <i-select placeholder="条件" slot="append"
                                                      style="width: 108px" transfer v-model="referListObject.hidSearchCondition">
                                                <i-option :value="item.value" v-for="(item,i) of searchConditionsList">
                                                    {{ item.name }}</i-option>
                                            </i-select>
                                        </i-input>
                                    </i-col>
                                    <i-col class="no-border-radius" span="8">
                                        <i-button :loading="loading" @click="getSearchTableData" ghost icon="md-search" long
                                                  type="primary">検索</i-button>
                                    </i-col>
                                </Row>
                                <Alert class="primary-info mt10">※検索結果の上位100件を表示しています。</Alert>
                       </tab-pane>
                  </Tabs>
                </Drawer>
                <!-- 共通組織図画面 end-->
                </span>
            <span style="flex:1"></span>
        </div>
    </div>
    <div class="content_body">
        <i-table border :columns="columns" :data="tableData" :loading="dataLoading" :disabled-hover="true"
                 no-data-text="" :row-class-name="() => 'select-col'" >
            <template slot-scope="{ row }" slot="name"><span class="pl5 pr5 cursor row-label-primary tl no-border-radius width100"  @click.stop="handleRowClick(row)">{{ row.name }}</span>
            </template>

            <template slot-scope="{ row }" slot="vactionGiveDay">
                <span v-for="(item, i) of row.vactionGiveDay" :key="i" class="divi-line"><span v-if="item.isReGive" class="re-give">重</span>{{ item.day }}</span>
            </template>

            <template slot-scope="{ row }" slot="paidDays"><span v-for="(item, i) of row.paidDays" :key="i" class="divi-line">{{ item | addNumDeci(true)}}</span>
            </template>

            <template slot-scope="{ row }" slot="basedDay"><span v-for="(item, i) of row.basedDay" :key="i" class="divi-line">{{ item }}</span>
            </template>

            <template slot-scope="{ row }" slot="checkPeriod"><span v-for="(item, i) of row.checkPeriod" :key="i" class="divi-line">{{ item }}</span>
            </template>

            <template slot-scope="{ row }" slot="takenDays"><span v-for="(item, i) of row.takenDays" :key="i" class="divi-line">{{ item | addNumDeci(true)}}</span>
            </template>

            <template slot-scope="{ row }" slot="mustDays"><span v-for="(item, i) of row.mustDays" :key="i" class="divi-line">{{ item | addNumDeci(true)}}</span>
            </template>

            <template slot-scope="{ row }" slot="lackDays"><div v-for="(item, i) of row.lackDays" :key="i" class="divi-line"><span :class="item > 0 ? 'lack-day' : ''">{{ item | addNumDeci(true)}}</span></div>
            </template>
            <template slot-scope="{ row }" slot="season">
                <span v-for="(item, i) of row.season" :key="i" class="divi-line">
                    <span v-if = "item == '詳細'">
                        <i-button type="primary" long ghost size="small" @click.stop="handleBtn(row,i)">{{ item }}</i-button>
                    </span>
                    <span v-else> - </span>
                </span>
            </template>
        </i-table>
        <Modal :mask-closable="false" class="tc" @on-cancel="cancel" :title="titlesMessage" v-model="isShow" width="1130"
               footer-hide>
            <div>
                <Row :gutter="10">
                    <i-col span="8">
                        <div class="label">所属</div>
                        <div class="person-info">{{ privateInfo.deptName }}</div>
                    </i-col>
                    <i-col span="8">
                        <div class="label">氏名</div>
                        <div class="person-info">{{ privateInfo.name }}</div>
                    </i-col>
                    <i-col span="8">
                        <div class="label">種別</div>
                        <div class="person-info">{{ privateInfo.workType }}</div>
                    </i-col>
                </Row>
            </div>
            <div class="tr mt20 mb20" v-if="!isSeason">
                <i-button type="success" @click="register" ghost class="mr15 width15">登録</i-button>
                <i-button type="success" @click="clear" ghost class="mr15 width15">初期化</i-button>
            </div>

            <div class="titlenorm mb10" v-if="!isSeason">
                <Icon type="logo-buffer"></Icon>
                年次休暇付与編集
            </div>
            <i-table border :columns="paidColums" :data="paidData" :loading="loading" v-if="!isSeason && forRest" disabled-hover :row-class-name="() => 'select-col'"
                class="mb30" key="forRest1">
                <template slot-scope="{ row }" slot="radio">
                    <Radio v-model="row.isChecked" @on-change="handleRadio(row._index)"></Radio>
                </template>

                <template slot-scope="{ row }" slot="editBasedDay">
                    <date-picker class="tl" :value="row.editBasedDay" :disabled="row._index !== radioCheckedIndex" @on-change="handleChangeBasedDay($event)" format="yyyy/MM/dd" ref="editDatepicker" transfer type="date"></date-picker>
                </template>

                <template slot="editCheckPeriod" slot-scope="{ row }">
                    <date-picker class="tl" :value="row.editCheckPeriod" :disabled="row._index !== radioCheckedIndex" @on-change="handleChangeCheckPeriod($event)" format="yyyy/MM/dd" ref="editDatepicker1" transfer type="date"></date-picker>
                </template>

                <template slot-scope="{ row }" slot="adjustTakenDays">
                    <input-number :max="999.5" :min="0.0" :step="0.5" :disabled="row._index !== radioCheckedIndex" @on-change="blurAdjustTakenDays(row)" class="tl" v-model="row.adjustTakenDays"/>
                </template>

                <template slot-scope="{ row }" slot="vactionGiveDay">
                    <span v-for="(item, i) of row.vactionGiveDay" :key="i" class="divi-line"><span v-if="item.isReGive" class="re-give">重</span>{{ item.day }}</span>
                </template>

                <template slot-scope="{ row }" slot="paidDays">
                    <span v-for="(item, i) of row.paidDays" :key="i" class="divi-line">{{ item | addNumDeci(true)}}</span>
                </template>

                <template slot-scope="{ row }" slot="editTakenDays">
                    <span>{{ row.editTakenDays  | addNumDeci(true)}}</span>
                </template>

                <template slot-scope="{ row }" slot="mustDays">
                    <span>{{ row.mustDays  | addNumDeci(true)}}</span>
                </template>

                <template slot="editMustDays" slot-scope="{ row }">
                    <input-number :max="999.5" :min="0.0" :step="0.5" :disabled="row._index !== radioCheckedIndex" @on-change="blurEditMustDays(row)" class="tl" v-model="row.editMustDays"/>
                </template>

                <template slot-scope="{ row }" slot="lackDays">
                    <span :class="+row.lackDays ? 'lack-day' : ''">{{ row.lackDays | addNumDeci(true)}}</span>
                </template>

            </i-table>
            <i-table border :columns="paidColums" :data="paidData" :loading="loading" v-if="!isSeason && !forRest" disabled-hover :row-class-name="() => 'select-col'" class="mb30" key="forRest2">
                <template slot-scope="{ row }" slot="radio">
                    <Radio v-model="row.isChecked" @on-change="handleRadio(row._index)"></Radio>
                </template>

                <template slot-scope="{ row }" slot="editBasedDay">
                    <date-picker class="tl" :value="row.editBasedDay" :disabled="row._index !== radioCheckedIndex" @on-change="handleChangeBasedDay($event)" format="yyyy/MM/dd" ref="editDatepicker" transfer type="date"></date-picker>
                </template>

                <template slot="editCheckPeriod" slot-scope="{ row }">
                    <date-picker class="tl" :value="row.editCheckPeriod" :disabled="row._index !== radioCheckedIndex" @on-change="handleChangeCheckPeriod($event)" format="yyyy/MM/dd" ref="editDatepicker1" transfer type="date"></date-picker>
                </template>

                <template slot-scope="{ row }" slot="adjustTakenDays">
                    <input-number :max="999.5" :min="0.0" :step="0.5" :disabled="row._index !== radioCheckedIndex" @on-change="blurAdjustTakenDays(row)" class="tl" v-model="row.adjustTakenDays"/>
                </template>

                <template slot-scope="{ row }" slot="vactionGiveDay">
                    <span v-for="(item, i) of row.vactionGiveDay" :key="i" class="divi-line"><span v-if="item.isReGive" class="re-give">重</span>{{ item.day }}</span>
                </template>

                <template slot-scope="{ row }" slot="paidDays">
                    <span v-for="(item, i) of row.paidDays" :key="i" class="divi-line">{{ item | addNumDeci(true)}}</span>
                </template>

                <template slot-scope="{ row }" slot="editTakenDays">
                    <span>{{ row.editTakenDays  | addNumDeci(true)}}</span>
                </template>

                <template slot-scope="{ row }" slot="mustDays">
                    <span>{{ row.mustDays  | addNumDeci(true)}}</span>
                </template>

                <template slot="editMustDays" slot-scope="{ row }">
                    <input-number :max="999.5" :min="0.0" :step="0.5" :disabled="row._index !== radioCheckedIndex" @on-change="blurEditMustDays(row)" class="tl" v-model="row.editMustDays"/>
                </template>

                <template slot-scope="{ row }" slot="lackDays">
                    <span :class="+row.lackDays ? 'lack-day' : ''">{{ row.lackDays | addNumDeci(true)}}</span>
                </template>

            </i-table>
            <span v-if="isSeason">
                    <div class="titlenorm mb10 mt20">
                        <Icon type="logo-buffer"></Icon>
                        取得状況詳細
                    </div>
                    <Row :gutter="10">
                        <i-col span="4">
                        <div class="label">基準日</div>
                        <div class="person-info">{{ privateInfo.taKijyunbi }}</div>
                        </i-col>
                        <i-col span="5">
                        <div class="label">実績取得日数</div>
                        <div class="person-info">{{ privateInfo.Syutokudays | addNumDeci(true) }}</div>
                        </i-col>
                        <i-col span="5">
                        <div class="label">調整取得日数</div>
                        <div class="person-info">{{ privateInfo.ajustSyutokudays | addNumDeci(true) }}</div>
                        </i-col>
                        <i-col span="5">
                        <div class="label">必要日数</div>
                        <div class="person-info">{{ privateInfo.taMustdays8 | addNumDeci(true) }}</div>
                        </i-col>
                        <i-col span="5">
                        <div class="label">不足日数</div>
                        <div class="person-info">{{ privateInfo.taLessdays9 | addNumDeci(true) }}</div>
                        </i-col>
                    </Row>
                    <i-table border :columns="takenDaysColums" :data="takenDaysData" :loading="takenDaysDataLoading" class="mb30 mt10">
                    </i-table>
                </span>
        </Modal>
        <back-top></back-top>
    </div>
</main>

<div th:replace="layout/head::header"></div>
<script type="text/babel" th:inline="javascript">
    const FIVE_DAYS_HOLIDAY = new Vue({
        el: '.tmgacquired5daysholiday-warp',
        data() {
            return {
                columns: [
                    {
                        title: '氏名',
                        slot: 'name',
                        width: 150,
                        align: 'center'
                    },
                    {
                        title: '種別',
                        key: 'type',
                        minWidth: 180,
                        align: 'left'
                    },
                    {
                        title: '年次休暇\n付与日',
                        slot: 'vactionGiveDay',
                        minWidth: 100,
                        maxWidth: 200,
                        align: 'center'
                    },
                    {
                        title: '付与\n日数',
                        width: '70',
                        slot: 'paidDays',
                        align: 'center'
                    },
                    {
                        title: '期間内取得状況',
                        children: [
                            {
                                title: '基準日',
                                slot: 'basedDay',
                                align: 'center'
                            },
                            {
                                title: 'チェック期間',
                                slot: 'checkPeriod',
                                align: 'center'
                            },
                            {
                                title: '取得日数',
                                slot: 'takenDays',
                                align: 'center'
                            },
                            {
                                title: '必要日数',
                                slot: 'mustDays',
                                align: 'center'
                            },
                            {
                                title: '不足日数',
                                className: 'checkin',
                                slot: 'lackDays',
                                align: 'center'
                            }
                        ]
                    },
                    {
                        title: '時季',
                        width: 120,
                        slot: 'season',
                        align: 'center'
                    }
                ],
                paidColums: [
                    {
                        title: ' ',
                        slot: 'radio',
                        width: 35
                    },
                    {
                        title: '年次休暇\n付与日',
                        slot: 'vactionGiveDay',
                        minWidth: 80,
                        maxWidth: 100,
                        align: 'center'
                    },
                    {
                        title: '付与\n日数',
                        width: 60,
                        slot: 'paidDays',
                        align: 'center'
                    },
                    {
                        title: '期間内取得状況',
                        children: [
                            {
                                title: '基準日',
                                key: 'basedDay',
                                width: 100,
                                align: 'center'
                            },
                            {
                                title: '修正\n基準日',
                                className: 'checkin',
                                slot: 'editBasedDay',
                                align: 'center'
                            },
                            {
                                title: 'チェック期間',
                                key: 'checkPeriod',
                                align: 'center'
                            },
                            {
                                title: '修正\nチェック期間',
                                className: 'checkin',
                                slot: 'editCheckPeriod',
                                align: 'center'
                            },
                            {
                                title: '取得\n日数',
                                slot: 'editTakenDays',
                                width: 60,
                                align: 'center'
                            },
                            {
                                title: '調整\n取得日数',
                                className: 'checkin',
                                width: 100,
                                slot: 'adjustTakenDays',
                                align: 'center'
                            },
                            {
                                title: '必要\n日数',
                                slot: 'mustDays',
                                width: 70,
                                align: 'center'
                            },
                            {
                                title: '修正\n必要日数',
                                className: 'checkin',
                                slot: 'editMustDays',
                                width: 100,
                                align: 'center'
                            },
                            {
                                title: '不足\n日数',
                                className: 'checkin',
                                width: 70,
                                slot: 'lackDays',
                                align: 'center'
                            }
                        ]
                    }
                ],

                paidData: [],
                takenDaysColums: [
                    {
                        title: '取得日',
                        key: 'tdaDyyyymmdd'
                    },
                    {
                        title: '名称',
                        key: 'tdaCworkingname'
                    }
                ],
                takenDaysData: [],

                tableHead: [],
                tableData: [],
                loading: false,
                takenDaysDataLoading: false,
                referListObject: {
                    [[${ TREEVIEW_KEY_PERM_TARGET_SECTION }]]: '',
                    [[${ TREEVIEW_KEY_PERM_TARGET_GROUP }]]: '',
                    [[${ TREEVIEW_KEY_PERM_TARGET_EMP }]]: '',
                    [[${ TREEVIEW_KEY_RECORD_DATE }]]: '',
                    [[${ TREEVIEW_KEY_REFRESH_FLG }]]: '',
                    hidSearchItems:'EMPLOYEEID',
                    hidSearchCondition:'BROADMATCH',
                    hidSearchData:'',
                    txtTmgReferListTreeViewRecordDate: '',
                    psSite: Utils.getUrlParam(location.href, 'psSite'),
                    psApp: Utils.getUrlParam(location.href, 'psApp'),
                    type: 31
                },
                deptName: '',
                query: {
                    txtAction: 'ACT_DISP',
                    txtDYYYYMM: '',
                    hidSearchItems: [[${ session.SearchItems }]] || '',     //検索種別
                    hidSearchCondition: [[${ session.SearchCondition }]] || '', //検索条件
                    hidSearchData: [[${ session.SearchData }]] || '',      //検索対象
                    page: '1',
                    year: '',
                    txtUserCode: null,
                    kijunbi: '',
                    pdSearchStart: '',
                    pdSearchEnd: '',
                    recordDate: '',
                    txtDYYYYMMDD: '',
                    hidSelectTab:[[${ session.hidSelectTab }]] === 1 ? '1':'0',
                    txtTmgReferListTreeViewRecordDate: '',
                    txtTmgReferListTreeViewPermTargetSection: '',
                    txtTmgReferListTreeViewPermTargetGroup: '',
                    txtTmgReferListTreeViewPermTargetEmp: '',
                    psSite: Utils.getUrlParam(location.href, 'psSite'),
                    psApp: Utils.getUrlParam(location.href, 'psApp')
                },
                updateAcquired5DaysVO: {
                    recordDate: '',
                    txtUserCode: '',
                    txtYear: '',
                    kijunbi: '',
                    kijunbiEdit: '',
                    usedDaysEdit: '',
                    txtUpdateflg: '',
                    dkikanbiFix: '',
                    txtNusedaysDays: '',
                    txtFuyobi: '',
                    txtTmgReferListTreeViewPermSelectedView: '',
                    txtTmgReferListTreeViewPermTargetSection: '',
                    txtTmgReferListTreeViewPermTargetGroup: '',
                    txtTmgReferListTreeViewRecordDate: '',
                    txtTmgReferListTreeViewAdminTargetSection: '',
                    psSite: Utils.getUrlParam(location.href, 'psSite'),
                    psApp: Utils.getUrlParam(location.href, 'psApp')
                },
                privateInfo: {
                    taKijyunbi: '',
                    Syutokudays: '',
                    ajustSyutokudays: '',
                    taMustdays8: '',
                    taLessdays9: '',
                    deptName: '',
                    name: '',
                    workType: ''
                },
                empDeptLoading: false,
                deptDrawShow: false,
                treeData: [],
                yearShow: false,   　//年度表示制御
                dispMonthlyList: [],       //年月リスト
                model1: '',

                title: '',
                isSearchHistory: false,

                isSeason: false,
                isShow: false,
                selectedDeptViewType: 3,
                searchTypesList: [],     //組織ツリー用
                searchConditionsList: [],//組織ツリー用
                empTreeData: [],        //組織ツリー用
                emplistLoading: false,  //職員一覧ローディング用動画
                currentTab: [[${ session.hidSelectTab }]] === 1 ? "organisationSearch":"organisationTree", //組織のツリーと検索タブーを切り替え
                dataLoading: false,
                forRest: true,
                radioCheckedIndex: 0,
                targetPermSection: '',
                targetPermSectionFlag: false,
                titlesMessage: ''
            }
        },
        async mounted() {
            console.log([[${ session }]])
            await this.getInit()
            window.addEventListener('scroll',this.handleScroll,{ passive: true })
        },
        beforeDestroy() {
            window.removeEventListener('scroll',this.handleScroll,{ passive: true })
        },
        computed: {
            tableHeadFixed() {
                if (this.contentScrollTop > 300) return true
                else return false
            },
        },
        methods: {
            //詳細ボタン
            async handleBtn(e,i) {
                console.log("handleBtn(e)")
                console.log(i)
                console.log(e)
                this.titlesMessage = '年5日時季指定取得詳細'
                this.privateInfo.taKijyunbi = e.basedDay[i]
                this.privateInfo.Syutokudays = e.detailSyutokuDays[i]
                this.privateInfo.ajustSyutokudays = e.detailAdjustSyutokuDays[i]
                this.privateInfo.taMustdays8 = e.taMustdays8[i]
                this.privateInfo.taLessdays9 = e.taLessdays9[i]

                // this.privateInfo.deptName = this.deptName
                // 職員情報取得（種別）
                //选择职员保存、初期化使用。
                this.query.txtTmgReferListTreeViewAdminTargetEmp = e.cemployeeid0
                await this.getApplyEmployPersonalInfo()

                this.privateInfo.name = e.name
                this.privateInfo.workType = e.type

                this.query.txtUserCode = e.cemployeeid0
                this.query.kijunbi = e.basedDay[i]
                this.query.pdSearchStart = e.basedDay[i]
                this.query.pdSearchEnd = e.checkPeriod[i]
                //まずは年5日時季指定取得確認画面を開く
                this.isShow = true
                this.isSeason = true
                this.takenDaysDataLoading = true

                //选择职员保存、初期化使用。
                this.query.txtTmgReferListTreeViewPermTargetEmp = e.cemployeeid0

                const { data } = await this.http.get('sys/tmgacquired5daysholiday/showDisp', this.query)
                this.takenDaysData =data

                this.takenDaysDataLoading = false
            },
            async handleRowClick(e) {
                console.log("handleRowClick-s")
                console.log(e)
                // //初期化 datePicker
                // if(this.$refs.editDatepicker){
                //     this.$refs.editDatepicker.handleClear()
                // }
                this.titlesMessage = '年5日時季指定取得編集'
                // 销毁table
                this.forRest = !this.forRest

                //デフォルトの場合、1行目が選択させる。
                this.radioCheckedIndex = 0
                this.query.txtUserCode = e.cemployeeid0

                this.takenDaysDataLoading = true

                //选择职员保存、初期化使用。
                this.query.txtTmgReferListTreeViewPermTargetEmp = e.cemployeeid0

                const { data } = await this.http.get('sys/tmgacquired5daysholiday/list', this.query)
                if(data.length>0){
                    const addNumDeci = Vue.filter('addNumDeci')
                    let b = data.map((e,i) => {
                        const vactionGiveDay = [{
                            day:e.taDyyyymmdd3,
                            isReGive: data[i].taCduplicateflg === '1'
                        }]
                        return {
                            name:e.cemployeeName1,
                            type:e.workertypeNm2,
                            vactionGiveDay,
                            paidDays:[e.taFuyodays4],

                            basedDay:e.taDyyyymmdd3,
                            checkPeriod:e.fixTaKikanbi17,
                            takenDays:e.sumSyutokudays7,
                            mustDays:e.fixMustdays15,
                            lackDays:e.taLessdays9,

                            editBasedDay:e.tpfDpaidHolidayFix11,    //編集画面用_修正基準日
                            editTakenDays:e.fixSumSyutokudays16,    //編集画面用_取得日数
                            adjustTakenDays:e.tpfNusedaysAjdust13==null ? e.tpfNusedaysAjdust13:addNumDeci(e.tpfNusedaysAjdust13,true),  //編集画面用_調整取得日数
                            editCheckPeriod:e.tpfDkikanbiFix12,     //修正チェック期間
                            editMustDays:e.tpfNmustdaysFix14==null ? e.tpfNmustdaysFix14:addNumDeci(e.tpfNmustdaysFix14,true),       //修正必要日数
                            isChecked:false,

                            cemployeeid0:e.cemployeeid0,
                            cemployeeName1:e.cemployeeName1,
                            workertypeNm2:e.workertypeNm2,
                            taDyyyymmdd3:e.taDyyyymmdd3,
                            taFuyodays4:e.taFuyodays4,
                            taKijyunbi5:e.taKijyunbi5,
                            taKikanbi6:e.taKikanbi6,
                            sumSyutokudays7:e.sumSyutokudays7,
                            taMustdays8:e.taMustdays8,
                            taLessdays9:e.taLessdays9,
                            taRowpan10:e.taRowpan10,
                            tpfDpaidHolidayFix11:e.tpfDpaidHolidayFix11,
                            tpfDkikanbiFix12:e.tpfDkikanbiFix12,
                            tpfNusedaysAjdust13:e.tpfNusedaysAjdust13,
                            tpfNmustdaysFix14:e.tpfNmustdaysFix14,
                            taCduplicateflg:e.taCduplicateflg
                        }
                    })

                    for (var i=0;i < b.length;i++){
                        console.log("b[i].taKijyunbi5")
                        console.log(b[i].taKijyunbi5)
                        if (+b[i].taFuyodays4 < 10 && b[i].tpfNusedaysAjdust13 == null &&　b[i].tpfNmustdaysFix14 == null){
                            b[i].basedDay = "-"
                            b[i].checkPeriod = "-"
                            b[i].takenDays = "-"
                            b[i].mustDays = "-"
                            b[i].lackDays = "-"
                            b[i].editTakenDays = "-"  //編集画面用‐取得日数
                        }
                    }
                    this.paidData = b
                    this.paidData[0].isChecked = true

                    console.log("this.paidData")
                    console.log(this.paidData)
                    this.takenDaysDataLoading = false
                }
                // else if(data.length == 0){
                //     this.tableData = data
                //     this.dataLoading = false
                // }

                // this.paidData = [e[0]]

                // // 編集画面の基準日については、修正基準日あるかどうかにかかわらず、
                // // 基準日：taKijyunbiが存在する場合、基準日で設定すること。
                // if (e[0].taKijyunbi5 == null) {
                //     this.paidData[0].basedDay = '-'
                // } else {
                //     this.paidData[0].basedDay = e[0].taKijyunbi5
                // }

                // 職員情報取得
                await this.getApplyEmployPersonalInfo()

                this.privateInfo.name = this.paidData[0].name
                this.privateInfo.workType = this.paidData[0].type

                const addNumDeci = Vue.filter('addNumDeci')
                // 事前に1行目をデフォルト値として登録する
                this.updateAcquired5DaysVO.txtFuyobi = this.paidData[0].taDyyyymmdd3
                this.updateAcquired5DaysVO.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                this.updateAcquired5DaysVO.txtUserCode = this.paidData[0].cemployeeid0
                this.updateAcquired5DaysVO.kijunbi = this.paidData[0].taKijyunbi5
                this.updateAcquired5DaysVO.kijunbiEdit = this.paidData[0].tpfDpaidHolidayFix11
                this.updateAcquired5DaysVO.dkikanbiFix = this.paidData[0].tpfDkikanbiFix12
                this.updateAcquired5DaysVO.usedDaysEdit = this.paidData[0].tpfNusedaysAjdust13
                this.updateAcquired5DaysVO.txtNusedaysDays = this.paidData[0].tpfNmustdaysFix14
                console.log("this.updateAcquired5DaysVO")
                console.log(this.updateAcquired5DaysVO)

                this.isShow = true
                this.isSeason = false
            },
            cancel() {
                this.isShow = false
            },
            async getTableData() {
                this.dataLoading = true
                this.tableData = []
                if (this.query.hidSelectTab == '1') {
                    this.deptName = '検索対象者一覧'
                    this.query.txtUserCode = null
                }

                const { data } = await this.http.get('sys/tmgacquired5daysholiday/list', this.query)
                if(data.length>0){
                    let b = data.map((e,i) => {
                        const vactionGiveDay = [{
                            day:e.taDyyyymmdd3,
                            isReGive: data[i].taCduplicateflg === '1'
                        }]
                        return {
                            name:e.cemployeeName1,
                            type:e.workertypeNm2,
                            vactionGiveDay,
                            paidDays:[e.taFuyodays4],

                            basedDay:[e.taKijyunbi5],
                            checkPeriod:[e.taKikanbi6],
                            takenDays:[e.sumSyutokudays7],
                            mustDays:[e.taMustdays8],
                            lackDays:[e.taLessdays9],

                            detailSyutokuDays:[e.fixSumSyutokudays16],   //詳細画面取得状況_取得日数
                            detailAdjustSyutokuDays:[e.tpfNusedaysAjdust13], //詳細画面取得状況_調整取得日数
                            season:[],

                            cemployeeid0:e.cemployeeid0,
                            cemployeeName1:e.cemployeeName1,
                            workertypeNm2:e.workertypeNm2,
                            taDyyyymmdd3:e.taDyyyymmdd3,
                            taFuyodays4:e.taFuyodays4,
                            taKijyunbi5:e.taKijyunbi5,
                            taKikanbi6:e.taKikanbi6,
                            sumSyutokudays7:e.sumSyutokudays7,
                            taMustdays8:e.taMustdays8,
                            taLessdays9:e.taLessdays9,
                            taRowpan10:e.taRowpan10,
                            tpfDpaidHolidayFix11:e.tpfDpaidHolidayFix11,
                            tpfDkikanbiFix12:e.tpfDkikanbiFix12,
                            tpfNusedaysAjdust13:e.tpfNusedaysAjdust13,
                            tpfNmustdaysFix14:e.tpfNmustdaysFix14,
                            fixMustdays15:e.fixMustdays15,
                            fixSumSyutokudays16:e.fixSumSyutokudays16,
                            fixTaKikanbi17:e.fixTaKikanbi17,
                            taCduplicateflg:e.taCduplicateflg
                        }
                    })

                    for (var i=0;i < b.length;i++){
                        b[i].season.push("詳細")
                        if (+b[i].taFuyodays4 < 10 && b[i].tpfNusedaysAjdust13 == null &&　b[i].tpfNmustdaysFix14 == null){
                            console.log("test_tart")
                            console.log(b[i].cemployeeid0)
                            console.log(b[i].taFuyodays4)
                            console.log(b[i].tpfDpaidHolidayFix11)
                            console.log(b[i].tpfDkikanbiFix12)
                            console.log(b[i].tpfNusedaysAjdust13)
                            console.log(b[i].tpfNmustdaysFix14)
                            console.log("test_end")

                            b[i].basedDay = ["-"]
                            b[i].checkPeriod = ["-"]
                            b[i].takenDays = ["-"]
                            b[i].mustDays = ["-"]
                            b[i].lackDays = ["-"]
                            b[i].season = ["-"]
                        }
                    }

                    console.log("this.b = b")
                    console.log(b)

                    let a=[]
                    for (var i=0;i < b.length;i++){
                        if (b[i].taRowpan10 == 1) {
                            a.push(b[i])
                        } else if (b[i].taRowpan10 > 1) {
                            a.push(b[i])

                            let max = i + +b[i].taRowpan10
                            for (var j=i+1;j <  max;j++){
                                a[a.length-1].vactionGiveDay.push(b[j].vactionGiveDay[0])
                                a[a.length-1].paidDays.push(b[j].paidDays[0])

                                a[a.length-1].basedDay.push(b[j].basedDay[0])
                                a[a.length-1].checkPeriod.push(b[j].checkPeriod[0])
                                a[a.length-1].takenDays.push(b[j].takenDays[0])
                                a[a.length-1].mustDays.push(b[j].mustDays[0])
                                a[a.length-1].lackDays.push(b[j].lackDays[0])

                                a[a.length-1].detailSyutokuDays.push(b[j].detailSyutokuDays[0])
                                a[a.length-1].detailAdjustSyutokuDays.push(b[j].detailAdjustSyutokuDays[0])
                                a[a.length-1].season.push(b[j].season[0])
                            }
                            i = i + +b[i].taRowpan10 - 1
                        }
                    }
                    const addNumDeci = Vue.filter('addNumDeci')
                    //



                    this.tableData = a
                    this.dataLoading = false

                    console.log("this.tableData = a")
                    console.log(this.tableData)

                } else if (data.length == 0 && this.query.hidSelectTab == '0' ){
                    this.tableData = data
                    this.dataLoading = false
                    this.$Message.error({
                        background: true,
                        closable: true,
                        duration: 6,
                        content: '職員が存在している部署を選択してくだい。'
                    });
                } else if(data.length == 0 && this.query.hidSelectTab == '1' ){
                    this.tableData = data
                    this.dataLoading = false
                    this.$Message.error({
                        background: true,
                        closable: true,
                        duration: 6,
                        content: '条件に一致する職員が見つかりませんでした。'
                    });
                }
                this.isSearchHistory = false
            },
            async getOrgTree(refreshDept) {
                this.empDeptLoading = true
                try {
                    const { sectionList, recordDate } = await this.http.get('sys/tree', this.referListObject)
                    // 先将数据转为标准格式，再转为可用数据
                    this.treeData = Utils.convertTreeData(sectionList)
                    this.referListObject.txtTmgReferListTreeViewRecordDate = recordDate
                } catch (error) {
                    return
                } finally {
                    this.loading = false
                    this.empDeptLoading = false
                }
            },
            async getSearchCondition() {
                const { data } = await this.http.get('sys/tree/conditions', this.referListObject)
                this.searchConditionsList= Object.keys(data.searchConditions).map(e=> { return { name:data.searchConditions[e], value:e }})
                this.searchTypesList = Object.keys(data.searchTypes).map(e=> { return { name:data.searchTypes[e], value:e }})
            },
            searchOrgTree: Debounce( async function() {
                this.empDeptLoading = true
                try {
                    const { data } = await this.http.get('sys/tree/search', this.referListObject)
                    this.empTreeData = Utils.convertTreeData(data)
                    this.$Notice.success({ title:'所属図更新完了' })
                } catch (error) {
                    return
                } finally {
                    this.empDeptLoading = false
                }
            }),
            async getSearchTableData() {
                this.query.hidSelectTab = '1'
                this.query.hidSearchItems = this.referListObject.hidSearchItems
                this.query.hidSearchCondition = this.referListObject.hidSearchCondition
                this.query.hidSearchData = this.referListObject.hidSearchData
                //ツリー：0、検索：1
                this.getTableData()
            },
            async handleDeptDateChange(e) {
                this.referListObject.txtTmgReferListTreeViewRecordDate = e
                this.isSearchHistory = true
                await this.getOrgTree()
                if(this.treeData.length !== 0) {
                       this.$Notice.warning({ title:'所属図更新完了',desc:"下記の所属リストから対象を選んでください" })
                    }
            },
            async handleYearChange(e) {
                this.query.txtUserCode = null
                this.updateAcquired5DaysVO.txtYear = e.replace("年", "")
                this.query.year = e.replace("年", "")
                await this.getTableData()
            },
            handleScroll: Throttle(function (e) {
                this.contentScrollTop = e.target.documentElement.scrollTop || e.target.body.scrollTop
            }, 50),
            showDay: Debounce(function () {
                this.isShow = true
            }),
            convertTreeData(treeData = []) {
                return treeData.map(e => {
                    const children = e.child || e.children
                    if (children) {
                        return {
                            ...e.data,
                            title: e.data.label,
                            // 前两层级默认展开方便查看
                            expand: e.data.level < 2 || !e.data.level,
                            children: this.convertTreeData(children)
                        }
                    } else {
                        return {
                            ...e.data,
                            title: e.data.label
                        }
                    }
                })
            },
            handleSelector() { },
            async handleClickLeaf(e) {
                //同一部署を二回目でクリックすると、取消とするためで、エラーあり
                //よって、二回目クリックすると、何もしない
                if (!e[0]) return

                this.deptDrawShow = false
                this.query.txtAction = 'ACT_DISP'

                const section = [[${ TREEVIEW_KEY_PERM_TARGET_SECTION }]]
                this.referListObject[section] = e[0].secid

                this.deptName = e[0].label
                this.query.txtTmgReferListTreeViewPermTargetSection = e[0].secid
                this.query.txtTmgReferListTreeViewPermTargetGroup = e[0].groupid
                this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                this.query.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                //部門単位と個別検索は同一SQLを用いて、部門単位で検索していれば、職員コードをnullで設定する
                this.query.txtUserCode = null

                //初期
                if (!this.query.year) {
                    this.query.year = Utils.formatDate(this.referListObject.txtTmgReferListTreeViewRecordDate, 'yyyy')
                }
                if (!this.updateAcquired5DaysVO.txtYear) {
                    this.updateAcquired5DaysVO.txtYear = Utils.formatDate(this.referListObject.txtTmgReferListTreeViewRecordDate, 'yyyy')
                }
                this.yearShow = true

                //ツリーを選択するの場合、0で設定する
                this.query.hidSelectTab = '0'
                await this.getTableData()

            },
            dateFormat(e) {
                //YYYY年MM月からYYYY/MM/01へ変換する
                let yearMMDD = e.replace("年", "/")
                yearMMDD = yearMMDD.replace("月", "/")
                yearMMDD = yearMMDD + "01"
                return yearMMDD
            },
            register(e) {
                //1:登録　2:クリア
                this.updateAcquired5DaysVO.txtUpdateflg = '1'

                if (this.errorCheck()){
                    this.$Modal.confirm({
                        title: '',
                        content: '入力内容を保存します。よろしいですか？',
                        okText: 'OK',
                        cancelText: 'キャンセル',
                        onOk: async () => {
                            const { data } = await this.http.post('sys/tmgacquired5daysholiday/update', this.updateAcquired5DaysVO)
                            // 销毁table
                            this.forRest = !this.forRest
                            //年5日時季指定取得確認画面を閉じる
                            this.isShow = false
                            //部門単位と個別検索は同一SQLを用いて、部門単位で検索していれば、職員コードをnullで設定する
                            if (this.query.hidSelectTab=='0'){
                                this.query.txtUserCode = null
                            }
                            //一覧画面取得
                            this.getTableData()
                        },
                        onCancel: () => {
                        }
                    })
                }
            },
            clear(e) {
                //1:登録　2:クリア
                this.updateAcquired5DaysVO.txtUpdateflg = '2'
                //修正基準日を削除
                this.updateAcquired5DaysVO.kijunbiEdit = ''
                //調整取得日数を削除
                this.updateAcquired5DaysVO.usedDaysEdit = ''

                //修正チェック期間を削除
                this.updateAcquired5DaysVO.dkikanbiFix = ''
                //修正必要日数を削除
                this.updateAcquired5DaysVO.txtNusedaysDays = ''

                this.$Modal.confirm({
                    title: '',
                    content: '編集内容を削除します。よろしいですか？',
                    okText: 'OK',
                    cancelText: 'キャンセル',
                    onOk: async () => {
                        const { data } = await this.http.post('sys/tmgacquired5daysholiday/update', this.updateAcquired5DaysVO)

                        //年5日時季指定取得確認画面を閉じる
                        this.isShow = false
                        //部門単位と個別検索は同一SQLを用いて、部門単位で検索していれば、職員コードをnullで設定する
                        if (this.query.hidSelectTab=='0'){
                            this.query.txtUserCode = null
                        }
                        //一覧画面取得
                        this.getTableData()
                    },
                    onCancel: () => {
                    }
                })
            },
            //調整取得日数
            blurAdjustTakenDays(e) {
                console.log("blur")
                console.log(e)
                this.updateAcquired5DaysVO.usedDaysEdit = e.adjustTakenDays

                //調整取得日数を一旦残る
                let index=this.radioCheckedIndex
                this.paidData[index].adjustTakenDays = e.adjustTakenDays
            },
            //修正必要日数
            blurEditMustDays(e) {
                console.log("blurEditMustDays")
                console.log(e)
                this.updateAcquired5DaysVO.txtNusedaysDays = e.editMustDays

                //修正必要日数を一旦残る
                let index=this.radioCheckedIndex
                this.paidData[index].editMustDays = e.editMustDays
            },
            //修正基準日
            handleChangeBasedDay(e) {
                this.updateAcquired5DaysVO.kijunbiEdit = e

                //修正基準日を一旦残る
                let index=this.radioCheckedIndex
                this.paidData[index].editBasedDay = e
            },
            //修正チェック期間
            handleChangeCheckPeriod(e) {
                this.updateAcquired5DaysVO.dkikanbiFix = e

                //修正チェック期間を一旦残る
                let index=this.radioCheckedIndex
                this.paidData[index].editCheckPeriod = e
            },
            currentTabChanged(name) {
                // if (name=="organisationTree") {
                //     this.query.hidSelectTab='0'
                // } else if (name=="organisationSearch") {
                //     this.query.hidSelectTab='1'
                // }
            },
            errorCheck() {
                let date = this.updateAcquired5DaysVO.kijunbiEdit
                let days = this.updateAcquired5DaysVO.usedDaysEdit

                //修正チェック期間
                let date1 = this.updateAcquired5DaysVO.dkikanbiFix
                //修正必要日数
                let days1 = this.updateAcquired5DaysVO.txtNusedaysDays
                console.log("errorCheck")
                console.log(date)
                console.log(days1)
                // 修正基準日チェック ※2019/04/01(法改日)以降
                if (date != "" &&  date != null) {
                    if (date.split("/").join("") - 20190401 < 0) {
                        this.$Message.error({
                            background: true,
                            closable: true,
                            duration: 6,
                            content: '修正基準日は2019/04/01以降の日付を入力してください。'
                        });
                        return
                    }
                }
                // 修正チェック期間 ※2019/04/01(法改日)以降
                if (date1 != "" &&  date1 != null) {
                    if (date1.split("/").join("") - 20190401 < 0) {
                        this.$Message.error({
                            background: true,
                            closable: true,
                            duration: 6,
                            content: '修正チェック期間は2019/04/01以降の日付を入力してください。'
                        });
                        return
                    }
                }
                // 調整取得日数チェック
                if(isNaN(days) || days%0.5 > 0 || days < 0){
                    this.$Message.error({
                        background: true,
                        closable: true,
                        duration: 6,
                        content: '調整取得日数は半休単位(0.5)で入力してください。'
                    });
                    return
                }
                // 修正必要日数チェック
                if(isNaN(days1) || days1%0.5 > 0 || days1 < 0){
                    this.$Message.error({
                        background: true,
                        closable: true,
                        duration: 6,
                        content: '修正必要日数は半休単位(0.5)で入力してください。'
                    });
                    return
                }

                //日付関連チェック
                let index=this.radioCheckedIndex
                console.log("日付関連チェック")
                console.log(index)

                // 修正基準日の関連チェック・当レコードのチェック期間との比較
                if (date != "" &&  date != null) {
                    if (date.split("/").join("") - this.paidData[index].taKikanbi6.split("/").join("") > 0) {
                        this.$Message.error({
                            background: true,
                            closable: true,
                            duration: 6,
                            content: '修正基準日は'+this.paidData[index].taKikanbi6+'以前の日付を入力してください。'
                        });
                        return
                    }
                }
                // 修正チェック期間・当レコードの基準日との比較
                if (date1 != "" &&  date1 != null) {
                    if (date1.split("/").join("") - this.paidData[index].taKijyunbi5.split("/").join("") < 0) {
                        this.$Message.error({
                            background: true,
                            closable: true,
                            duration: 6,
                            content: '修正チェック期間は'+this.paidData[index].taKijyunbi5+'以降の日付を入力してください。'
                        });
                        return
                    }
                }

                //1行目チェック
                if (index == 0 && this.paidData[index].taRowpan10 > 1) {
                    // 修正基準日の関連チェック
                    if (date != "" &&  date != null) {
                        if (date.split("/").join("") - this.paidData[index+1].taKijyunbi5.split("/").join("") > 0) {
                            this.$Message.error({
                                background: true,
                                closable: true,
                                duration: 6,
                                content: '修正基準日は'+this.paidData[index+1].taKijyunbi5+'以前の日付を入力してください。'
                            });
                            return
                        }
                    }

                    // 修正チェック期間の関連チェック
                    if (date1 != "" &&  date1 != null) {
                         if (date1.split("/").join("") - this.paidData[index+1].taKikanbi6.split("/").join("") > 0) {
                             this.$Message.error({
                                    background: true,
                                    closable: true,
                                    duration: 6,
                                    content: '修正チェック期間は'+this.paidData[index+1].taKikanbi6+'以前の日付を入力してください。'
                             });
                             return
                         }
                    }
                }

                //最終行のチェック
                if (index == this.paidData[index].taRowpan10-1 && this.paidData[index].taRowpan10 > 1) {

                    // 修正基準日の関連チェック
                    if (date != "" &&  date != null) {
                        console.log("最後1")
                        console.log(date.split("/").join(""))
                        console.log(this.paidData[index-1].taKijyunbi5.split("/").join(""))

                        if (date.split("/").join("") - this.paidData[index-1].taKijyunbi5.split("/").join("") < 0) {
                            this.$Message.error({
                                background: true,
                                closable: true,
                                duration: 6,
                                content: '修正基準日は'+this.paidData[index-1].taKijyunbi5+'以降の日付を入力してください。'
                            });
                            return
                        }
                    }
                    // 修正チェック期間の関連チェック
                    if (date1 != "" &&  date1 != null) {
                        console.log("最後1")
                        console.log(index == this.paidData[index].taRowpan10-1)
                        console.log(date1.split("/").join(""))
                        console.log(this.paidData[index-1].taKijyunbi5.split("/").join(""))

                        if (date1.split("/").join("") - this.paidData[index-1].taKikanbi6.split("/").join("") < 0) {
                            this.$Message.error({
                                background: true,
                                closable: true,
                                duration: 6,
                                content: '修正チェック期間は'+this.paidData[index-1].taKikanbi6+'以降の日付を入力してください。'
                            });
                            return
                        }
                    }

                }

                //１行目から最終行までのチェック
                if (index > 0 && this.paidData[index].taRowpan10-1 > index) {

                    // 修正基準日の関連チェック
                    if (date != "" &&  date != null) {
                        console.log("2行目からN-1行までのチェック")
                        console.log(date.split("/").join(""))
                        console.log(this.paidData[index-1].taKijyunbi5.split("/").join(""))
                        // -----------------------
                        if (date.split("/").join("") - this.paidData[index-1].taKijyunbi5.split("/").join("") < 0) {
                            this.$Message.error({
                                background: true,
                                closable: true,
                                duration: 6,
                                content: '修正基準日は'+this.paidData[index-1].taKijyunbi5+'以降の日付を入力してください。'
                            });
                            return
                        }
                        if (date.split("/").join("") - this.paidData[index+1].taKijyunbi5.split("/").join("") > 0) {
                            this.$Message.error({
                                background: true,
                                closable: true,
                                duration: 6,
                                content: '修正基準日は'+this.paidData[index+1].taKijyunbi5+'以前の日付を入力してください。'
                            });
                            return
                        }
                    }
                    // -----------------------
                    if (date1 != "" &&  date1 != null) {
                            console.log("最後2")
                            console.log(date1.split("/").join(""))
                            console.log(this.paidData[index-1].taKikanbi6.split("/").join(""))
                            console.log(this.paidData[index+1].taKikanbi6.split("/").join(""))

                            if (date1.split("/").join("") - this.paidData[index-1].taKikanbi6.split("/").join("") < 0) {
                                this.$Message.error({
                                    background: true,
                                    closable: true,
                                    duration: 6,
                                    content: '修正チェック期間は'+this.paidData[index-1].taKikanbi6+'以降の日付を入力してください。'
                                });
                                return
                            }
                            if (date1.split("/").join("") - this.paidData[index+1].taKikanbi6.split("/").join("") > 0) {
                                this.$Message.error({
                                    background: true,
                                    closable: true,
                                    duration: 6,
                                    content: '修正チェック期間は'+this.paidData[index+1].taKikanbi6+'以前の日付を入力してください。'
                                });
                                return
                            }
                    }
                    // -----------------------

                }
                return true;
            },
            handleRadio(index) {
                console.log("handleRadio(index)")
                this.radioCheckedIndex = index
                console.log(this.radioCheckedIndex)
                console.log(this.paidData)

                const addNumDeci = Vue.filter('addNumDeci')
                let index_=this.radioCheckedIndex
                this.updateAcquired5DaysVO.txtFuyobi = this.paidData[index_].taDyyyymmdd3
                this.updateAcquired5DaysVO.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                this.updateAcquired5DaysVO.txtUserCode = this.paidData[index_].cemployeeid0
                this.updateAcquired5DaysVO.kijunbi = this.paidData[index_].taKijyunbi5
                this.updateAcquired5DaysVO.kijunbiEdit = this.paidData[index_].editBasedDay //修正基準日
                this.updateAcquired5DaysVO.dkikanbiFix = this.paidData[index_].editCheckPeriod     //修正チェック期間
                this.updateAcquired5DaysVO.usedDaysEdit = this.paidData[index_].adjustTakenDays //調整取得日数
                this.updateAcquired5DaysVO.txtNusedaysDays = this.paidData[index_].editMustDays //修正必要日数
                console.log("register_this.updateAcquired5DaysVO")
                console.log(this.updateAcquired5DaysVO)

                this.paidData = this.paidData.map((e, i) => {
                    return {
                        ...e,
                        isChecked: i === index ? true : false
                    }
                })
            },
            //初期化処理
            async getInit() {
                console.log("getInit")
                console.log([[${ session.txtTmgReferListTreeViewPermTargetSection }]])
                console.log(Utils.formatDate([[${ session.TmgReferListSYSDATE }]], 'yyyy/mm/dd'))
                this.referListObject.txtTmgReferListTreeViewRecordDate = Utils.formatDate([[${ session.TmgReferListSYSDATE }]], 'yyyy/mm/dd')
                await this.getOrgTree()
                await this.getSearchCondition()

                //検索の初期化対応
                this.query.hidSelectTab = [[${ session.hidSelectTab }]]
                this.query.hidSearchItems = [[${ session.hidSearchItems }]]
                this.query.hidSearchCondition = [[${ session.hidSearchCondition }]]
                this.query.hidSearchData = [[${ session.hidSearchData }]]

                this.referListObject.hidSelectTab = [[${ session.hidSelectTab }]]
                this.referListObject.hidSearchItems = [[${ session.hidSearchItems }]] || 'EMPLOYEEID'
                this.referListObject.hidSearchCondition = [[${ session.hidSearchCondition }]] || 'BROADMATCH'
                this.referListObject.hidSearchData = [[${ session.hidSearchData }]]

                this.targetPermSection = '',
                this.targetPermSection = [[${ session.txtTmgReferListTreeViewPermTargetSection }]]
                //　初回管理サイトの画面にアクセスするなら、targetSectionがnullであることから、下記通りでデフォルト所属を設定する
                // １．ログインユーザが本人所属部署の承認権限がある場合、ログインユーザの所属部署をデフォルト所属とする。
                // ２．ログインユーザが本人所属部署の管理権限がない場合、ログインユーザの管理対象部署のTOP部署をデフォルト所属とする
                console.log("getDeptCode")
                console.log(this.targetPermSection)

                if (this.targetPermSection != null || this.targetPermSection != '') {
                    this.getDeptCode(this.treeData)
                    if (this.targetPermSectionFlag) {
                        console.log("getDeptCode_true")
                        console.log(this.treeData)
                        this.getDeptName(this.treeData)
                        this.query.txtTmgReferListTreeViewPermTargetSection = [[${ session.txtTmgReferListTreeViewPermTargetSection }]]
                        this.query.txtTmgReferListTreeViewPermTargetGroup = [[${ session.txtTmgReferListTreeViewPermTargetGroup }]]
                        this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        this.query.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    } else {
                        console.log("getDeptCode_false")
                        console.log(this.treeData)
                        this.deptName = this.treeData[0].label
                        this.query.txtTmgReferListTreeViewPermTargetSection = this.treeData[0].secid
                        this.query.txtTmgReferListTreeViewPermTargetGroup = this.treeData[0].groupid
                        this.query.txtTmgReferListTreeViewRecordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                        this.query.recordDate = this.referListObject.txtTmgReferListTreeViewRecordDate
                    }
                }

                //一覧画面取得
                this.getTableData()
            },
            getDeptCode(data) {
                data.forEach(e => {
                    if (e.secid === this.targetPermSection) {
                        this.targetPermSectionFlag = true
                    } else {
                        const children = e.child || e.children
                        if (children) {
                            this.getDeptCode(children)
                        }
                    }
                })
            },
            getDeptName(data) {
                // idによりループ処理でdeptNameを取得する
                data.forEach(e => {
                    if (e.secid === this.targetPermSection) {
                        this.deptName = e.label
                    } else {
                        const children = e.child || e.children
                        if (children) {
                            this.getDeptName(children)
                        }
                    }
                })
            },
            // 職員情報取得
            async getApplyEmployPersonalInfo() {
                // 職員情報取得
                const { data } = await this.http.get('sys/vapply/EmployInfo', this.query)
                this.privateInfo.deptName = data.section
            },
        }
    })
</script>
</body>

</html>