<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/header::common_header(title='休暇・休業承認',cssPaths='/pages/content.min.css')">
</head>

<body>
  <div th:replace="layout/loadingBar::loadingBar"></div>
  <main class="content restapplyconfirm-warp" @scroll.passive="handleScroll" ref="layout">
    <div class="content_head">
      <div class="header">
        <div class="title1">
          <h1>
            <Icon type="i-emeer colored"></Icon>
            {{ `休暇・休業承認` }}
          </h1>
        </div>
        <div class="btnbox">
          <span style="flex:1"></span>
          <i-button type="primary" ghost size="large" icon="md-nutrition">代理申請</i-button>
          <i-button type="primary" size="large" icon="md-done-all" @click="confirm">承認</i-button>
          <i-button type="error" size="large" icon="md-hand" @click="beforeDeny">否認</i-button>
        </div>
      </div>
      <div class="searchwrap">
        <span class="label">年月</span>
        <i-select v-model="opts.month" class="mr30" @on-change="handleDatePicker($event)">
          <i-option v-for="(item, index) of monthSelect" :key="index" :label="item" :value="index + 1">
          </i-option>
        </i-select>
        <span class="label">キーワード</span>
        <i-input @on-search="getData" class="mar like-select" v-model="opts.keyword" placeholder="社員名或はコード" search
          enter-button />
      </div>
    </div>
    <div class="content_body">
      <div class="table-top">
        <Row :gutter="16">
          <!-- 共通年選択 start-->
          <i-col span="11">
            <i-button type="text" @click="preMonth" :disabled="preDisabled" class="icon-left">
              <Icon type="ios-arrow-back" size="large"></Icon>
            </i-button>
            <i-button type="text" @click="currentMonth" :disabled="showPre" class="icon-center">今年</i-button>
            <i-button type="text" @click="nextMonth" :disabled="nextDisabled" class="icon-right">
              <Icon type="ios-arrow-forward" size="large"></Icon>
            </i-button>
          </i-col>
          <!-- 共通年選択 end-->

          <i-col span="13" class="tr">
            <radio-group class="mr15">
              <Radio :label="6" class="custom-radio">全て</Radio>
              <Radio :label="0" class="custom-radio">待ち</Radio>
              <Radio :label="1" class="custom-radio">済み</Radio>
              <Radio :label="2" class="custom-radio">取下</Radio>
            </radio-group>
            <Page :total="pageValue.amount" :current="pageValue.curPage" show-total show-sizer style="display: inline"
              :page-size="pageValue.curSize" :page-size-opts="pageValue.list" @on-change="pageChange"
              @on-page-size-change="sizeChange" ref="Page" />
          </i-col>
        </Row>
      </div>
      <i-table border :columns="columns" :disabled-hover="true" :data="tableData" :loading="loading">
        <template slot-scope="{ row }" slot="dateList">
          <span>{{ handleApplyDayShow(row.dateList) }}</span>
        </template>

        <template slot-scope="{ row }" slot="otherOne">
          <span v-if="row.otherOne" class="confirm-sytle ing">代</span>
        </template>

        <template slot-scope="{ row }" slot="more">
          <Button type="success" ghost size="small" style="width:100%">詳細</Button>
        </template>

        <template slot-scope="{ row }" slot="status">
          <span v-if="row.status === 1" class="confirm-sytle ing">待</span>
          <span v-if="row.status === 2" class="confirm-sytle">済</span>
          <span v-if="row.status === 3" class="confirm-sytle undo">エ</span>
        </template>
      </i-table>
    </div>
  </main>
  <div th:replace="layout/script::common_script"></div>
  <script type="text/babel" th:inline="javascript">
    const REST_APPLY_CONFIRM = new Vue({
      el: '.restapplyconfirm-warp',
      data() {
        return {
          preDisabled: true,   //年度選択制御
          nextDisabled: true,  //年度選択制御
          showPre: true,
          monthSelect: Utils.getNumArray(1, 12).map(e => `${e}月`),  //表示開始月
          columns: [
            {
              title: '申請者',
              key: 'empName',
              align: 'right',
              minWidth: 100,
              maxWidth: 200
            },
            {
              title: '代理申請',
              slot: 'otherOne',
              align: 'center',
              width: 80
            },
            {
              title: '申請区分',
              key: 'restTypeName',
              tooltip: true,
              align: 'center',
              minWidth: 105,
              maxWidth: 200
            },
            {
              title: '対象期間',
              key: 'dateList',
              minWidth: 190,
              maxWidth: 200
            },
            {
              title: '次の承認者',
              key: 'nextAdmin',
              align: 'center',
              minWidth: 150
            },
            {
              title: '申請理由',
              key: 'remark',
              tooltip: true,
              minWidth: 100
            },
            {
              title: '申請日時',
              key: 'createTime',
              minWidth: 50,
              maxWidth: 160,
              tooltip: true
            },
            {
              title: '最終更新日',
              key: 'updateTime',
              minWidth: 50,
              maxWidth: 160,
              tooltip: true
            },
            {
              title: '状態',
              slot: 'status',
              align: 'center',
              width: 45
            },
            {
              title: '詳細',
              slot: 'more',
              align: 'center',
              width: 80
            },
            {
              type: 'selection',
              width: 50,
              align: 'center'
            }
          ],
          loading: false,
          tableData: [],
          pageValue: {
            amount: 0,
            curPage: 1,
            list: [20, 30, 50, 100],
            curSize: 20
          },
          opts: {
            month:0,
            status: 0,
            page: null,
            keyword: null,
            limit: 20
          }
        }
      },
      async mounted() {
        this.getData()
      },
      computed: {
      },
      methods: {
        getData: Debounce(async function () {
          try {
            this.loading = true
            // const { data } = await this.api.mock('applyConfirm')
            this.tableData = data
            this.amount = data.totalCount || 2
          } catch (error) {
            return
          } finally {
            this.loading = false
          }
        }),
        handleDatePicker() { },
        confirm() {},
        beforeDeny() {},
        pageChange(e) {
          this.opts.page = e
          this.pageValue.curPage = e
          this.getData()
        },
        preMonth() {
        },
        nextMonth() {
        },
        currentMonth() {},
        sizeChange(e) {
          this.opts.limit = e
          this.pageValue.curSize = e
          this.utils.setStorage('SO_userSettings', { pageSize: e })
          this.getData()
        }
      }
    })
  </script>
</body>

</html>