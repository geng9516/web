<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.smartcompany.job.modules.core.mapper.TmgCalendarSectionMapper">
    <insert id="insertCalendarSecton">
    INSERT INTO TMG_CALENDAR_SECTION (
        TCAS_CCUSTOMERID,
        TCAS_CCOMPANYID,
        TCAS_DSTARTDATE,
        TCAS_DENDDATE,
        TCAS_CSECTIONID,
        TCAS_CMODIFIERUSERID,
        TCAS_DMODIFIEDDATE,
        TCAS_CMODIFIERPROGRAMID,
        TCAS_CGROUPID,
        TCAS_DYYYYMM,
        TCAS_EDITFLAG,
        TCAS_CHOLFLG01,
        TCAS_CHOLFLG02,
        TCAS_CHOLFLG03,
        TCAS_CHOLFLG04,
        TCAS_CHOLFLG05,
        TCAS_CHOLFLG06,
        TCAS_CHOLFLG07,
        TCAS_CHOLFLG08,
        TCAS_CHOLFLG09,
        TCAS_CHOLFLG10,
        TCAS_CHOLFLG11,
        TCAS_CHOLFLG12,
        TCAS_CHOLFLG13,
        TCAS_CHOLFLG14,
        TCAS_CHOLFLG15,
        TCAS_CHOLFLG16,
        TCAS_CHOLFLG17,
        TCAS_CHOLFLG18,
        TCAS_CHOLFLG19,
        TCAS_CHOLFLG20,
        TCAS_CHOLFLG21,
        TCAS_CHOLFLG22,
        TCAS_CHOLFLG23,
        TCAS_CHOLFLG24,
        TCAS_CHOLFLG25,
        TCAS_CHOLFLG26,
        TCAS_CHOLFLG27,
        TCAS_CHOLFLG28,
        TCAS_CHOLFLG29,
        TCAS_CHOLFLG30,
        TCAS_CHOLFLG31
    )
    VALUES
	(
		#{custID},
		#{compCode},
		'1900/01/01',
		'2222/12/31',
		#{targetSec},
		#{userCode},
		SYSDATE,
		'TMG_CALANDER_EDIT',
		#{targetGroup},
		#{monthDto.month},
		'1',
        <foreach collection="list" item="monthDto" index="index" open="" close="" separator=",">
            #{monthDto.holFlgList}
        </foreach>
        ;
	)
    </insert>
    <update id="updateCalendar">
        UPDATE
            TMG_CALENDAR_SECTION
        SET
        <foreach collection="list" item="holFlgList" index="index" open="" close="," separator=",">
            ${holFlgList.columnName} = '${holFlgList.columnValue}'
        </foreach>
            TCAS_CMODIFIERUSERID = #{userCode},
            TCAS_DMODIFIEDDATE = SYSDATE,
            TCAS_CMODIFIERPROGRAMID = 'TMG_CALANDER_EDIT',
            TCAS_EDITFLAG = TO_NUMBER( TCAS_EDITFLAG ) + 1
        WHERE
	        TCAS_CCUSTOMERID = #{custID}
        AND TCAS_CCOMPANYID = #{compCode}
        AND TCAS_CSECTIONID = #{targetSec}
        AND TCAS_CGROUPID = #{targetGroup}
        AND TCAS_DYYYYMM = #{month};
    </update>

    <select id="selectCalenderDisp" resultType="jp.smartcompany.job.modules.tmg.calendar.vo.CalendarDispVo">
        SELECT
            TCAS_DYYYYMM,
            TCAS_CHOLFLG01,
            TCAS_CHOLFLG02,
            TCAS_CHOLFLG03,
            TCAS_CHOLFLG04,
            TCAS_CHOLFLG05,
            TCAS_CHOLFLG06,
            TCAS_CHOLFLG07,
            TCAS_CHOLFLG08,
            TCAS_CHOLFLG09,
            TCAS_CHOLFLG10,
            TCAS_CHOLFLG11,
            TCAS_CHOLFLG12,
            TCAS_CHOLFLG13,
            TCAS_CHOLFLG14,
            TCAS_CHOLFLG15,
            TCAS_CHOLFLG16,
            TCAS_CHOLFLG17,
            TCAS_CHOLFLG18,
            TCAS_CHOLFLG19,
            TCAS_CHOLFLG20,
            TCAS_CHOLFLG21,
            TCAS_CHOLFLG22,
            TCAS_CHOLFLG23,
            TCAS_CHOLFLG24,
            TCAS_CHOLFLG25,
            TCAS_CHOLFLG26,
            TCAS_CHOLFLG27,
            TCAS_CHOLFLG28,
            TCAS_CHOLFLG29,
            TCAS_CHOLFLG30,
            TCAS_CHOLFLG31,
            DECODE(
            TO_CHAR( TCAS_DYYYYMM, 'Day' ),
            '日曜日',
            0,
            DECODE(
            TO_CHAR( TCAS_DYYYYMM, 'Day' ),
            '月曜日',
            1,
            DECODE(
            TO_CHAR( TCAS_DYYYYMM, 'Day' ),
            '火曜日',
            2,
            DECODE(
            TO_CHAR( TCAS_DYYYYMM, 'Day' ),
            '水曜日',
            3,
            DECODE(
            TO_CHAR( TCAS_DYYYYMM, 'Day' ),
            '木曜日',
            4,
            DECODE( TO_CHAR( TCAS_DYYYYMM, 'Day' ), '金曜日', 5, DECODE( TO_CHAR( TCAS_DYYYYMM, 'Day' ), '土曜日', 6, '' ) )
            )
            )
            )
            )
            ) AS START_DAY,
            TO_CHAR( LAST_DAY( TCAS_DYYYYMM ), 'dd' ) AS LAST_DAY,
            DECODE( TCAS_CHOLFLG01, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG02, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG03, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG04, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG05, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG06, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG07, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG08, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG09, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG10, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG11, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG12, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG13, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG14, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG15, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG16, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG17, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG18, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG19, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG20, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG21, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG22, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG23, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG24, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG25, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG26, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG27, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG28, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG29, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG30, 'TMG_HOLFLG|0', 1, 0 ) + DECODE( TCAS_CHOLFLG31, 'TMG_HOLFLG|0', 1, 0 ) AS STANDAR_DDAY,
            '{1:''' || TCAS_CHOLFLG01 || ''',2:''' || TCAS_CHOLFLG02 || ''',3:''' || TCAS_CHOLFLG03 || ''',4:''' || TCAS_CHOLFLG04 || ''',5:''' || TCAS_CHOLFLG05 || ''',6:''' || TCAS_CHOLFLG06 || ''',7:''' || TCAS_CHOLFLG07 || ''',8:''' || TCAS_CHOLFLG08 || ''',9:''' || TCAS_CHOLFLG09 || ''',10:''' || TCAS_CHOLFLG10 || ''',11:''' || TCAS_CHOLFLG11 || ''',12:''' || TCAS_CHOLFLG12 || ''',13:''' || TCAS_CHOLFLG13 || ''',14:''' || TCAS_CHOLFLG14 || ''',15:''' || TCAS_CHOLFLG15 || ''',16:''' || TCAS_CHOLFLG16 || ''',17:''' || TCAS_CHOLFLG17 || ''',18:''' || TCAS_CHOLFLG18 || ''',19:''' || TCAS_CHOLFLG19 || ''',20:''' || TCAS_CHOLFLG20 || ''',21:''' || TCAS_CHOLFLG21 || ''',22:''' || TCAS_CHOLFLG22 || ''',23:''' || TCAS_CHOLFLG23 || ''',24:''' || TCAS_CHOLFLG24 || ''',25:''' || TCAS_CHOLFLG25 || ''',26:''' || TCAS_CHOLFLG26 || ''',27:''' || TCAS_CHOLFLG27 || ''',28:''' || TCAS_CHOLFLG28 || ''',29:''' || TCAS_CHOLFLG29 || ''',30:''' || TCAS_CHOLFLG30 || ''',31:''' || TCAS_CHOLFLG31 || '''}' AS MONTH_PARA
        FROM
            TMG_CALENDAR_SECTION
        WHERE
            TCAS_CCUSTOMERID = #{custID}
        AND TCAS_CCOMPANYID = #{compCode}
        <choose>
            <when test='psMode=="0"'>
                AND TCAS_CSECTIONID = #{targetSec}
                AND TCAS_CGROUPID = #{targetGroup}
            </when>
            <otherwise>
                AND TCAS_CSECTIONID = #{psSection}
                AND TCAS_CGROUPID = '${psSection}'||'|000000'
            </otherwise>
        </choose>

        AND TCAS_DYYYYMM <![CDATA[<=]]> '${year}'||'/12/31'
        AND TCAS_DYYYYMM >= '${year}'||'/01/01'
        ORDER BY
        TCAS_DYYYYMM
    </select>
</mapper>